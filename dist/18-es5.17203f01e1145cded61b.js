function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{QTuy:function(t,e,n){"use strict";n.r(e);var s=n("3Pt+"),u=n("aceb"),o=n("ofXK"),a=n("IAlr"),i=n("lst6"),r=n("W14u"),l=n("ZatZ"),d=n("JmRu"),c=n("EQut"),b=n("qsE9"),m=n("no5z"),g=n("5V5q"),h=n("fXoL"),C=n("tyNb"),f=["stepper"];function p(t,e){if(1&t&&(h.Wb(0,"nb-option",67),h.Cc(1),h.Vb()),2&t){var n=e.$implicit;h.mc("value",n._id),h.Eb(1),h.Dc(n.basicDetails.courseName)}}function v(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Student Course is required! "),h.Vb())}function F(t,e){if(1&t&&(h.Ub(0),h.Ac(1,v,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("course").errors?null:n.studentCourseForm.get("course").errors.required)}}function V(t,e){if(1&t&&(h.Wb(0,"nb-option",67),h.Cc(1),h.Vb()),2&t){var n=e.$implicit;h.mc("value",n._id),h.Eb(1),h.Dc(n.basicDetails.batchName)}}function I(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Student Batch is required! "),h.Vb())}function A(t,e){if(1&t&&(h.Ub(0),h.Ac(1,I,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("batch").errors?null:n.studentCourseForm.get("batch").errors.required)}}function W(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Roll Number is required! "),h.Vb())}function y(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Roll Number should be greater than 0 "),h.Vb())}function D(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," This roll number already Exist! "),h.Vb())}function S(t,e){if(1&t&&(h.Ub(0),h.Ac(1,W,2,0,"p",68),h.Ac(2,y,2,0,"p",68),h.Ac(3,D,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("rollNumber").errors?null:n.studentCourseForm.get("rollNumber").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("rollNumber").errors?null:n.studentCourseForm.get("rollNumber").errors.min),h.Eb(1),h.mc("ngIf",n.rollNumberAlreadyExist)}}function E(t,e){if(1&t&&(h.Wb(0,"nb-option",67),h.Cc(1),h.Vb()),2&t){var n=e.$implicit,s=h.gc(2);h.mc("value",n._id),h.Eb(1),h.Dc(s.getDiscount(n._id))}}function w(t,e){if(1&t&&(h.Wb(0,"nb-option",67),h.Cc(1),h.hc(2,"uppercase"),h.Vb()),2&t){var n=e.$implicit;h.mc("value",n),h.Eb(1),h.Dc(h.ic(2,2,n))}}function N(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Discount Amount should be more than or equal to 0 "),h.Vb())}function T(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Discount Percentage should be between 0% to 100% "),h.Vb())}function P(t,e){if(1&t&&(h.Ub(0),h.Ac(1,N,2,0,"p",68),h.Ac(2,T,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("additionalDiscountAmount").errors?null:n.studentCourseForm.get("additionalDiscountAmount").errors.min),h.Eb(1),h.mc("ngIf",n.studentCourseForm.hasError("invalidDiscountPercentage"))}}function R(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Activation date is required "),h.Vb())}function k(t,e){if(1&t&&(h.Ub(0),h.Ac(1,R,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("activationDate").errors?null:n.studentCourseForm.get("activationDate").errors.required)}}function x(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Net Payable Amount is Required "),h.Vb())}function O(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Net Payable Amount should be greater than 0 "),h.Vb())}function q(t,e){if(1&t&&(h.Ub(0),h.Ac(1,x,2,0,"p",68),h.Ac(2,O,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("netPayable").errors?null:n.studentCourseForm.get("netPayable").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseForm.get("netPayable").errors?null:n.studentCourseForm.get("netPayable").errors.min)}}function M(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Date is required "),h.Vb())}function _(t,e){if(1&t&&(h.Ub(0),h.Ac(1,M,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("date").errors?null:n.studentCourseFeeForm.get("date").errors.required)}}function B(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Student Course is required! "),h.Vb())}function U(t,e){if(1&t&&(h.Ub(0),h.Ac(1,B,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("installmentType").errors?null:n.studentCourseFeeForm.get("installmentType").errors.required)}}function Q(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Number of Installments are Required "),h.Vb())}function $(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Number of Installments should be greater than 0 "),h.Vb())}function G(t,e){if(1&t&&(h.Ub(0),h.Ac(1,Q,2,0,"p",68),h.Ac(2,$,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("noOfInstallments").errors?null:n.studentCourseFeeForm.get("noOfInstallments").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("noOfInstallments").errors?null:n.studentCourseFeeForm.get("noOfInstallments").errors.min)}}function j(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Pending Amount is Required "),h.Vb())}function X(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Pending Amount should be greater than 0 "),h.Vb())}function z(t,e){if(1&t&&(h.Ub(0),h.Ac(1,j,2,0,"p",68),h.Ac(2,X,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("pendingAmount").errors?null:n.studentCourseFeeForm.get("pendingAmount").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("pendingAmount").errors?null:n.studentCourseFeeForm.get("pendingAmount").errors.min)}}function J(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Collected Amount is Required "),h.Vb())}function K(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Collected Amount should be greater than 0 "),h.Vb())}function L(t,e){if(1&t&&(h.Ub(0),h.Ac(1,J,2,0,"p",68),h.Ac(2,K,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("amountCollected").errors?null:n.studentCourseFeeForm.get("amountCollected").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("amountCollected").errors?null:n.studentCourseFeeForm.get("amountCollected").errors.min)}}function Z(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Total Amount is Required "),h.Vb())}function H(t,e){1&t&&(h.Wb(0,"p",69),h.Cc(1," Total Amount should be greater than 0 "),h.Vb())}function Y(t,e){if(1&t&&(h.Ub(0),h.Ac(1,Z,2,0,"p",68),h.Ac(2,H,2,0,"p",68),h.Tb()),2&t){var n=h.gc(2);h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("totalAmount").errors?null:n.studentCourseFeeForm.get("totalAmount").errors.required),h.Eb(1),h.mc("ngIf",null==n.studentCourseFeeForm.get("totalAmount").errors?null:n.studentCourseFeeForm.get("totalAmount").errors.min)}}function tt(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index;h.Eb(1),h.Ec(" Installment ",n+1," Date is required ")}}function et(t,e){if(1&t&&(h.Ub(0),h.Ac(1,tt,2,1,"p",68),h.Tb()),2&t){var n=h.gc().$implicit;h.Eb(1),h.mc("ngIf",null==n.get("installmentDate").errors?null:n.get("installmentDate").errors.required)}}function nt(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index;h.Eb(1),h.Ec(" Installment ",n+1," Amount is Required ")}}function st(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index,s=h.gc(3);h.Eb(1),h.Fc(" Installment ",n+1," Amount should be Minimum ",s.getMinInstallmentAmount(n)," ")}}function ut(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index,s=h.gc(3);h.Eb(1),h.Fc(" Installment ",n+1," Amount should be Maximum ",s.getMaxInstallmentAmount(n)," ")}}function ot(t,e){if(1&t&&(h.Ub(0),h.Ac(1,nt,2,1,"p",68),h.Ac(2,st,2,2,"p",68),h.Ac(3,ut,2,2,"p",68),h.Tb()),2&t){var n=h.gc().$implicit;h.Eb(1),h.mc("ngIf",null==n.get("installmentAmount").errors?null:n.get("installmentAmount").errors.required),h.Eb(1),h.mc("ngIf",n.hasError("invalidMinInstallmentAmount")),h.Eb(1),h.mc("ngIf",n.hasError("invalidMaxInstallmentAmount"))}}function at(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index;h.Eb(1),h.Ec(" Installment ",n+1," Pending Amount is Required ")}}function it(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index,s=h.gc(3);h.Eb(1),h.Fc(" Installment ",n+1," Pending Amount should be Minimum ",s.getMinInstallmentPendingAmount(n)," ")}}function rt(t,e){if(1&t&&(h.Wb(0,"p",69),h.Cc(1),h.Vb()),2&t){var n=h.gc(2).index,s=h.gc(3);h.Eb(1),h.Fc(" Installment ",n+1," Pending Amount should be Maximum ",s.getMaxInstallmentPendingAmount(n)," ")}}function lt(t,e){if(1&t&&(h.Ub(0),h.Ac(1,at,2,1,"p",68),h.Ac(2,it,2,2,"p",68),h.Ac(3,rt,2,2,"p",68),h.Tb()),2&t){var n=h.gc().$implicit;h.Eb(1),h.mc("ngIf",null==n.get("amountPending").errors?null:n.get("amountPending").errors.required),h.Eb(1),h.mc("ngIf",n.hasError("invalidMinInstallmentPendingAmount")),h.Eb(1),h.mc("ngIf",n.hasError("invalidMaxInstallmentPendingAmount"))}}function dt(t,e){if(1&t){var n=h.Xb();h.Ub(0),h.Wb(1,"tr",70),h.Wb(2,"td"),h.Cc(3),h.Vb(),h.Wb(4,"td"),h.Wb(5,"div",9),h.Rb(6,"input",71),h.Ac(7,et,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(8,"td"),h.Wb(9,"div",9),h.Wb(10,"input",72),h.ec("input",(function(t){h.uc(n);var s=e.index;return h.gc(3).customInstallmentAmount(t.target.value,s)})),h.Vb(),h.Ac(11,ot,4,3,"ng-container",0),h.Vb(),h.Vb(),h.Wb(12,"td"),h.Wb(13,"div",9),h.Rb(14,"input",73),h.Ac(15,lt,4,3,"ng-container",0),h.Vb(),h.Vb(),h.Vb(),h.Tb()}if(2&t){var s=e.$implicit,u=e.index,o=h.gc(3);h.Eb(1),h.mc("formGroup",s),h.Eb(2),h.Ec("Installment ",s.value.installmentNo,""),h.Eb(3),h.oc("id","input-installmentDate-",u,""),h.oc("name","installmentDate-",u,""),h.mc("min",o.getMinInstallmentDate(u))("max",o.getMaxInstallmentDate(u))("status",s.get("installmentDate").touched?s.get("installmentDate").invalid?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",s.get("installmentDate").touched&&s.get("installmentDate").invalid),h.Eb(3),h.oc("id","input-installmentAmount-",u,""),h.oc("name","installmentAmount-",u,""),h.mc("min",o.getMinInstallmentAmount(u))("max",o.getMaxInstallmentAmount(u))("status",s.get("installmentAmount").touched?s.get("installmentAmount").invalid||s.hasError("invalidMinInstallmentAmount")||s.hasError("invalidMaxInstallmentAmount")?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",s.get("installmentAmount").touched),h.Eb(3),h.oc("id","input-amountPending-",u,""),h.oc("name","amountPending-",u,""),h.mc("min",o.getMinInstallmentPendingAmount(u))("max",o.getMaxInstallmentPendingAmount(u))("status",s.get("amountPending").touched?s.get("amountPending").invalid||s.hasError("invalidMinInstallmentPendingAmount")||s.hasError("invalidMaxInstallmentPendingAmount")?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",s.get("amountPending").touched)}}function ct(t,e){if(1&t&&(h.Wb(0,"div",61),h.Wb(1,"table",62),h.Wb(2,"thead"),h.Wb(3,"tr"),h.Wb(4,"th"),h.Cc(5,"Installment Number"),h.Vb(),h.Wb(6,"th"),h.Cc(7,"Installment Date"),h.Vb(),h.Wb(8,"th"),h.Cc(9,"Installment Amount"),h.Vb(),h.Wb(10,"th"),h.Cc(11,"Pending Amount after This Installment"),h.Vb(),h.Vb(),h.Vb(),h.Wb(12,"tbody"),h.Ac(13,dt,16,20,"ng-container",65),h.Vb(),h.Vb(),h.Vb()),2&t){var n=h.gc(2);h.Eb(13),h.mc("ngForOf",n.studentCourseInstallmentForm.get("installments").controls)}}function bt(t,e){1&t&&(h.Wb(0,"p",74),h.Cc(1," No Installments "),h.Vb())}function mt(t,e){if(1&t&&(h.Wb(0,"tr"),h.Wb(1,"td"),h.Cc(2),h.Vb(),h.Wb(3,"td"),h.Cc(4),h.Vb(),h.Wb(5,"td"),h.Cc(6),h.Vb(),h.Wb(7,"td"),h.Cc(8),h.Vb(),h.Vb()),2&t){var n=e.$implicit,s=h.gc(2);h.Eb(2),h.Ec("Installment ",n.value.installmentNo,""),h.Eb(2),h.Ec(" ",s.dateService.formatDate(n.value.installmentDate)," "),h.Eb(2),h.Dc(n.value.installmentAmount),h.Eb(2),h.Dc(n.value.amountPending)}}function gt(t,e){if(1&t){var n=h.Xb();h.Wb(0,"nb-card"),h.Wb(1,"nb-card-header"),h.Wb(2,"button",1),h.ec("click",(function(){return h.uc(n),h.gc().back()})),h.Cc(3," Back "),h.Vb(),h.Wb(4,"h3",2),h.Cc(5),h.Vb(),h.Vb(),h.Wb(6,"nb-card-body"),h.Wb(7,"nb-stepper",3,4),h.Wb(9,"nb-step",5),h.Wb(10,"form",6),h.ec("submit",(function(){return h.uc(n),h.gc().studentCourseFormSubmit()})),h.Wb(11,"div",7),h.Wb(12,"div",8),h.Wb(13,"div",9),h.Wb(14,"label",10),h.Cc(15,"Course:"),h.Vb(),h.Wb(16,"nb-select",11),h.ec("selectedChange",(function(t){return h.uc(n),h.gc().onSelectCourse(t)})),h.Wb(17,"nb-option",12),h.Cc(18,"Select Course"),h.Vb(),h.Ac(19,p,2,2,"nb-option",13),h.Vb(),h.Ac(20,F,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(21,"div",8),h.Wb(22,"div",9),h.Wb(23,"label",14),h.Cc(24,"Batch:"),h.Vb(),h.Wb(25,"nb-select",15),h.ec("selectedChange",(function(t){return h.uc(n),h.gc().onSelectBatch(t)})),h.Wb(26,"nb-option",12),h.Cc(27,"Select Batch"),h.Vb(),h.Ac(28,V,2,2,"nb-option",13),h.Vb(),h.Ac(29,A,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(30,"div",8),h.Wb(31,"div",9),h.Wb(32,"label",16),h.Cc(33,"Roll Number:"),h.Vb(),h.Wb(34,"input",17),h.ec("input",(function(){return h.uc(n),h.gc().checkRollNumber()})),h.Vb(),h.Ac(35,S,4,3,"ng-container",0),h.Vb(),h.Vb(),h.Wb(36,"div",8),h.Wb(37,"div",9),h.Wb(38,"label",18),h.Cc(39,"Discount/Offer:"),h.Vb(),h.Wb(40,"nb-select",19),h.ec("selectedChange",(function(t){return h.uc(n),h.gc().onSelectDiscount(t)})),h.Wb(41,"nb-option",12),h.Cc(42,"Select Discount"),h.Vb(),h.Ac(43,E,2,2,"nb-option",13),h.Vb(),h.Vb(),h.Vb(),h.Wb(44,"div",8),h.Wb(45,"div",9),h.Wb(46,"label",20),h.Cc(47,"Additional Discount Type:"),h.Vb(),h.Wb(48,"nb-select",21),h.ec("selectedChange",(function(){return h.uc(n),h.gc().changeAdditionalDiscountType()})),h.Ac(49,w,3,4,"nb-option",13),h.Vb(),h.Vb(),h.Vb(),h.Wb(50,"div",8),h.Wb(51,"div",9),h.Wb(52,"label",22),h.Cc(53,"Additional Discount Amount:"),h.Vb(),h.Wb(54,"input",23),h.ec("input",(function(t){return h.uc(n),h.gc().onAdditionalDiscountAmount(t.target.value)})),h.Vb(),h.Ac(55,P,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Wb(56,"div",24),h.Wb(57,"div",9),h.Wb(58,"label",25),h.Cc(59,"Activation Date:"),h.Vb(),h.Rb(60,"input",26),h.Ac(61,k,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(62,"div",24),h.Wb(63,"div",9),h.Wb(64,"label",27),h.Cc(65,"Net Payable:"),h.Vb(),h.Rb(66,"input",28),h.Ac(67,q,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Vb(),h.Rb(68,"hr"),h.Wb(69,"div",7),h.Wb(70,"div",29),h.Wb(71,"button",30),h.Wb(72,"span"),h.Cc(73,"Next"),h.Vb(),h.Rb(74,"nb-icon",31),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(75,"nb-step",32),h.Wb(76,"form",33),h.ec("ngSubmit",(function(){return h.uc(n),h.gc().studentCourseFeeFormSubmit()})),h.Wb(77,"div",7),h.Wb(78,"div",8),h.Wb(79,"div",9),h.Wb(80,"label",34),h.Cc(81,"Date:"),h.Vb(),h.Rb(82,"input",35),h.Ac(83,_,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(84,"div",8),h.Wb(85,"div",9),h.Wb(86,"label",36),h.Cc(87,"Installment Type:"),h.Vb(),h.Wb(88,"nb-select",37),h.ec("selectedChange",(function(t){return h.uc(n),h.gc().onSelectInstallmentType(t)})),h.Wb(89,"nb-option",38),h.Cc(90,"Pay Once"),h.Vb(),h.Wb(91,"nb-option",39),h.Cc(92,"Pay Twice"),h.Vb(),h.Wb(93,"nb-option",40),h.Cc(94,"Pay Quarterly"),h.Vb(),h.Wb(95,"nb-option",41),h.Cc(96,"Pay Monthly"),h.Vb(),h.Wb(97,"nb-option",42),h.Cc(98,"Pay Custom"),h.Vb(),h.Vb(),h.Ac(99,U,2,1,"ng-container",0),h.Vb(),h.Vb(),h.Wb(100,"div",8),h.Wb(101,"div",9),h.Wb(102,"label",43),h.Cc(103,"Number of Installments:"),h.Vb(),h.Wb(104,"input",44),h.ec("input",(function(t){return h.uc(n),h.gc().generateNoOfInstallments(t.target.value)})),h.Vb(),h.Ac(105,G,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Wb(106,"div",8),h.Wb(107,"div",9),h.Wb(108,"label",45),h.Cc(109,"Pending Amount:"),h.Vb(),h.Rb(110,"input",46),h.Ac(111,z,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Wb(112,"div",8),h.Wb(113,"div",9),h.Wb(114,"label",47),h.Cc(115,"Amount Collected:"),h.Vb(),h.Rb(116,"input",48),h.Ac(117,L,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Wb(118,"div",8),h.Wb(119,"div",9),h.Wb(120,"label",49),h.Cc(121,"Total Payable Amount:"),h.Vb(),h.Rb(122,"input",50),h.Ac(123,Y,3,2,"ng-container",0),h.Vb(),h.Vb(),h.Vb(),h.Rb(124,"hr"),h.Wb(125,"div",7),h.Wb(126,"div",51),h.Wb(127,"button",52),h.ec("click",(function(){return h.uc(n),h.gc().previousStep()})),h.Rb(128,"nb-icon",53),h.Wb(129,"span"),h.Cc(130,"prev"),h.Vb(),h.Vb(),h.Vb(),h.Wb(131,"div",54),h.Wb(132,"button",30),h.Wb(133,"span"),h.Cc(134,"Next"),h.Vb(),h.Rb(135,"nb-icon",31),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(136,"nb-step",55),h.Wb(137,"form",33),h.ec("ngSubmit",(function(){return h.uc(n),h.gc().studentCourseInstallmentFormSubmit()})),h.Wb(138,"div",7),h.Wb(139,"div",56),h.Ac(140,ct,14,1,"div",57),h.Ac(141,bt,2,0,"ng-template",null,58,h.Bc),h.Vb(),h.Vb(),h.Rb(143,"hr"),h.Wb(144,"div",7),h.Wb(145,"div",51),h.Wb(146,"button",52),h.ec("click",(function(){return h.uc(n),h.gc().previousStep()})),h.Rb(147,"nb-icon",53),h.Wb(148,"span"),h.Cc(149,"prev"),h.Vb(),h.Vb(),h.Vb(),h.Wb(150,"div",54),h.Wb(151,"button",30),h.Wb(152,"span"),h.Cc(153,"Next"),h.Vb(),h.Rb(154,"nb-icon",31),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(155,"nb-step",59),h.Wb(156,"div",60),h.Wb(157,"div",61),h.Wb(158,"table",62),h.Wb(159,"tbody"),h.Wb(160,"tr"),h.Wb(161,"th",63),h.Cc(162,"Course Details"),h.Vb(),h.Vb(),h.Wb(163,"tr"),h.Wb(164,"th"),h.Cc(165,"Course"),h.Vb(),h.Wb(166,"td"),h.Cc(167),h.Vb(),h.Vb(),h.Wb(168,"tr"),h.Wb(169,"th"),h.Cc(170,"Batch"),h.Vb(),h.Wb(171,"td"),h.Cc(172),h.Vb(),h.Vb(),h.Wb(173,"tr"),h.Wb(174,"th"),h.Cc(175,"Roll Number"),h.Vb(),h.Wb(176,"td"),h.Cc(177),h.Vb(),h.Vb(),h.Wb(178,"tr"),h.Wb(179,"th"),h.Cc(180,"Discount"),h.Vb(),h.Wb(181,"td"),h.Cc(182),h.Vb(),h.Vb(),h.Wb(183,"tr"),h.Wb(184,"th"),h.Cc(185,"Additional Discount"),h.Vb(),h.Wb(186,"td"),h.Cc(187),h.Vb(),h.Vb(),h.Wb(188,"tr"),h.Wb(189,"th"),h.Cc(190,"Net Payable"),h.Vb(),h.Wb(191,"td"),h.Cc(192),h.Vb(),h.Vb(),h.Wb(193,"tr"),h.Wb(194,"th"),h.Cc(195,"Activation Date"),h.Vb(),h.Wb(196,"td"),h.Cc(197),h.Vb(),h.Vb(),h.Wb(198,"tr"),h.Wb(199,"th",63),h.Cc(200,"Course Fee Details"),h.Vb(),h.Vb(),h.Wb(201,"tr"),h.Wb(202,"th"),h.Cc(203,"Date"),h.Vb(),h.Wb(204,"td"),h.Cc(205),h.Vb(),h.Vb(),h.Wb(206,"tr"),h.Wb(207,"th"),h.Cc(208,"Number of Installments"),h.Vb(),h.Wb(209,"td"),h.Cc(210),h.Vb(),h.Vb(),h.Wb(211,"tr"),h.Wb(212,"th"),h.Cc(213,"Amount Collected"),h.Vb(),h.Wb(214,"td"),h.Cc(215),h.Vb(),h.Vb(),h.Wb(216,"tr"),h.Wb(217,"th"),h.Cc(218,"Pending Amount"),h.Vb(),h.Wb(219,"td"),h.Cc(220),h.Vb(),h.Vb(),h.Wb(221,"tr"),h.Wb(222,"th"),h.Cc(223,"Total Payable Amount"),h.Vb(),h.Wb(224,"td"),h.Cc(225),h.Vb(),h.Vb(),h.Wb(226,"tr"),h.Wb(227,"th",63),h.Cc(228,"Installment Details"),h.Vb(),h.Vb(),h.Wb(229,"tr"),h.Wb(230,"td",63),h.Wb(231,"div",61),h.Wb(232,"table",64),h.Wb(233,"thead"),h.Wb(234,"tr"),h.Wb(235,"th"),h.Cc(236,"Installment No."),h.Vb(),h.Wb(237,"th"),h.Cc(238,"Installment Date"),h.Vb(),h.Wb(239,"th"),h.Cc(240,"Installment Amount"),h.Vb(),h.Wb(241,"th"),h.Cc(242,"Pending Amount after Installment"),h.Vb(),h.Vb(),h.Vb(),h.Wb(243,"tbody"),h.Ac(244,mt,9,4,"tr",65),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Rb(245,"hr"),h.Wb(246,"div",7),h.Wb(247,"div",51),h.Wb(248,"button",52),h.ec("click",(function(){return h.uc(n),h.gc().previousStep()})),h.Rb(249,"nb-icon",53),h.Wb(250,"span"),h.Cc(251,"prev"),h.Vb(),h.Vb(),h.Vb(),h.Wb(252,"div",54),h.Wb(253,"button",66),h.ec("click",(function(){return h.uc(n),h.gc().saveStudentCourse()})),h.Wb(254,"span"),h.Cc(255,"Submit"),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb()}if(2&t){var s=h.sc(142),u=h.gc();h.Eb(5),h.Ec(" ",u.studentCourse?"Edit Student Course":"New Student Course"," "),h.Eb(2),h.mc("linear",!0)("disableStepNavigation",!0),h.Eb(2),h.mc("stepControl",u.studentCourseForm),h.Eb(1),h.mc("formGroup",u.studentCourseForm),h.Eb(6),h.mc("status",u.studentCourseForm.get("course").touched?u.studentCourseForm.get("course").invalid?"danger":"success":"basic"),h.Eb(3),h.mc("ngForOf",u.courses),h.Eb(1),h.mc("ngIf",u.studentCourseForm.get("course").invalid&&u.studentCourseForm.get("course").touched),h.Eb(5),h.mc("status",u.studentCourseForm.get("batch").touched?u.studentCourseForm.get("batch").invalid?"danger":"success":"basic"),h.Eb(3),h.mc("ngForOf",u.courseBatches),h.Eb(1),h.mc("ngIf",u.studentCourseForm.get("batch").invalid&&u.studentCourseForm.get("batch").touched),h.Eb(5),h.mc("status",u.studentCourseForm.get("rollNumber").touched?u.studentCourseForm.get("rollNumber").invalid||u.rollNumberAlreadyExist?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",(u.studentCourseForm.get("rollNumber").invalid||u.rollNumberAlreadyExist)&&u.studentCourseForm.get("rollNumber").touched),h.Eb(8),h.mc("ngForOf",u.discounts),h.Eb(5),h.mc("selected",u.discountTypes.length>0?u.discountTypes[0]:""),h.Eb(1),h.mc("ngForOf",u.discountTypes),h.Eb(5),h.mc("status",u.studentCourseForm.get("additionalDiscountAmount").touched?u.studentCourseForm.get("additionalDiscountAmount").invalid||u.studentCourseForm.hasError("invalidDiscountPercentage")?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",u.studentCourseForm.get("additionalDiscountAmount").touched),h.Eb(5),h.mc("status",u.studentCourseForm.get("activationDate").invalid?"danger":"success"),h.Eb(1),h.mc("ngIf",u.studentCourseForm.get("activationDate").invalid),h.Eb(5),h.mc("status",u.studentCourseForm.get("netPayable").touched?u.studentCourseForm.get("netPayable").invalid?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",u.studentCourseForm.get("netPayable").invalid&&u.studentCourseForm.get("netPayable").touched),h.Eb(8),h.mc("stepControl",u.studentCourseFeeForm),h.Eb(1),h.mc("formGroup",u.studentCourseFeeForm),h.Eb(6),h.mc("status",u.studentCourseFeeForm.get("date").invalid?"danger":"success"),h.Eb(1),h.mc("ngIf",u.studentCourseFeeForm.get("date").invalid),h.Eb(5),h.mc("status",u.studentCourseFeeForm.get("installmentType").touched?u.studentCourseFeeForm.get("installmentType").invalid?"danger":"success":"basic"),h.Eb(11),h.mc("ngIf",u.studentCourseFeeForm.get("installmentType").invalid&&u.studentCourseFeeForm.get("installmentType").touched),h.Eb(5),h.mc("status",u.studentCourseFeeForm.get("noOfInstallments").touched?u.studentCourseFeeForm.get("noOfInstallments").invalid?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",u.studentCourseFeeForm.get("noOfInstallments").invalid&&u.studentCourseFeeForm.get("noOfInstallments").touched),h.Eb(5),h.mc("status",u.studentCourseFeeForm.get("pendingAmount").invalid?"danger":"success"),h.Eb(1),h.mc("ngIf",u.studentCourseFeeForm.get("pendingAmount").invalid),h.Eb(5),h.mc("status",u.studentCourseFeeForm.get("amountCollected").invalid?"danger":"success"),h.Eb(1),h.mc("ngIf",u.studentCourseFeeForm.get("amountCollected").invalid),h.Eb(5),h.mc("status",u.studentCourseFeeForm.get("totalAmount").invalid?"danger":"success"),h.Eb(1),h.mc("ngIf",u.studentCourseFeeForm.get("totalAmount").invalid),h.Eb(13),h.mc("stepControl",u.studentCourseInstallmentForm),h.Eb(1),h.mc("formGroup",u.studentCourseInstallmentForm),h.Eb(3),h.mc("ngIf",!!u.getNoOfInstallments()&&u.studentCourseInstallmentForm.get("installments").controls.length>0)("ngIfElse",s),h.Eb(27),h.Dc(u.getCourse(u.studentCourseForm.value.course)),h.Eb(5),h.Dc(u.getBatch(u.studentCourseForm.value.batch)),h.Eb(5),h.Dc(u.studentCourseForm.value.rollNumber),h.Eb(5),h.Dc(u.getDiscount(u.studentCourseForm.value.discount)),h.Eb(5),h.Ec(" ",u.studentCourseForm.value.additionalDiscountAmount?u.studentCourseForm.value.additionalDiscountAmount+("percentage"===u.studentCourseForm.value.additionalDiscountType?"%":""):"--"," "),h.Eb(5),h.Dc(u.studentCourseForm.value.netPayable),h.Eb(5),h.Dc(u.dateService.formatDate(u.studentCourseForm.value.activationDate)),h.Eb(8),h.Dc(u.dateService.formatDate(u.studentCourseFeeForm.value.date)),h.Eb(5),h.Dc(u.studentCourseFeeForm.getRawValue().noOfInstallments),h.Eb(5),h.Dc(u.studentCourseFeeForm.value.amountCollected),h.Eb(5),h.Dc(u.studentCourseFeeForm.value.pendingAmount),h.Eb(5),h.Dc(u.studentCourseFeeForm.value.totalAmount),h.Eb(19),h.mc("ngForOf",u.studentCourseInstallmentForm.get("installments").controls)}}var ht,Ct,ft=[{path:"",component:(ht=function(){function t(e,n,s,u,o,a,i,r,l,d,c){var b=this;_classCallCheck(this,t),this.dateService=e,this.toastrService=n,this.branchService=s,this.courseService=u,this.batchService=o,this.discountAndOfferService=a,this.studentService=i,this.studentCourseService=r,this.studentCourseInstallmentService=l,this.router=d,this.route=c,c.queryParams.subscribe((function(t){b.ngOnInit()}))}return _createClass(t,[{key:"ngOnInit",value:function(){var t,e=this;if(this.loading=!0,this.branchId=this.branchService.getBranchId(),this.categoryId=this.branchService.getCategoryId(),this.studentId=this.studentService.getStudentId(),this.branchId||this.categoryId||this.studentId)return this.studentCourseId=this.studentCourseService.getStudentCourseId(),this.route.queryParams.subscribe((function(e){t=e.mode})),t&&"edit"!==t?(this.showToastr("top-right","danger","Invalid Route"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):t&&!this.studentCourseId?(this.showToastr("top-right","danger","Student Course Not Found"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):(this.discounts=[],this.courses=[],this.batches=[],this.courseBatches=[],this.discountTypes=[],this.rollNumberAlreadyExist=!1,this.courseService.getCoursesData().subscribe((function(t){e.courses=t})),this.batchService.getBatchesData().subscribe((function(t){e.batches=t})),this.discountAndOfferService.getDiscountAndOffersData().subscribe((function(t){e.discounts=t})),this.discountTypes=this.discountAndOfferService.getDiscountTypes(),this.studentCourseForm=new s.f({course:new s.d("",{validators:[s.u.required]}),batch:new s.d("",{validators:[s.u.required]}),rollNumber:new s.d(null,{validators:[s.u.required,s.u.min(1)]}),discount:new s.d("",{validators:[]}),additionalDiscountType:new s.d(this.discountTypes.length>0?this.discountTypes[0]:"",{validators:[]}),additionalDiscountAmount:new s.d(0,{validators:[s.u.min(0)]}),activationDate:new s.d(this.dateService.getDateString(),{validators:[s.u.required]}),netPayable:new s.d(0,{validators:[s.u.required]})},{validators:this.discountPercentageValidator.bind(this)}),this.studentCourseFeeForm=new s.f({installmentType:new s.d("0",{validators:[s.u.required]}),date:new s.d(this.dateService.getDateString(),{validators:[s.u.required]}),noOfInstallments:new s.d(1,{validators:[s.u.required,s.u.min(1)]}),pendingAmount:new s.d(0,{validators:[s.u.required,s.u.min(0)]}),amountCollected:new s.d(0,{validators:[s.u.required,s.u.min(0)]}),totalAmount:new s.d(0,{validators:[s.u.required,s.u.min(0)]})}),this.studentCourseInstallmentForm=new s.f({installments:new s.b([])}),void(t&&this.studentId&&this.studentCourseId?this.studentCourseService.getStudentCourseForEditing(this.studentCourseId).subscribe((function(t){e.studentCourse=t.studentCourse,e.studentCourseInstallment=t.studentCourseInstallment,e.studentCourseForm.patchValue({course:e.studentCourse.course,activationDate:e.studentCourse.activationDate,rollNumber:e.studentCourse.rollNumber,discount:e.studentCourse.discount,additionalDiscountType:e.studentCourse.additionalDiscountType,additionalDiscountAmount:e.studentCourse.additionalDiscountAmount,netPayable:e.studentCourse.netPayable}),e.onSelectCourse(e.studentCourse.course),e.studentCourseForm.patchValue({batch:e.studentCourse.batch}),e.disableStudentCourseDetails(),e.studentCourseInstallment&&(e.studentCourseFeeForm.patchValue({installmentType:e.studentCourseInstallment.installmentType,date:e.studentCourseInstallment.date,noOfInstallments:e.studentCourseInstallment.noOfInstallments,amountCollected:e.studentCourseInstallment.amountCollected,pendingAmount:e.studentCourseInstallment.pendingAmount,totalAmount:e.studentCourseInstallment.totalAmount}),e.disableStudentCourseFeeForm(),e.resetStudentCourseInstallments(),e.studentCourseInstallment.installments.forEach((function(t,n){e.addStudentCourseInstallment(t)})),e.disableStudentCourseInstallmentFields()),e.loading=!1}),(function(t){e.showToastr("top-right","danger",t),e.back()})):this.loading=!1));this.router.navigate(["../"],{relativeTo:this.route})}},{key:"discountPercentageValidator",value:function(t){var e=t.getRawValue().additionalDiscountType,n=+t.getRawValue().additionalDiscountAmount;return"percentage"===e&&n>100?{invalidDiscountPercentage:!0}:null}},{key:"checkRollNumber",value:function(){var t=this,e=this.studentCourseForm.getRawValue().rollNumber.toString(),n=this.studentCourseForm.getRawValue().batch;if(e){if(this.studentCourse&&this.studentCourse.batch===n&&this.studentCourse.rollNumber===e)return;var s=this.studentCourseForm.getRawValue().course;s&&n&&this.studentCourseService.checkBatchRollNumber(this.branchId,this.categoryId,s,n,e).subscribe((function(e){t.rollNumberAlreadyExist=e.rollNumberExist}),(function(t){}))}}},{key:"onSelectCourse",value:function(t){this.studentCourseForm.patchValue({batch:""}),this.courseBatches=[],this.courseBatches=this.batches.filter((function(e){return e.course===t})),this.course=this.courses.find((function(e){return e._id===t})),this.calculateNetPayableAmount()}},{key:"onSelectBatch",value:function(t){""!==t?(this.studentCourseForm.get("rollNumber").enable(),this.batch=this.batches.find((function(e){return e._id===t})),this.checkRollNumber()):this.studentCourseForm.get("rollNumber").disable()}},{key:"onSelectDiscount",value:function(t){this.discount=this.discounts.find((function(e){return e._id===t})),this.calculateNetPayableAmount()}},{key:"onAdditionalDiscountAmount",value:function(t){t>=0&&this.calculateNetPayableAmount()}},{key:"changeAdditionalDiscountType",value:function(){this.studentCourseForm.patchValue({additionalDiscount:0}),this.calculateNetPayableAmount()}},{key:"calculateNetPayableAmount",value:function(){var t=0,e=0,n=0,s=this.course?+this.course.feeDetails.totalFees:0,u=this.discount?this.discount.discountType:"",o=this.studentCourseForm.getRawValue().additionalDiscountType,a=this.discount?+this.discount.discountAmount:0,i=+this.studentCourseForm.getRawValue().additionalDiscountAmount;if(this.course&&s){this.discount&&u&&("percentage"===u?e+=a:n+=a),i&&("percentage"===o?e+=i:n+=i),t=s-n-e/100*s,this.studentCourseForm.patchValue({netPayable:t}),this.studentCourseFeeForm.patchValue({totalAmount:t}),this.calculatePendingAmount();var r=this.studentCourseFeeForm.getRawValue().installmentType;this.onSelectInstallmentType(r)}}},{key:"calculatePendingAmount",value:function(){var t;t=+this.studentCourseFeeForm.getRawValue().totalAmount-(this.studentCourseFeeForm.getRawValue().amountCollected||0),this.studentCourseFeeForm.patchValue({pendingAmount:t})}},{key:"enableStudentCourseDetails",value:function(){this.studentCourseForm.get("course").enable(),this.studentCourseForm.get("discount").enable(),this.studentCourseForm.get("additionalDiscountType").enable(),this.studentCourseForm.get("additionalDiscountAmount").enable()}},{key:"disableStudentCourseDetails",value:function(){this.studentCourseForm.get("course").disable(),this.studentCourseForm.get("discount").disable(),this.studentCourseForm.get("additionalDiscountType").disable(),this.studentCourseForm.get("additionalDiscountAmount").disable()}},{key:"enableStudentCourseFeeForm",value:function(){this.studentCourseFeeForm.get("installmentType").enable(),this.studentCourseFeeForm.get("noOfInstallments").enable()}},{key:"disableStudentCourseFeeForm",value:function(){this.studentCourseFeeForm.get("installmentType").disable(),this.studentCourseFeeForm.get("noOfInstallments").disable()}},{key:"getStudentCourseInstallments",value:function(){return this.studentCourseInstallmentForm.get("installments").controls}},{key:"resetStudentCourseInstallments",value:function(){this.studentCourseInstallmentForm.get("installments").controls=[]}},{key:"newStudentCourseInstallment",value:function(t){return new s.f({_id:new s.d(t._id?t._id:(new m.a).toString(),{validators:[s.u.required]}),installmentNo:new s.d(t.installmentNo?t.installmentNo:null,{validators:[s.u.required]}),installmentDate:new s.d(t.installmentDate?t.installmentDate:null,{validators:[s.u.required]}),installmentAmount:new s.d(t.installmentAmount?t.installmentAmount:0,{validators:[s.u.required]}),amountPending:new s.d(t.installmentAmount?t.amountPending:0,{validators:[s.u.required]}),receiptId:new s.d(t.receiptId?t.receiptId:null,{validators:[]}),status:new s.d(!t.status||t.status,{validators:[]})},{validators:[this.minInstallmentAmountValidator.bind(this),this.maxInstallmentAmountValidator.bind(this),this.minInstallmentPendingAmountValidator.bind(this),this.maxInstallmentPendingAmountValidator.bind(this)]})}},{key:"minInstallmentAmountValidator",value:function(t){var e=+t.getRawValue().installmentNo;return+t.getRawValue().installmentAmount<this.getMinInstallmentAmount(e-1)?{invalidMinInstallmentAmount:!0}:null}},{key:"maxInstallmentAmountValidator",value:function(t){var e=+t.getRawValue().installmentNo;return+t.getRawValue().installmentAmount>this.getMaxInstallmentAmount(e-1)?{invalidMaxInstallmentAmount:!0}:null}},{key:"minInstallmentPendingAmountValidator",value:function(t){var e=+t.getRawValue().installmentNo;return+t.getRawValue().amountPending<this.getMinInstallmentPendingAmount(e-1)?{invalidMinInstallmentPendingAmount:!0}:null}},{key:"maxInstallmentPendingAmountValidator",value:function(t){var e=+t.getRawValue().installmentNo;return+t.getRawValue().amountPending>this.getMaxInstallmentPendingAmount(e-1)?{invalidMinInstallmentPendingAmount:!0}:null}},{key:"addStudentCourseInstallment",value:function(t){this.getStudentCourseInstallments().push(this.newStudentCourseInstallment(t))}},{key:"onSelectInstallmentType",value:function(t){if(this.studentCourseFeeForm.patchValue({amountCollected:0}),"0"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(1);else if("1"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(2);else if("2"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(4);else if("3"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(this.course.basicDetails.duration);else{this.studentCourseFeeForm.get("noOfInstallments").enable();var e=this.studentCourseFeeForm.getRawValue().noOfInstallments;this.generateNoOfInstallments(e)}}},{key:"generateNoOfInstallments",value:function(t){if(t){t=t>0?t:3,this.studentCourseFeeForm.patchValue({amountCollected:0}),this.studentCourseFeeForm.patchValue({noOfInstallments:t});var e=+this.course.basicDetails.duration/t,n=this.studentCourseFeeForm.getRawValue().date,s=+this.studentCourseForm.getRawValue().netPayable/t,u=+this.studentCourseFeeForm.getRawValue().pendingAmount;this.resetStudentCourseInstallments();for(var o=0;o<t;o++){var a=this.dateService.millisecondsToDateString(this.dateService.dateToMilliseconds(n)+e*o*2592e6),i=u-+s*(o+1);i=i<0?0:i;var r={_id:new m.a,installmentNo:(o+1).toString(),installmentDate:a,installmentAmount:Math.ceil(s),amountPending:Math.ceil(i),receiptId:null,status:!0};this.addStudentCourseInstallment(r)}"4"===this.studentCourseFeeForm.getRawValue().installmentType?this.enableStudentCourseInstallmentFields():this.disableStudentCourseInstallmentFields()}}},{key:"customInstallmentAmount",value:function(t,e){if(!(!t||t<this.getMinInstallmentAmount(e)||t>this.getMaxInstallmentAmount(e))){var n=this.getStudentCourseInstallments(),s=this.getNoOfInstallments(),u=(0===e?this.studentCourseFeeForm.getRawValue().totalAmount:n[e-1].getRawValue().amountPending)-t;n[e].patchValue({amountPending:u});var o=s-(e+1)>0?s-(e+1):1,a=Math.ceil(u/o);if(e!==s-1)for(var i=0;i<o;i++){var r=u-+a*(i+1);r=r<0?0:r;var l=e+i+1;l===s-1&&this.getMaxInstallmentAmount(l)<a&&(a=this.getMaxInstallmentAmount(l)),n[l].patchValue({installmentAmount:a,amountPending:r})}}}},{key:"getMinInstallmentDate",value:function(t){var e=this.getStudentCourseInstallments();return 0===t?this.studentCourseFeeForm.getRawValue().date:e[t-1].getRawValue().installmentDate}},{key:"getMaxInstallmentDate",value:function(t){var e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&1===n?this.studentCourseFeeForm.getRawValue().date:t===n-1?this.dateService.millisecondsToDateString(this.dateService.dateToMilliseconds(this.studentCourseFeeForm.getRawValue().date)+2592e6*this.course.basicDetails.duration):e[t+1].getRawValue().installmentDate}},{key:"getMinInstallmentAmount",value:function(t){var e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&1===n?this.studentCourseFeeForm.getRawValue().totalAmount:0===t&&n>1?1:t===n-1?e[t-1].getRawValue().amountPending:1}},{key:"getMaxInstallmentAmount",value:function(t){var e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?this.studentCourseFeeForm.getRawValue().totalAmount:e[t-1].getRawValue().amountPending}},{key:"getMinInstallmentPendingAmount",value:function(t){var e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?0:t===n-1?0:e[t]?e[t-1].getRawValue().amountPending-e[t].getRawValue().installmentAmount:0}},{key:"getMaxInstallmentPendingAmount",value:function(t){var e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?this.studentCourseFeeForm.getRawValue().totalAmount:t===n-1?0:e[t]?e[t-1].getRawValue().amountPending-e[t].getRawValue().installmentAmount+1:void 0}},{key:"getNoOfInstallments",value:function(){return+this.studentCourseFeeForm.getRawValue().noOfInstallments}},{key:"enableStudentCourseInstallmentFields",value:function(){this.getStudentCourseInstallments().forEach((function(t){t.get("installmentAmount").enable()}))}},{key:"disableStudentCourseInstallmentFields",value:function(){this.getStudentCourseInstallments().forEach((function(t){t.get("installmentAmount").disable()}))}},{key:"previousStep",value:function(){this.studentCourse&&this.disableStudentCourseDetails();var t=this.studentCourseFeeForm.getRawValue().installmentType;this.studentCourseInstallment?this.disableStudentCourseInstallmentFields():"4"!==t&&this.disableStudentCourseInstallmentFields(),this.stepper.previous()}},{key:"studentCourseFormSubmit",value:function(){this.studentCourseForm.markAllAsTouched(),this.rollNumberAlreadyExist?this.showToastr("top-right","danger","Student Roll Number for this Batch already Exist"):this.studentCourseForm.invalid?this.showToastr("top-right","danger","Student Course Details are Required"):(this.studentCourse&&this.enableStudentCourseDetails(),this.stepper.next())}},{key:"studentCourseFeeFormSubmit",value:function(){this.studentCourseFeeForm.markAllAsTouched(),this.studentCourseFeeForm.invalid?this.showToastr("top-right","danger","Student Course Fee Details are Required"):this.stepper.next()}},{key:"studentCourseInstallmentFormSubmit",value:function(){this.studentCourseInstallmentForm.markAllAsTouched(),this.studentCourseInstallmentForm.invalid?this.showToastr("top-right","danger","Student Course Installment Details are Required"):this.validateStudentCourseInstallmentForm()?(this.enableStudentCourseInstallmentFields(),this.stepper.next()):this.showToastr("top-right","danger","Student Course Installment Details are Required")}},{key:"validateStudentCourseInstallmentForm",value:function(){var t=this.getStudentCourseInstallments(),e=!1;return t.forEach((function(t,n){t.invalid&&(e=!0)})),!e}},{key:"saveStudentCourse",value:function(){var t=this;if(this.studentCourseForm.markAllAsTouched(),this.studentCourseFeeForm.markAllAsTouched(),this.studentCourseInstallmentForm.markAllAsTouched(),this.rollNumberAlreadyExist)this.showToastr("top-right","danger","Student Roll Number for this Batch already Exist");else if(this.studentCourseForm.invalid)this.showToastr("top-right","danger","Student Course Details are Required");else if(this.studentCourseFeeForm.invalid)this.showToastr("top-right","danger","Student Course Fee Details are Required");else if(this.studentCourseInstallmentForm.invalid)this.showToastr("top-right","danger","Student Course Installment Details are Required");else if(this.validateStudentCourseInstallmentForm()){this.loading=!0;var e=this.studentCourseForm.getRawValue();e.branch=this.branchId,e.category=this.categoryId,e.student=this.studentId;var n=this.studentCourseFeeForm.getRawValue();n.installments=this.studentCourseInstallmentForm.getRawValue().installments,n.branch=this.branchId,n.category=this.categoryId,n.course=e.course,n.student=this.studentId,this.studentCourse||this.studentCourseInstallment?this.studentCourse&&!this.studentCourseInstallment?this.studentCourseInstallmentService.addStudentCourseInstallment(this.studentCourse._id,n).subscribe((function(e){t.showToastr("top-right","success","Student Course Installments Created Successfully!"),t.back(),t.loading=!1}),(function(e){t.showToastr("top-right","danger",e),t.loading=!1})):(e._id=this.studentCourse._id,n._id=this.studentCourseInstallment._id,this.studentCourseService.editStudentCourse(e,n).subscribe((function(e){t.showToastr("top-right","success","Student Course Updated Successfully!"),t.back(),t.loading=!1}),(function(e){t.showToastr("top-right","danger",e),t.loading=!1}))):this.studentCourseService.addStudentCourse(e,n).subscribe((function(e){t.showToastr("top-right","success","Student Course Created Successfully!"),t.back(),t.loading=!1}),(function(e){t.showToastr("top-right","danger",e),t.loading=!1})),this.loading=!1}else this.showToastr("top-right","danger","Student Course Installment Details are Required")}},{key:"showToastr",value:function(t,e,n){this.toastrService.show(e,n,{position:t,status:e})}},{key:"getCourse",value:function(t){var e=this.courses.find((function(e){return e._id===t}));return e?e.basicDetails.courseName:"--"}},{key:"getBatch",value:function(t){var e=this.batches.find((function(e){return e._id===t}));return e?e.basicDetails.batchName:"--"}},{key:"getDiscount",value:function(t){var e=this.discounts.find((function(e){return e._id===t}));return e?e.offerName+" ("+e.code+" - "+e.discountAmount+("percentage"===e.discountType?"%":".00")+")":"--"}},{key:"back",value:function(){this.router.navigate(["../"],{relativeTo:this.route})}},{key:"ngOnDestroy",value:function(){}}]),t}(),ht.\u0275fac=function(t){return new(t||ht)(h.Qb(l.a),h.Qb(u.xb),h.Qb(c.a),h.Qb(a.a),h.Qb(i.a),h.Qb(g.a),h.Qb(d.a),h.Qb(r.a),h.Qb(b.a),h.Qb(C.c),h.Qb(C.a))},ht.\u0275cmp=h.Kb({type:ht,selectors:[["ngx-add-student-course"]],viewQuery:function(t,e){var n;1&t&&h.Hc(f,!0),2&t&&h.rc(n=h.fc())&&(e.stepper=n.first)},decls:1,vars:1,consts:[[4,"ngIf"],["type","button","nbButton","","status","warning","size","tiny",1,"float-right",3,"click"],[1,""],[3,"linear","disableStepNavigation"],["stepper",""],["label","Course Details",3,"stepControl"],[1,"",3,"formGroup","submit"],[1,"row"],[1,"col-md-4"],[1,"form-control-group"],["for","input-student-course",1,"label"],["id","input-student-course","name","course","formControlName","course","placeholder","Select Course","fullWidth","",3,"status","selectedChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","input-student-batch",1,"label"],["id","input-student-batch","name","batch","formControlName","batch","placeholder","Select Batch","fullWidth","",3,"status","selectedChange"],["for","input-roll-number",1,"label"],["type","number","nbInput","","id","input-roll-number","name","rollNumber","formControlName","rollNumber","min","1","placeholder","Roll Number","fullWidth","",3,"status","input"],["for","input-student-discount",1,"label"],["id","input-student-discount","name","discount","formControlName","discount","placeholder","Select Discount","fullWidth","",3,"selectedChange"],["for","input-additional-discount-type",1,"label"],["id","input-additional-discount-type","name","additionalDiscountType","formControlName","additionalDiscountType","placeholder","Select Discount Type","fullWidth","",3,"selected","selectedChange"],["for","input-discount-amount",1,"label"],["type","number","nbInput","","id","input-discount-amount","name","additionalDiscountAmount","formControlName","additionalDiscountAmount","placeholder","Discount Amount","min","0","fullWidth","",3,"status","input"],[1,"col-md-6"],["for","input-activation-date",1,"label"],["type","date","nbInput","","id","input-activation-date","name","activationDate","formControlName","activationDate","placeholder","Activation Date","fullWidth","",3,"status"],["for","input-net-payable",1,"label"],["type","number","nbInput","","id","input-net-payable","name","netPayable","formControlName","netPayable","placeholder","Net Payable","min","0","fullWidth","","disabled","true",3,"status"],[1,"col-md-12","text-right"],["nbButton","","type","submit"],["icon","arrow-ios-forward-outline"],["label","Course Fee Details",3,"stepControl"],[1,"step-container",3,"formGroup","ngSubmit"],["for","input-date",1,"label"],["type","date","nbInput","","id","input-date","name","date","formControlName","date","placeholder","Date","fullWidth","",3,"status"],["for","input-course-installment-type",1,"label"],["id","input-course-installment-type","name","installmentType","formControlName","installmentType","placeholder","Select Installment Type","fullWidth","",3,"status","selectedChange"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["for","input-noOfInstallments",1,"label"],["type","number","nbInput","","id","input-noOfInstallments","name","noOfInstallments","formControlName","noOfInstallments","placeholder","Number of Installments","min","0","fullWidth","",3,"status","input"],["for","input-pendingAmount",1,"label"],["type","number","nbInput","","id","input-pendingAmount","name","pendingAmount","formControlName","pendingAmount","placeholder","Pending Amount","min","0","fullWidth","","disabled","true",3,"status"],["for","input-amountCollected",1,"label"],["type","number","nbInput","","id","input-amountCollected","name","amountCollected","formControlName","amountCollected","placeholder","Amount Collected","min","0","fullWidth","","disabled","true",3,"status"],["for","input-totalAmount",1,"label"],["type","number","nbInput","","id","input-totalAmount","name","totalAmount","formControlName","totalAmount","placeholder","Total Amount","min","0","fullWidth","","disabled","true",3,"status"],[1,"col-md-6","text-left"],["type","button","nbButton","",1,"",3,"click"],["icon","arrow-ios-back-outline"],[1,"col-md-6","text-right"],["label","Installment Details",3,"stepControl"],[1,"col-md-12"],["class","table-responsive",4,"ngIf","ngIfElse"],["noInstallments",""],["label","Submit"],[1,"step-container"],[1,"table-responsive"],[1,"table","table-bordered"],["colspan","2"],[1,"table","table-sm","table-bordered"],[4,"ngFor","ngForOf"],["nbButton","",3,"click"],[3,"value"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],[3,"formGroup"],["type","date","nbInput","","formControlName","installmentDate","placeholder","Installment Date","fullWidth","",3,"id","name","min","max","status"],["type","number","nbInput","","formControlName","installmentAmount","placeholder","Installment Amount","fullWidth","",3,"id","name","min","max","status","input"],["type","number","nbInput","","formControlName","amountPending","placeholder","Pending Amount","fullWidth","","disabled","true",3,"id","name","min","max","status"],[1,"mt-4","text-center"]],template:function(t,e){1&t&&h.Ac(0,gt,256,53,"nb-card",0),2&t&&h.mc("ngIf",!e.loading)},directives:[o.n,u.x,u.z,u.u,u.w,u.pb,u.ob,s.v,s.n,s.g,u.jb,s.m,s.e,u.eb,o.m,s.q,u.O,s.a,u.L],pipes:[o.v],styles:[""]}),ht)},{path:"page-not-found",loadChildren:function(){return n.e(0).then(n.bind(null,"DeSt")).then((function(t){return t.PageNotFoundModule}))}},{path:"**",redirectTo:"page-not-found",pathMatch:"full"}],pt=((Ct=function t(){_classCallCheck(this,t)}).\u0275mod=h.Ob({type:Ct}),Ct.\u0275inj=h.Nb({factory:function(t){return new(t||Ct)},imports:[[C.g.forChild(ft)],C.g]}),Ct);n.d(e,"AddStudentCourseModule",(function(){return Ft}));var vt,Ft=((vt=function t(){_classCallCheck(this,t)}).\u0275mod=h.Ob({type:vt}),vt.\u0275inj=h.Nb({factory:function(t){return new(t||vt)},imports:[[o.c,pt,u.A,u.N,u.v,u.P,u.qb,u.D,u.K,u.kb,s.s]]}),vt)}}]);