(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{QTuy:function(t,e,n){"use strict";n.r(e);var s=n("3Pt+"),o=n("aceb"),u=n("ofXK"),i=n("IAlr"),a=n("lst6"),r=n("W14u"),l=n("ZatZ"),d=n("JmRu"),c=n("EQut"),b=n("qsE9"),m=n("no5z"),h=n("5V5q"),g=n("fXoL"),C=n("tyNb");const p=["stepper"];function f(t,e){if(1&t&&(g.Wb(0,"nb-option",67),g.Cc(1),g.Vb()),2&t){const t=e.$implicit;g.mc("value",t._id),g.Eb(1),g.Dc(t.basicDetails.courseName)}}function F(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Student Course is required! "),g.Vb())}function V(t,e){if(1&t&&(g.Ub(0),g.Ac(1,F,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("course").errors?null:t.studentCourseForm.get("course").errors.required)}}function I(t,e){if(1&t&&(g.Wb(0,"nb-option",67),g.Cc(1),g.Vb()),2&t){const t=e.$implicit;g.mc("value",t._id),g.Eb(1),g.Dc(t.basicDetails.batchName)}}function v(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Student Batch is required! "),g.Vb())}function A(t,e){if(1&t&&(g.Ub(0),g.Ac(1,v,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("batch").errors?null:t.studentCourseForm.get("batch").errors.required)}}function W(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Roll Number is required! "),g.Vb())}function D(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Roll Number should be greater than 0 "),g.Vb())}function S(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," This roll number already Exist! "),g.Vb())}function E(t,e){if(1&t&&(g.Ub(0),g.Ac(1,W,2,0,"p",68),g.Ac(2,D,2,0,"p",68),g.Ac(3,S,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("rollNumber").errors?null:t.studentCourseForm.get("rollNumber").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("rollNumber").errors?null:t.studentCourseForm.get("rollNumber").errors.min),g.Eb(1),g.mc("ngIf",t.rollNumberAlreadyExist)}}function y(t,e){if(1&t&&(g.Wb(0,"nb-option",67),g.Cc(1),g.Vb()),2&t){const t=e.$implicit,n=g.gc(2);g.mc("value",t._id),g.Eb(1),g.Dc(n.getDiscount(t._id))}}function w(t,e){if(1&t&&(g.Wb(0,"nb-option",67),g.Cc(1),g.hc(2,"uppercase"),g.Vb()),2&t){const t=e.$implicit;g.mc("value",t),g.Eb(1),g.Dc(g.ic(2,2,t))}}function N(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Discount Amount should be more than or equal to 0 "),g.Vb())}function T(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Discount Percentage should be between 0% to 100% "),g.Vb())}function P(t,e){if(1&t&&(g.Ub(0),g.Ac(1,N,2,0,"p",68),g.Ac(2,T,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("additionalDiscountAmount").errors?null:t.studentCourseForm.get("additionalDiscountAmount").errors.min),g.Eb(1),g.mc("ngIf",t.studentCourseForm.hasError("invalidDiscountPercentage"))}}function R(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Activation date is required "),g.Vb())}function x(t,e){if(1&t&&(g.Ub(0),g.Ac(1,R,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("activationDate").errors?null:t.studentCourseForm.get("activationDate").errors.required)}}function O(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Net Payable Amount is Required "),g.Vb())}function q(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Net Payable Amount should be greater than 0 "),g.Vb())}function M(t,e){if(1&t&&(g.Ub(0),g.Ac(1,O,2,0,"p",68),g.Ac(2,q,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("netPayable").errors?null:t.studentCourseForm.get("netPayable").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseForm.get("netPayable").errors?null:t.studentCourseForm.get("netPayable").errors.min)}}function k(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Date is required "),g.Vb())}function B(t,e){if(1&t&&(g.Ub(0),g.Ac(1,k,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("date").errors?null:t.studentCourseFeeForm.get("date").errors.required)}}function _(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Student Course is required! "),g.Vb())}function U(t,e){if(1&t&&(g.Ub(0),g.Ac(1,_,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("installmentType").errors?null:t.studentCourseFeeForm.get("installmentType").errors.required)}}function Q(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Number of Installments are Required "),g.Vb())}function $(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Number of Installments should be greater than 0 "),g.Vb())}function G(t,e){if(1&t&&(g.Ub(0),g.Ac(1,Q,2,0,"p",68),g.Ac(2,$,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("noOfInstallments").errors?null:t.studentCourseFeeForm.get("noOfInstallments").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("noOfInstallments").errors?null:t.studentCourseFeeForm.get("noOfInstallments").errors.min)}}function X(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Pending Amount is Required "),g.Vb())}function j(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Pending Amount should be greater than 0 "),g.Vb())}function z(t,e){if(1&t&&(g.Ub(0),g.Ac(1,X,2,0,"p",68),g.Ac(2,j,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("pendingAmount").errors?null:t.studentCourseFeeForm.get("pendingAmount").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("pendingAmount").errors?null:t.studentCourseFeeForm.get("pendingAmount").errors.min)}}function J(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Collected Amount is Required "),g.Vb())}function K(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Collected Amount should be greater than 0 "),g.Vb())}function L(t,e){if(1&t&&(g.Ub(0),g.Ac(1,J,2,0,"p",68),g.Ac(2,K,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("amountCollected").errors?null:t.studentCourseFeeForm.get("amountCollected").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("amountCollected").errors?null:t.studentCourseFeeForm.get("amountCollected").errors.min)}}function Z(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Total Amount is Required "),g.Vb())}function H(t,e){1&t&&(g.Wb(0,"p",69),g.Cc(1," Total Amount should be greater than 0 "),g.Vb())}function Y(t,e){if(1&t&&(g.Ub(0),g.Ac(1,Z,2,0,"p",68),g.Ac(2,H,2,0,"p",68),g.Tb()),2&t){const t=g.gc(2);g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("totalAmount").errors?null:t.studentCourseFeeForm.get("totalAmount").errors.required),g.Eb(1),g.mc("ngIf",null==t.studentCourseFeeForm.get("totalAmount").errors?null:t.studentCourseFeeForm.get("totalAmount").errors.min)}}function tt(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index;g.Eb(1),g.Ec(" Installment ",t+1," Date is required ")}}function et(t,e){if(1&t&&(g.Ub(0),g.Ac(1,tt,2,1,"p",68),g.Tb()),2&t){const t=g.gc().$implicit;g.Eb(1),g.mc("ngIf",null==t.get("installmentDate").errors?null:t.get("installmentDate").errors.required)}}function nt(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index;g.Eb(1),g.Ec(" Installment ",t+1," Amount is Required ")}}function st(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index,e=g.gc(3);g.Eb(1),g.Fc(" Installment ",t+1," Amount should be Minimum ",e.getMinInstallmentAmount(t)," ")}}function ot(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index,e=g.gc(3);g.Eb(1),g.Fc(" Installment ",t+1," Amount should be Maximum ",e.getMaxInstallmentAmount(t)," ")}}function ut(t,e){if(1&t&&(g.Ub(0),g.Ac(1,nt,2,1,"p",68),g.Ac(2,st,2,2,"p",68),g.Ac(3,ot,2,2,"p",68),g.Tb()),2&t){const t=g.gc().$implicit;g.Eb(1),g.mc("ngIf",null==t.get("installmentAmount").errors?null:t.get("installmentAmount").errors.required),g.Eb(1),g.mc("ngIf",t.hasError("invalidMinInstallmentAmount")),g.Eb(1),g.mc("ngIf",t.hasError("invalidMaxInstallmentAmount"))}}function it(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index;g.Eb(1),g.Ec(" Installment ",t+1," Pending Amount is Required ")}}function at(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index,e=g.gc(3);g.Eb(1),g.Fc(" Installment ",t+1," Pending Amount should be Minimum ",e.getMinInstallmentPendingAmount(t)," ")}}function rt(t,e){if(1&t&&(g.Wb(0,"p",69),g.Cc(1),g.Vb()),2&t){const t=g.gc(2).index,e=g.gc(3);g.Eb(1),g.Fc(" Installment ",t+1," Pending Amount should be Maximum ",e.getMaxInstallmentPendingAmount(t)," ")}}function lt(t,e){if(1&t&&(g.Ub(0),g.Ac(1,it,2,1,"p",68),g.Ac(2,at,2,2,"p",68),g.Ac(3,rt,2,2,"p",68),g.Tb()),2&t){const t=g.gc().$implicit;g.Eb(1),g.mc("ngIf",null==t.get("amountPending").errors?null:t.get("amountPending").errors.required),g.Eb(1),g.mc("ngIf",t.hasError("invalidMinInstallmentPendingAmount")),g.Eb(1),g.mc("ngIf",t.hasError("invalidMaxInstallmentPendingAmount"))}}function dt(t,e){if(1&t){const t=g.Xb();g.Ub(0),g.Wb(1,"tr",70),g.Wb(2,"td"),g.Cc(3),g.Vb(),g.Wb(4,"td"),g.Wb(5,"div",9),g.Rb(6,"input",71),g.Ac(7,et,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(8,"td"),g.Wb(9,"div",9),g.Wb(10,"input",72),g.ec("input",(function(n){g.uc(t);const s=e.index;return g.gc(3).customInstallmentAmount(n.target.value,s)})),g.Vb(),g.Ac(11,ut,4,3,"ng-container",0),g.Vb(),g.Vb(),g.Wb(12,"td"),g.Wb(13,"div",9),g.Rb(14,"input",73),g.Ac(15,lt,4,3,"ng-container",0),g.Vb(),g.Vb(),g.Vb(),g.Tb()}if(2&t){const t=e.$implicit,n=e.index,s=g.gc(3);g.Eb(1),g.mc("formGroup",t),g.Eb(2),g.Ec("Installment ",t.value.installmentNo,""),g.Eb(3),g.oc("id","input-installmentDate-",n,""),g.oc("name","installmentDate-",n,""),g.mc("min",s.getMinInstallmentDate(n))("max",s.getMaxInstallmentDate(n))("status",t.get("installmentDate").touched?t.get("installmentDate").invalid?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",t.get("installmentDate").touched&&t.get("installmentDate").invalid),g.Eb(3),g.oc("id","input-installmentAmount-",n,""),g.oc("name","installmentAmount-",n,""),g.mc("min",s.getMinInstallmentAmount(n))("max",s.getMaxInstallmentAmount(n))("status",t.get("installmentAmount").touched?t.get("installmentAmount").invalid||t.hasError("invalidMinInstallmentAmount")||t.hasError("invalidMaxInstallmentAmount")?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",t.get("installmentAmount").touched),g.Eb(3),g.oc("id","input-amountPending-",n,""),g.oc("name","amountPending-",n,""),g.mc("min",s.getMinInstallmentPendingAmount(n))("max",s.getMaxInstallmentPendingAmount(n))("status",t.get("amountPending").touched?t.get("amountPending").invalid||t.hasError("invalidMinInstallmentPendingAmount")||t.hasError("invalidMaxInstallmentPendingAmount")?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",t.get("amountPending").touched)}}function ct(t,e){if(1&t&&(g.Wb(0,"div",61),g.Wb(1,"table",62),g.Wb(2,"thead"),g.Wb(3,"tr"),g.Wb(4,"th"),g.Cc(5,"Installment Number"),g.Vb(),g.Wb(6,"th"),g.Cc(7,"Installment Date"),g.Vb(),g.Wb(8,"th"),g.Cc(9,"Installment Amount"),g.Vb(),g.Wb(10,"th"),g.Cc(11,"Pending Amount after This Installment"),g.Vb(),g.Vb(),g.Vb(),g.Wb(12,"tbody"),g.Ac(13,dt,16,20,"ng-container",65),g.Vb(),g.Vb(),g.Vb()),2&t){const t=g.gc(2);g.Eb(13),g.mc("ngForOf",t.studentCourseInstallmentForm.get("installments").controls)}}function bt(t,e){1&t&&(g.Wb(0,"p",74),g.Cc(1," No Installments "),g.Vb())}function mt(t,e){if(1&t&&(g.Wb(0,"tr"),g.Wb(1,"td"),g.Cc(2),g.Vb(),g.Wb(3,"td"),g.Cc(4),g.Vb(),g.Wb(5,"td"),g.Cc(6),g.Vb(),g.Wb(7,"td"),g.Cc(8),g.Vb(),g.Vb()),2&t){const t=e.$implicit,n=g.gc(2);g.Eb(2),g.Ec("Installment ",t.value.installmentNo,""),g.Eb(2),g.Ec(" ",n.dateService.formatDate(t.value.installmentDate)," "),g.Eb(2),g.Dc(t.value.installmentAmount),g.Eb(2),g.Dc(t.value.amountPending)}}function ht(t,e){if(1&t){const t=g.Xb();g.Wb(0,"nb-card"),g.Wb(1,"nb-card-header"),g.Wb(2,"button",1),g.ec("click",(function(){return g.uc(t),g.gc().back()})),g.Cc(3," Back "),g.Vb(),g.Wb(4,"h3",2),g.Cc(5),g.Vb(),g.Vb(),g.Wb(6,"nb-card-body"),g.Wb(7,"nb-stepper",3,4),g.Wb(9,"nb-step",5),g.Wb(10,"form",6),g.ec("submit",(function(){return g.uc(t),g.gc().studentCourseFormSubmit()})),g.Wb(11,"div",7),g.Wb(12,"div",8),g.Wb(13,"div",9),g.Wb(14,"label",10),g.Cc(15,"Course:"),g.Vb(),g.Wb(16,"nb-select",11),g.ec("selectedChange",(function(e){return g.uc(t),g.gc().onSelectCourse(e)})),g.Wb(17,"nb-option",12),g.Cc(18,"Select Course"),g.Vb(),g.Ac(19,f,2,2,"nb-option",13),g.Vb(),g.Ac(20,V,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(21,"div",8),g.Wb(22,"div",9),g.Wb(23,"label",14),g.Cc(24,"Batch:"),g.Vb(),g.Wb(25,"nb-select",15),g.ec("selectedChange",(function(e){return g.uc(t),g.gc().onSelectBatch(e)})),g.Wb(26,"nb-option",12),g.Cc(27,"Select Batch"),g.Vb(),g.Ac(28,I,2,2,"nb-option",13),g.Vb(),g.Ac(29,A,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(30,"div",8),g.Wb(31,"div",9),g.Wb(32,"label",16),g.Cc(33,"Roll Number:"),g.Vb(),g.Wb(34,"input",17),g.ec("input",(function(){return g.uc(t),g.gc().checkRollNumber()})),g.Vb(),g.Ac(35,E,4,3,"ng-container",0),g.Vb(),g.Vb(),g.Wb(36,"div",8),g.Wb(37,"div",9),g.Wb(38,"label",18),g.Cc(39,"Discount/Offer:"),g.Vb(),g.Wb(40,"nb-select",19),g.ec("selectedChange",(function(e){return g.uc(t),g.gc().onSelectDiscount(e)})),g.Wb(41,"nb-option",12),g.Cc(42,"Select Discount"),g.Vb(),g.Ac(43,y,2,2,"nb-option",13),g.Vb(),g.Vb(),g.Vb(),g.Wb(44,"div",8),g.Wb(45,"div",9),g.Wb(46,"label",20),g.Cc(47,"Additional Discount Type:"),g.Vb(),g.Wb(48,"nb-select",21),g.ec("selectedChange",(function(){return g.uc(t),g.gc().changeAdditionalDiscountType()})),g.Ac(49,w,3,4,"nb-option",13),g.Vb(),g.Vb(),g.Vb(),g.Wb(50,"div",8),g.Wb(51,"div",9),g.Wb(52,"label",22),g.Cc(53,"Additional Discount Amount:"),g.Vb(),g.Wb(54,"input",23),g.ec("input",(function(e){return g.uc(t),g.gc().onAdditionalDiscountAmount(e.target.value)})),g.Vb(),g.Ac(55,P,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Wb(56,"div",24),g.Wb(57,"div",9),g.Wb(58,"label",25),g.Cc(59,"Activation Date:"),g.Vb(),g.Rb(60,"input",26),g.Ac(61,x,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(62,"div",24),g.Wb(63,"div",9),g.Wb(64,"label",27),g.Cc(65,"Net Payable:"),g.Vb(),g.Rb(66,"input",28),g.Ac(67,M,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Vb(),g.Rb(68,"hr"),g.Wb(69,"div",7),g.Wb(70,"div",29),g.Wb(71,"button",30),g.Wb(72,"span"),g.Cc(73,"Next"),g.Vb(),g.Rb(74,"nb-icon",31),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Wb(75,"nb-step",32),g.Wb(76,"form",33),g.ec("ngSubmit",(function(){return g.uc(t),g.gc().studentCourseFeeFormSubmit()})),g.Wb(77,"div",7),g.Wb(78,"div",8),g.Wb(79,"div",9),g.Wb(80,"label",34),g.Cc(81,"Date:"),g.Vb(),g.Rb(82,"input",35),g.Ac(83,B,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(84,"div",8),g.Wb(85,"div",9),g.Wb(86,"label",36),g.Cc(87,"Installment Type:"),g.Vb(),g.Wb(88,"nb-select",37),g.ec("selectedChange",(function(e){return g.uc(t),g.gc().onSelectInstallmentType(e)})),g.Wb(89,"nb-option",38),g.Cc(90,"Pay Once"),g.Vb(),g.Wb(91,"nb-option",39),g.Cc(92,"Pay Twice"),g.Vb(),g.Wb(93,"nb-option",40),g.Cc(94,"Pay Quarterly"),g.Vb(),g.Wb(95,"nb-option",41),g.Cc(96,"Pay Monthly"),g.Vb(),g.Wb(97,"nb-option",42),g.Cc(98,"Pay Custom"),g.Vb(),g.Vb(),g.Ac(99,U,2,1,"ng-container",0),g.Vb(),g.Vb(),g.Wb(100,"div",8),g.Wb(101,"div",9),g.Wb(102,"label",43),g.Cc(103,"Number of Installments:"),g.Vb(),g.Wb(104,"input",44),g.ec("input",(function(e){return g.uc(t),g.gc().generateNoOfInstallments(e.target.value)})),g.Vb(),g.Ac(105,G,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Wb(106,"div",8),g.Wb(107,"div",9),g.Wb(108,"label",45),g.Cc(109,"Pending Amount:"),g.Vb(),g.Rb(110,"input",46),g.Ac(111,z,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Wb(112,"div",8),g.Wb(113,"div",9),g.Wb(114,"label",47),g.Cc(115,"Amount Collected:"),g.Vb(),g.Rb(116,"input",48),g.Ac(117,L,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Wb(118,"div",8),g.Wb(119,"div",9),g.Wb(120,"label",49),g.Cc(121,"Total Payable Amount:"),g.Vb(),g.Rb(122,"input",50),g.Ac(123,Y,3,2,"ng-container",0),g.Vb(),g.Vb(),g.Vb(),g.Rb(124,"hr"),g.Wb(125,"div",7),g.Wb(126,"div",51),g.Wb(127,"button",52),g.ec("click",(function(){return g.uc(t),g.gc().previousStep()})),g.Rb(128,"nb-icon",53),g.Wb(129,"span"),g.Cc(130,"prev"),g.Vb(),g.Vb(),g.Vb(),g.Wb(131,"div",54),g.Wb(132,"button",30),g.Wb(133,"span"),g.Cc(134,"Next"),g.Vb(),g.Rb(135,"nb-icon",31),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Wb(136,"nb-step",55),g.Wb(137,"form",33),g.ec("ngSubmit",(function(){return g.uc(t),g.gc().studentCourseInstallmentFormSubmit()})),g.Wb(138,"div",7),g.Wb(139,"div",56),g.Ac(140,ct,14,1,"div",57),g.Ac(141,bt,2,0,"ng-template",null,58,g.Bc),g.Vb(),g.Vb(),g.Rb(143,"hr"),g.Wb(144,"div",7),g.Wb(145,"div",51),g.Wb(146,"button",52),g.ec("click",(function(){return g.uc(t),g.gc().previousStep()})),g.Rb(147,"nb-icon",53),g.Wb(148,"span"),g.Cc(149,"prev"),g.Vb(),g.Vb(),g.Vb(),g.Wb(150,"div",54),g.Wb(151,"button",30),g.Wb(152,"span"),g.Cc(153,"Next"),g.Vb(),g.Rb(154,"nb-icon",31),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Wb(155,"nb-step",59),g.Wb(156,"div",60),g.Wb(157,"div",61),g.Wb(158,"table",62),g.Wb(159,"tbody"),g.Wb(160,"tr"),g.Wb(161,"th",63),g.Cc(162,"Course Details"),g.Vb(),g.Vb(),g.Wb(163,"tr"),g.Wb(164,"th"),g.Cc(165,"Course"),g.Vb(),g.Wb(166,"td"),g.Cc(167),g.Vb(),g.Vb(),g.Wb(168,"tr"),g.Wb(169,"th"),g.Cc(170,"Batch"),g.Vb(),g.Wb(171,"td"),g.Cc(172),g.Vb(),g.Vb(),g.Wb(173,"tr"),g.Wb(174,"th"),g.Cc(175,"Roll Number"),g.Vb(),g.Wb(176,"td"),g.Cc(177),g.Vb(),g.Vb(),g.Wb(178,"tr"),g.Wb(179,"th"),g.Cc(180,"Discount"),g.Vb(),g.Wb(181,"td"),g.Cc(182),g.Vb(),g.Vb(),g.Wb(183,"tr"),g.Wb(184,"th"),g.Cc(185,"Additional Discount"),g.Vb(),g.Wb(186,"td"),g.Cc(187),g.Vb(),g.Vb(),g.Wb(188,"tr"),g.Wb(189,"th"),g.Cc(190,"Net Payable"),g.Vb(),g.Wb(191,"td"),g.Cc(192),g.Vb(),g.Vb(),g.Wb(193,"tr"),g.Wb(194,"th"),g.Cc(195,"Activation Date"),g.Vb(),g.Wb(196,"td"),g.Cc(197),g.Vb(),g.Vb(),g.Wb(198,"tr"),g.Wb(199,"th",63),g.Cc(200,"Course Fee Details"),g.Vb(),g.Vb(),g.Wb(201,"tr"),g.Wb(202,"th"),g.Cc(203,"Date"),g.Vb(),g.Wb(204,"td"),g.Cc(205),g.Vb(),g.Vb(),g.Wb(206,"tr"),g.Wb(207,"th"),g.Cc(208,"Number of Installments"),g.Vb(),g.Wb(209,"td"),g.Cc(210),g.Vb(),g.Vb(),g.Wb(211,"tr"),g.Wb(212,"th"),g.Cc(213,"Amount Collected"),g.Vb(),g.Wb(214,"td"),g.Cc(215),g.Vb(),g.Vb(),g.Wb(216,"tr"),g.Wb(217,"th"),g.Cc(218,"Pending Amount"),g.Vb(),g.Wb(219,"td"),g.Cc(220),g.Vb(),g.Vb(),g.Wb(221,"tr"),g.Wb(222,"th"),g.Cc(223,"Total Payable Amount"),g.Vb(),g.Wb(224,"td"),g.Cc(225),g.Vb(),g.Vb(),g.Wb(226,"tr"),g.Wb(227,"th",63),g.Cc(228,"Installment Details"),g.Vb(),g.Vb(),g.Wb(229,"tr"),g.Wb(230,"td",63),g.Wb(231,"div",61),g.Wb(232,"table",64),g.Wb(233,"thead"),g.Wb(234,"tr"),g.Wb(235,"th"),g.Cc(236,"Installment No."),g.Vb(),g.Wb(237,"th"),g.Cc(238,"Installment Date"),g.Vb(),g.Wb(239,"th"),g.Cc(240,"Installment Amount"),g.Vb(),g.Wb(241,"th"),g.Cc(242,"Pending Amount after Installment"),g.Vb(),g.Vb(),g.Vb(),g.Wb(243,"tbody"),g.Ac(244,mt,9,4,"tr",65),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Rb(245,"hr"),g.Wb(246,"div",7),g.Wb(247,"div",51),g.Wb(248,"button",52),g.ec("click",(function(){return g.uc(t),g.gc().previousStep()})),g.Rb(249,"nb-icon",53),g.Wb(250,"span"),g.Cc(251,"prev"),g.Vb(),g.Vb(),g.Vb(),g.Wb(252,"div",54),g.Wb(253,"button",66),g.ec("click",(function(){return g.uc(t),g.gc().saveStudentCourse()})),g.Wb(254,"span"),g.Cc(255,"Submit"),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb(),g.Vb()}if(2&t){const t=g.sc(142),e=g.gc();g.Eb(5),g.Ec(" ",e.studentCourse?"Edit Student Course":"New Student Course"," "),g.Eb(2),g.mc("linear",!0)("disableStepNavigation",!0),g.Eb(2),g.mc("stepControl",e.studentCourseForm),g.Eb(1),g.mc("formGroup",e.studentCourseForm),g.Eb(6),g.mc("status",e.studentCourseForm.get("course").touched?e.studentCourseForm.get("course").invalid?"danger":"success":"basic"),g.Eb(3),g.mc("ngForOf",e.courses),g.Eb(1),g.mc("ngIf",e.studentCourseForm.get("course").invalid&&e.studentCourseForm.get("course").touched),g.Eb(5),g.mc("status",e.studentCourseForm.get("batch").touched?e.studentCourseForm.get("batch").invalid?"danger":"success":"basic"),g.Eb(3),g.mc("ngForOf",e.courseBatches),g.Eb(1),g.mc("ngIf",e.studentCourseForm.get("batch").invalid&&e.studentCourseForm.get("batch").touched),g.Eb(5),g.mc("status",e.studentCourseForm.get("rollNumber").touched?e.studentCourseForm.get("rollNumber").invalid||e.rollNumberAlreadyExist?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",(e.studentCourseForm.get("rollNumber").invalid||e.rollNumberAlreadyExist)&&e.studentCourseForm.get("rollNumber").touched),g.Eb(8),g.mc("ngForOf",e.discounts),g.Eb(5),g.mc("selected",e.discountTypes.length>0?e.discountTypes[0]:""),g.Eb(1),g.mc("ngForOf",e.discountTypes),g.Eb(5),g.mc("status",e.studentCourseForm.get("additionalDiscountAmount").touched?e.studentCourseForm.get("additionalDiscountAmount").invalid||e.studentCourseForm.hasError("invalidDiscountPercentage")?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",e.studentCourseForm.get("additionalDiscountAmount").touched),g.Eb(5),g.mc("status",e.studentCourseForm.get("activationDate").invalid?"danger":"success"),g.Eb(1),g.mc("ngIf",e.studentCourseForm.get("activationDate").invalid),g.Eb(5),g.mc("status",e.studentCourseForm.get("netPayable").touched?e.studentCourseForm.get("netPayable").invalid?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",e.studentCourseForm.get("netPayable").invalid&&e.studentCourseForm.get("netPayable").touched),g.Eb(8),g.mc("stepControl",e.studentCourseFeeForm),g.Eb(1),g.mc("formGroup",e.studentCourseFeeForm),g.Eb(6),g.mc("status",e.studentCourseFeeForm.get("date").invalid?"danger":"success"),g.Eb(1),g.mc("ngIf",e.studentCourseFeeForm.get("date").invalid),g.Eb(5),g.mc("status",e.studentCourseFeeForm.get("installmentType").touched?e.studentCourseFeeForm.get("installmentType").invalid?"danger":"success":"basic"),g.Eb(11),g.mc("ngIf",e.studentCourseFeeForm.get("installmentType").invalid&&e.studentCourseFeeForm.get("installmentType").touched),g.Eb(5),g.mc("status",e.studentCourseFeeForm.get("noOfInstallments").touched?e.studentCourseFeeForm.get("noOfInstallments").invalid?"danger":"success":"basic"),g.Eb(1),g.mc("ngIf",e.studentCourseFeeForm.get("noOfInstallments").invalid&&e.studentCourseFeeForm.get("noOfInstallments").touched),g.Eb(5),g.mc("status",e.studentCourseFeeForm.get("pendingAmount").invalid?"danger":"success"),g.Eb(1),g.mc("ngIf",e.studentCourseFeeForm.get("pendingAmount").invalid),g.Eb(5),g.mc("status",e.studentCourseFeeForm.get("amountCollected").invalid?"danger":"success"),g.Eb(1),g.mc("ngIf",e.studentCourseFeeForm.get("amountCollected").invalid),g.Eb(5),g.mc("status",e.studentCourseFeeForm.get("totalAmount").invalid?"danger":"success"),g.Eb(1),g.mc("ngIf",e.studentCourseFeeForm.get("totalAmount").invalid),g.Eb(13),g.mc("stepControl",e.studentCourseInstallmentForm),g.Eb(1),g.mc("formGroup",e.studentCourseInstallmentForm),g.Eb(3),g.mc("ngIf",!!e.getNoOfInstallments()&&e.studentCourseInstallmentForm.get("installments").controls.length>0)("ngIfElse",t),g.Eb(27),g.Dc(e.getCourse(e.studentCourseForm.value.course)),g.Eb(5),g.Dc(e.getBatch(e.studentCourseForm.value.batch)),g.Eb(5),g.Dc(e.studentCourseForm.value.rollNumber),g.Eb(5),g.Dc(e.getDiscount(e.studentCourseForm.value.discount)),g.Eb(5),g.Ec(" ",e.studentCourseForm.value.additionalDiscountAmount?e.studentCourseForm.value.additionalDiscountAmount+("percentage"===e.studentCourseForm.value.additionalDiscountType?"%":""):"--"," "),g.Eb(5),g.Dc(e.studentCourseForm.value.netPayable),g.Eb(5),g.Dc(e.dateService.formatDate(e.studentCourseForm.value.activationDate)),g.Eb(8),g.Dc(e.dateService.formatDate(e.studentCourseFeeForm.value.date)),g.Eb(5),g.Dc(e.studentCourseFeeForm.getRawValue().noOfInstallments),g.Eb(5),g.Dc(e.studentCourseFeeForm.value.amountCollected),g.Eb(5),g.Dc(e.studentCourseFeeForm.value.pendingAmount),g.Eb(5),g.Dc(e.studentCourseFeeForm.value.totalAmount),g.Eb(19),g.mc("ngForOf",e.studentCourseInstallmentForm.get("installments").controls)}}const gt=[{path:"",component:(()=>{class t{constructor(t,e,n,s,o,u,i,a,r,l,d){this.dateService=t,this.toastrService=e,this.branchService=n,this.courseService=s,this.batchService=o,this.discountAndOfferService=u,this.studentService=i,this.studentCourseService=a,this.studentCourseInstallmentService=r,this.router=l,this.route=d,d.queryParams.subscribe(t=>{this.ngOnInit()})}ngOnInit(){if(this.loading=!0,this.branchId=this.branchService.getBranchId(),this.categoryId=this.branchService.getCategoryId(),this.studentId=this.studentService.getStudentId(),!this.branchId&&!this.categoryId&&!this.studentId)return void this.router.navigate(["../"],{relativeTo:this.route});let t;return this.studentCourseId=this.studentCourseService.getStudentCourseId(),this.route.queryParams.subscribe(e=>{t=e.mode}),t&&"edit"!==t?(this.showToastr("top-right","danger","Invalid Route"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):t&&!this.studentCourseId?(this.showToastr("top-right","danger","Student Course Not Found"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):(this.discounts=[],this.courses=[],this.batches=[],this.courseBatches=[],this.discountTypes=[],this.rollNumberAlreadyExist=!1,this.courseService.getCoursesData().subscribe(t=>{this.courses=t}),this.batchService.getBatchesData().subscribe(t=>{this.batches=t}),this.discountAndOfferService.getDiscountAndOffersData().subscribe(t=>{this.discounts=t}),this.discountTypes=this.discountAndOfferService.getDiscountTypes(),this.studentCourseForm=new s.f({course:new s.d("",{validators:[s.u.required]}),batch:new s.d("",{validators:[s.u.required]}),rollNumber:new s.d(null,{validators:[s.u.required,s.u.min(1)]}),discount:new s.d("",{validators:[]}),additionalDiscountType:new s.d(this.discountTypes.length>0?this.discountTypes[0]:"",{validators:[]}),additionalDiscountAmount:new s.d(0,{validators:[s.u.min(0)]}),activationDate:new s.d(this.dateService.getDateString(),{validators:[s.u.required]}),netPayable:new s.d(0,{validators:[s.u.required]})},{validators:this.discountPercentageValidator.bind(this)}),this.studentCourseFeeForm=new s.f({installmentType:new s.d("0",{validators:[s.u.required]}),date:new s.d(this.dateService.getDateString(),{validators:[s.u.required]}),noOfInstallments:new s.d(1,{validators:[s.u.required,s.u.min(1)]}),pendingAmount:new s.d(0,{validators:[s.u.required,s.u.min(0)]}),amountCollected:new s.d(0,{validators:[s.u.required,s.u.min(0)]}),totalAmount:new s.d(0,{validators:[s.u.required,s.u.min(0)]})}),this.studentCourseInstallmentForm=new s.f({installments:new s.b([])}),void(t&&this.studentId&&this.studentCourseId?this.studentCourseService.getStudentCourseForEditing(this.studentCourseId).subscribe(t=>{this.studentCourse=t.studentCourse,this.studentCourseInstallment=t.studentCourseInstallment,this.studentCourseForm.patchValue({course:this.studentCourse.course,activationDate:this.studentCourse.activationDate,rollNumber:this.studentCourse.rollNumber,discount:this.studentCourse.discount,additionalDiscountType:this.studentCourse.additionalDiscountType,additionalDiscountAmount:this.studentCourse.additionalDiscountAmount,netPayable:this.studentCourse.netPayable}),this.onSelectCourse(this.studentCourse.course),this.studentCourseForm.patchValue({batch:this.studentCourse.batch}),this.disableStudentCourseDetails(),this.studentCourseInstallment&&(this.studentCourseFeeForm.patchValue({installmentType:this.studentCourseInstallment.installmentType,date:this.studentCourseInstallment.date,noOfInstallments:this.studentCourseInstallment.noOfInstallments,amountCollected:this.studentCourseInstallment.amountCollected,pendingAmount:this.studentCourseInstallment.pendingAmount,totalAmount:this.studentCourseInstallment.totalAmount}),this.disableStudentCourseFeeForm(),this.resetStudentCourseInstallments(),this.studentCourseInstallment.installments.forEach((t,e)=>{this.addStudentCourseInstallment(t)}),this.disableStudentCourseInstallmentFields()),this.loading=!1},t=>{this.showToastr("top-right","danger",t),this.back()}):this.loading=!1))}discountPercentageValidator(t){const e=t.getRawValue().additionalDiscountType,n=+t.getRawValue().additionalDiscountAmount;return"percentage"===e&&n>100?{invalidDiscountPercentage:!0}:null}checkRollNumber(){const t=this.studentCourseForm.getRawValue().rollNumber.toString(),e=this.studentCourseForm.getRawValue().batch;if(t){if(this.studentCourse&&this.studentCourse.batch===e&&this.studentCourse.rollNumber===t)return;const n=this.studentCourseForm.getRawValue().course;n&&e&&this.studentCourseService.checkBatchRollNumber(this.branchId,this.categoryId,n,e,t).subscribe(t=>{this.rollNumberAlreadyExist=t.rollNumberExist},t=>{})}}onSelectCourse(t){this.studentCourseForm.patchValue({batch:""}),this.courseBatches=[],this.courseBatches=this.batches.filter(e=>e.course===t),this.course=this.courses.find(e=>e._id===t),this.calculateNetPayableAmount()}onSelectBatch(t){""!==t?(this.studentCourseForm.get("rollNumber").enable(),this.batch=this.batches.find(e=>e._id===t),this.checkRollNumber()):this.studentCourseForm.get("rollNumber").disable()}onSelectDiscount(t){this.discount=this.discounts.find(e=>e._id===t),this.calculateNetPayableAmount()}onAdditionalDiscountAmount(t){t>=0&&this.calculateNetPayableAmount()}changeAdditionalDiscountType(){this.studentCourseForm.patchValue({additionalDiscount:0}),this.calculateNetPayableAmount()}calculateNetPayableAmount(){let t=0,e=0,n=0,s=0;const o=this.course?+this.course.feeDetails.totalFees:0,u=this.discount?this.discount.discountType:"",i=this.studentCourseForm.getRawValue().additionalDiscountType,a=this.discount?+this.discount.discountAmount:0,r=+this.studentCourseForm.getRawValue().additionalDiscountAmount;if(this.course&&o){s=o,this.discount&&u&&("percentage"===u?e+=a:n+=a),r&&("percentage"===i?e+=r:n+=r),s=o-n-e/100*o,t=s,this.studentCourseForm.patchValue({netPayable:t}),this.studentCourseFeeForm.patchValue({totalAmount:t}),this.calculatePendingAmount();const l=this.studentCourseFeeForm.getRawValue().installmentType;this.onSelectInstallmentType(l)}}calculatePendingAmount(){let t=0;t=+this.studentCourseFeeForm.getRawValue().totalAmount-(this.studentCourseFeeForm.getRawValue().amountCollected||0),this.studentCourseFeeForm.patchValue({pendingAmount:t})}enableStudentCourseDetails(){this.studentCourseForm.get("course").enable(),this.studentCourseForm.get("discount").enable(),this.studentCourseForm.get("additionalDiscountType").enable(),this.studentCourseForm.get("additionalDiscountAmount").enable()}disableStudentCourseDetails(){this.studentCourseForm.get("course").disable(),this.studentCourseForm.get("discount").disable(),this.studentCourseForm.get("additionalDiscountType").disable(),this.studentCourseForm.get("additionalDiscountAmount").disable()}enableStudentCourseFeeForm(){this.studentCourseFeeForm.get("installmentType").enable(),this.studentCourseFeeForm.get("noOfInstallments").enable()}disableStudentCourseFeeForm(){this.studentCourseFeeForm.get("installmentType").disable(),this.studentCourseFeeForm.get("noOfInstallments").disable()}getStudentCourseInstallments(){return this.studentCourseInstallmentForm.get("installments").controls}resetStudentCourseInstallments(){this.studentCourseInstallmentForm.get("installments").controls=[]}newStudentCourseInstallment(t){return new s.f({_id:new s.d(t._id?t._id:(new m.a).toString(),{validators:[s.u.required]}),installmentNo:new s.d(t.installmentNo?t.installmentNo:null,{validators:[s.u.required]}),installmentDate:new s.d(t.installmentDate?t.installmentDate:null,{validators:[s.u.required]}),installmentAmount:new s.d(t.installmentAmount?t.installmentAmount:0,{validators:[s.u.required]}),amountPending:new s.d(t.installmentAmount?t.amountPending:0,{validators:[s.u.required]}),receiptId:new s.d(t.receiptId?t.receiptId:null,{validators:[]}),status:new s.d(!t.status||t.status,{validators:[]})},{validators:[this.minInstallmentAmountValidator.bind(this),this.maxInstallmentAmountValidator.bind(this),this.minInstallmentPendingAmountValidator.bind(this),this.maxInstallmentPendingAmountValidator.bind(this)]})}minInstallmentAmountValidator(t){const e=+t.getRawValue().installmentNo;return+t.getRawValue().installmentAmount<this.getMinInstallmentAmount(e-1)?{invalidMinInstallmentAmount:!0}:null}maxInstallmentAmountValidator(t){const e=+t.getRawValue().installmentNo;return+t.getRawValue().installmentAmount>this.getMaxInstallmentAmount(e-1)?{invalidMaxInstallmentAmount:!0}:null}minInstallmentPendingAmountValidator(t){const e=+t.getRawValue().installmentNo;return+t.getRawValue().amountPending<this.getMinInstallmentPendingAmount(e-1)?{invalidMinInstallmentPendingAmount:!0}:null}maxInstallmentPendingAmountValidator(t){const e=+t.getRawValue().installmentNo;return+t.getRawValue().amountPending>this.getMaxInstallmentPendingAmount(e-1)?{invalidMinInstallmentPendingAmount:!0}:null}addStudentCourseInstallment(t){this.getStudentCourseInstallments().push(this.newStudentCourseInstallment(t))}onSelectInstallmentType(t){if(this.studentCourseFeeForm.patchValue({amountCollected:0}),"0"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(1);else if("1"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(2);else if("2"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(4);else if("3"===t)this.studentCourseFeeForm.get("noOfInstallments").disable(),this.generateNoOfInstallments(this.course.basicDetails.duration);else{this.studentCourseFeeForm.get("noOfInstallments").enable();const t=this.studentCourseFeeForm.getRawValue().noOfInstallments;this.generateNoOfInstallments(t)}}generateNoOfInstallments(t){if(t){t=t>0?t:3,this.studentCourseFeeForm.patchValue({amountCollected:0}),this.studentCourseFeeForm.patchValue({noOfInstallments:t});const e=2592e6,n=+this.course.basicDetails.duration/t,s=this.studentCourseFeeForm.getRawValue().date,o=+this.studentCourseForm.getRawValue().netPayable/t,u=+this.studentCourseFeeForm.getRawValue().pendingAmount;this.resetStudentCourseInstallments();for(let i=0;i<t;i++){const t=this.dateService.millisecondsToDateString(this.dateService.dateToMilliseconds(s)+e*(n*i));let a=u-+o*(i+1);a=a<0?0:a;const r={_id:new m.a,installmentNo:(i+1).toString(),installmentDate:t,installmentAmount:Math.ceil(o),amountPending:Math.ceil(a),receiptId:null,status:!0};this.addStudentCourseInstallment(r)}"4"===this.studentCourseFeeForm.getRawValue().installmentType?this.enableStudentCourseInstallmentFields():this.disableStudentCourseInstallmentFields()}}customInstallmentAmount(t,e){if(!t||t<this.getMinInstallmentAmount(e)||t>this.getMaxInstallmentAmount(e))return;const n=this.getStudentCourseInstallments(),s=this.getNoOfInstallments(),o=(0===e?this.studentCourseFeeForm.getRawValue().totalAmount:n[e-1].getRawValue().amountPending)-t;n[e].patchValue({amountPending:o});const u=s-(e+1)>0?s-(e+1):1;let i=Math.ceil(o/u);if(e!==s-1)for(let a=0;a<u;a++){let t=o-+i*(a+1);t=t<0?0:t;const u=e+a+1;u===s-1&&this.getMaxInstallmentAmount(u)<i&&(i=this.getMaxInstallmentAmount(u)),n[u].patchValue({installmentAmount:i,amountPending:t})}}getMinInstallmentDate(t){const e=this.getStudentCourseInstallments();return 0===t?this.studentCourseFeeForm.getRawValue().date:e[t-1].getRawValue().installmentDate}getMaxInstallmentDate(t){const e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&1===n?this.studentCourseFeeForm.getRawValue().date:t===n-1?this.dateService.millisecondsToDateString(this.dateService.dateToMilliseconds(this.studentCourseFeeForm.getRawValue().date)+2592e6*this.course.basicDetails.duration):e[t+1].getRawValue().installmentDate}getMinInstallmentAmount(t){const e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&1===n?this.studentCourseFeeForm.getRawValue().totalAmount:0===t&&n>1?1:t===n-1?e[t-1].getRawValue().amountPending:1}getMaxInstallmentAmount(t){const e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?this.studentCourseFeeForm.getRawValue().totalAmount:e[t-1].getRawValue().amountPending}getMinInstallmentPendingAmount(t){const e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?0:t===n-1?0:e[t]?e[t-1].getRawValue().amountPending-e[t].getRawValue().installmentAmount:0}getMaxInstallmentPendingAmount(t){const e=this.getStudentCourseInstallments(),n=this.getNoOfInstallments();return 0===t&&n>=1?this.studentCourseFeeForm.getRawValue().totalAmount:t===n-1?0:e[t]?e[t-1].getRawValue().amountPending-e[t].getRawValue().installmentAmount+1:void 0}getNoOfInstallments(){return+this.studentCourseFeeForm.getRawValue().noOfInstallments}enableStudentCourseInstallmentFields(){this.getStudentCourseInstallments().forEach(t=>{t.get("installmentAmount").enable()})}disableStudentCourseInstallmentFields(){this.getStudentCourseInstallments().forEach(t=>{t.get("installmentAmount").disable()})}previousStep(){this.studentCourse&&this.disableStudentCourseDetails();const t=this.studentCourseFeeForm.getRawValue().installmentType;this.studentCourseInstallment?this.disableStudentCourseInstallmentFields():"4"!==t&&this.disableStudentCourseInstallmentFields(),this.stepper.previous()}studentCourseFormSubmit(){this.studentCourseForm.markAllAsTouched(),this.rollNumberAlreadyExist?this.showToastr("top-right","danger","Student Roll Number for this Batch already Exist"):this.studentCourseForm.invalid?this.showToastr("top-right","danger","Student Course Details are Required"):(this.studentCourse&&this.enableStudentCourseDetails(),this.stepper.next())}studentCourseFeeFormSubmit(){this.studentCourseFeeForm.markAllAsTouched(),this.studentCourseFeeForm.invalid?this.showToastr("top-right","danger","Student Course Fee Details are Required"):this.stepper.next()}studentCourseInstallmentFormSubmit(){this.studentCourseInstallmentForm.markAllAsTouched(),this.studentCourseInstallmentForm.invalid?this.showToastr("top-right","danger","Student Course Installment Details are Required"):this.validateStudentCourseInstallmentForm()?(this.enableStudentCourseInstallmentFields(),this.stepper.next()):this.showToastr("top-right","danger","Student Course Installment Details are Required")}validateStudentCourseInstallmentForm(){const t=this.getStudentCourseInstallments();let e=!1;return t.forEach((t,n)=>{t.invalid&&(e=!0)}),!e}saveStudentCourse(){if(this.studentCourseForm.markAllAsTouched(),this.studentCourseFeeForm.markAllAsTouched(),this.studentCourseInstallmentForm.markAllAsTouched(),this.rollNumberAlreadyExist)return void this.showToastr("top-right","danger","Student Roll Number for this Batch already Exist");if(this.studentCourseForm.invalid)return void this.showToastr("top-right","danger","Student Course Details are Required");if(this.studentCourseFeeForm.invalid)return void this.showToastr("top-right","danger","Student Course Fee Details are Required");if(this.studentCourseInstallmentForm.invalid)return void this.showToastr("top-right","danger","Student Course Installment Details are Required");if(!this.validateStudentCourseInstallmentForm())return void this.showToastr("top-right","danger","Student Course Installment Details are Required");this.loading=!0;const t=this.studentCourseForm.getRawValue();t.branch=this.branchId,t.category=this.categoryId,t.student=this.studentId;const e=this.studentCourseFeeForm.getRawValue();e.installments=this.studentCourseInstallmentForm.getRawValue().installments,e.branch=this.branchId,e.category=this.categoryId,e.course=t.course,e.student=this.studentId,this.studentCourse||this.studentCourseInstallment?this.studentCourse&&!this.studentCourseInstallment?this.studentCourseInstallmentService.addStudentCourseInstallment(this.studentCourse._id,e).subscribe(t=>{this.showToastr("top-right","success","Student Course Installments Created Successfully!"),this.back(),this.loading=!1},t=>{this.showToastr("top-right","danger",t),this.loading=!1}):(t._id=this.studentCourse._id,e._id=this.studentCourseInstallment._id,this.studentCourseService.editStudentCourse(t,e).subscribe(t=>{this.showToastr("top-right","success","Student Course Updated Successfully!"),this.back(),this.loading=!1},t=>{this.showToastr("top-right","danger",t),this.loading=!1})):this.studentCourseService.addStudentCourse(t,e).subscribe(t=>{this.showToastr("top-right","success","Student Course Created Successfully!"),this.back(),this.loading=!1},t=>{this.showToastr("top-right","danger",t),this.loading=!1}),this.loading=!1}showToastr(t,e,n){this.toastrService.show(e,n,{position:t,status:e})}getCourse(t){const e=this.courses.find(e=>e._id===t);return e?e.basicDetails.courseName:"--"}getBatch(t){const e=this.batches.find(e=>e._id===t);return e?e.basicDetails.batchName:"--"}getDiscount(t){const e=this.discounts.find(e=>e._id===t);return e?e.offerName+" ("+e.code+" - "+e.discountAmount+("percentage"===e.discountType?"%":".00")+")":"--"}back(){this.router.navigate(["../"],{relativeTo:this.route})}ngOnDestroy(){}}return t.\u0275fac=function(e){return new(e||t)(g.Qb(l.a),g.Qb(o.xb),g.Qb(c.a),g.Qb(i.a),g.Qb(a.a),g.Qb(h.a),g.Qb(d.a),g.Qb(r.a),g.Qb(b.a),g.Qb(C.c),g.Qb(C.a))},t.\u0275cmp=g.Kb({type:t,selectors:[["ngx-add-student-course"]],viewQuery:function(t,e){var n;1&t&&g.Hc(p,!0),2&t&&g.rc(n=g.fc())&&(e.stepper=n.first)},decls:1,vars:1,consts:[[4,"ngIf"],["type","button","nbButton","","status","warning","size","tiny",1,"float-right",3,"click"],[1,""],[3,"linear","disableStepNavigation"],["stepper",""],["label","Course Details",3,"stepControl"],[1,"",3,"formGroup","submit"],[1,"row"],[1,"col-md-4"],[1,"form-control-group"],["for","input-student-course",1,"label"],["id","input-student-course","name","course","formControlName","course","placeholder","Select Course","fullWidth","",3,"status","selectedChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","input-student-batch",1,"label"],["id","input-student-batch","name","batch","formControlName","batch","placeholder","Select Batch","fullWidth","",3,"status","selectedChange"],["for","input-roll-number",1,"label"],["type","number","nbInput","","id","input-roll-number","name","rollNumber","formControlName","rollNumber","min","1","placeholder","Roll Number","fullWidth","",3,"status","input"],["for","input-student-discount",1,"label"],["id","input-student-discount","name","discount","formControlName","discount","placeholder","Select Discount","fullWidth","",3,"selectedChange"],["for","input-additional-discount-type",1,"label"],["id","input-additional-discount-type","name","additionalDiscountType","formControlName","additionalDiscountType","placeholder","Select Discount Type","fullWidth","",3,"selected","selectedChange"],["for","input-discount-amount",1,"label"],["type","number","nbInput","","id","input-discount-amount","name","additionalDiscountAmount","formControlName","additionalDiscountAmount","placeholder","Discount Amount","min","0","fullWidth","",3,"status","input"],[1,"col-md-6"],["for","input-activation-date",1,"label"],["type","date","nbInput","","id","input-activation-date","name","activationDate","formControlName","activationDate","placeholder","Activation Date","fullWidth","",3,"status"],["for","input-net-payable",1,"label"],["type","number","nbInput","","id","input-net-payable","name","netPayable","formControlName","netPayable","placeholder","Net Payable","min","0","fullWidth","","disabled","true",3,"status"],[1,"col-md-12","text-right"],["nbButton","","type","submit"],["icon","arrow-ios-forward-outline"],["label","Course Fee Details",3,"stepControl"],[1,"step-container",3,"formGroup","ngSubmit"],["for","input-date",1,"label"],["type","date","nbInput","","id","input-date","name","date","formControlName","date","placeholder","Date","fullWidth","",3,"status"],["for","input-course-installment-type",1,"label"],["id","input-course-installment-type","name","installmentType","formControlName","installmentType","placeholder","Select Installment Type","fullWidth","",3,"status","selectedChange"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["for","input-noOfInstallments",1,"label"],["type","number","nbInput","","id","input-noOfInstallments","name","noOfInstallments","formControlName","noOfInstallments","placeholder","Number of Installments","min","0","fullWidth","",3,"status","input"],["for","input-pendingAmount",1,"label"],["type","number","nbInput","","id","input-pendingAmount","name","pendingAmount","formControlName","pendingAmount","placeholder","Pending Amount","min","0","fullWidth","","disabled","true",3,"status"],["for","input-amountCollected",1,"label"],["type","number","nbInput","","id","input-amountCollected","name","amountCollected","formControlName","amountCollected","placeholder","Amount Collected","min","0","fullWidth","","disabled","true",3,"status"],["for","input-totalAmount",1,"label"],["type","number","nbInput","","id","input-totalAmount","name","totalAmount","formControlName","totalAmount","placeholder","Total Amount","min","0","fullWidth","","disabled","true",3,"status"],[1,"col-md-6","text-left"],["type","button","nbButton","",1,"",3,"click"],["icon","arrow-ios-back-outline"],[1,"col-md-6","text-right"],["label","Installment Details",3,"stepControl"],[1,"col-md-12"],["class","table-responsive",4,"ngIf","ngIfElse"],["noInstallments",""],["label","Submit"],[1,"step-container"],[1,"table-responsive"],[1,"table","table-bordered"],["colspan","2"],[1,"table","table-sm","table-bordered"],[4,"ngFor","ngForOf"],["nbButton","",3,"click"],[3,"value"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],[3,"formGroup"],["type","date","nbInput","","formControlName","installmentDate","placeholder","Installment Date","fullWidth","",3,"id","name","min","max","status"],["type","number","nbInput","","formControlName","installmentAmount","placeholder","Installment Amount","fullWidth","",3,"id","name","min","max","status","input"],["type","number","nbInput","","formControlName","amountPending","placeholder","Pending Amount","fullWidth","","disabled","true",3,"id","name","min","max","status"],[1,"mt-4","text-center"]],template:function(t,e){1&t&&g.Ac(0,ht,256,53,"nb-card",0),2&t&&g.mc("ngIf",!e.loading)},directives:[u.n,o.x,o.z,o.u,o.w,o.pb,o.ob,s.v,s.n,s.g,o.jb,s.m,s.e,o.eb,u.m,s.q,o.O,s.a,o.L],pipes:[u.v],styles:[""]}),t})()},{path:"page-not-found",loadChildren:()=>n.e(0).then(n.bind(null,"DeSt")).then(t=>t.PageNotFoundModule)},{path:"**",redirectTo:"page-not-found",pathMatch:"full"}];let Ct=(()=>{class t{}return t.\u0275mod=g.Ob({type:t}),t.\u0275inj=g.Nb({factory:function(e){return new(e||t)},imports:[[C.g.forChild(gt)],C.g]}),t})();n.d(e,"AddStudentCourseModule",(function(){return pt}));let pt=(()=>{class t{}return t.\u0275mod=g.Ob({type:t}),t.\u0275inj=g.Nb({factory:function(e){return new(e||t)},imports:[[u.c,Ct,o.A,o.N,o.v,o.P,o.qb,o.D,o.K,o.kb,s.s]]}),t})()}}]);