(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{MDGh:function(t,e,a){"use strict";a.r(e);var i=a("ofXK"),c=a("IAlr"),s=a("3Pt+"),r=a("lst6"),b=a("EQut"),o=a("no5z"),n=a("Pj/w"),h=a("fXoL"),u=a("aceb"),l=a("tyNb");const d=["stepper"];function m(t,e){1&t&&(h.Wb(0,"p",36),h.Cc(1," Batch Name is required! "),h.Vb())}function p(t,e){if(1&t&&(h.Ub(0),h.Ac(1,m,2,0,"p",35),h.Tb()),2&t){const t=h.gc();h.Eb(1),h.mc("ngIf",null==t.batchBasicDetailsForm.get("batchName").errors?null:t.batchBasicDetailsForm.get("batchName").errors.required)}}function g(t,e){1&t&&(h.Wb(0,"p",36),h.Cc(1," Batch Start Date is required! "),h.Vb())}function v(t,e){if(1&t&&(h.Ub(0),h.Ac(1,g,2,0,"p",35),h.Tb()),2&t){const t=h.gc();h.Eb(1),h.mc("ngIf",null==t.batchBasicDetailsForm.get("startDate").errors?null:t.batchBasicDetailsForm.get("startDate").errors.required)}}function f(t,e){if(1&t&&(h.Wb(0,"nb-option",44),h.Cc(1),h.Vb()),2&t){const t=e.$implicit;h.mc("value",t.employee),h.Eb(1),h.Dc(t.name)}}function V(t,e){if(1&t){const t=h.Xb();h.Ub(0),h.Wb(1,"div",37),h.Wb(2,"div",38),h.Wb(3,"div",8),h.Wb(4,"nb-checkbox",39),h.ec("checkedChange",(function(a){h.uc(t);const i=e.index;return h.gc().changeSubjectStatus(a,i)})),h.Wb(5,"label",40),h.Cc(6),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(7,"div",38),h.Wb(8,"div",8),h.Wb(9,"nb-select",41),h.Wb(10,"nb-option",42),h.Cc(11,"Select Teacher "),h.Vb(),h.Ac(12,f,2,2,"nb-option",43),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Tb()}if(2&t){const t=e.$implicit,a=e.index,i=h.gc();h.Eb(1),h.mc("formGroup",t),h.Eb(3),h.oc("id","status-",a,""),h.mc("checked",t.value.status),h.Eb(1),h.oc("for","status-",a,""),h.Eb(1),h.Dc(i.getSubjectName(t.value.subject)),h.Eb(3),h.oc("id","teacher-",a,""),h.Eb(3),h.mc("ngForOf",i.teachers)}}function W(t,e){if(1&t&&(h.Wb(0,"tr"),h.Wb(1,"th"),h.Cc(2),h.Vb(),h.Wb(3,"td"),h.Cc(4),h.Vb(),h.Vb()),2&t){const t=h.gc().$implicit,e=h.gc();h.Eb(2),h.Dc(e.getSubjectName(t.value.subject)),h.Eb(2),h.Dc(e.getTeacherName(t.value.teacher))}}function B(t,e){if(1&t&&(h.Ub(0),h.Ac(1,W,5,2,"tr",11),h.Tb()),2&t){const t=e.$implicit;h.Eb(1),h.mc("ngIf",t.value.status)}}const S=[{path:"",component:(()=>{class t{constructor(t,e,a,i,c,s,r){this.branchService=t,this.branchEmployeeService=e,this.batchService=a,this.courseService=i,this.toastrService=c,this.router=s,this.route=r,this.route.queryParams.subscribe(t=>{this.ngOnInit()})}ngOnInit(){if(this.loading=!0,this.branchId=this.branchService.getBranchId(),!this.branchId)return void this.router.navigate(["../"],{relativeTo:this.route});let t;return this.courseService.getCourseData().subscribe(t=>{this.course=t,this.course||this.router.navigate(["../"],{relativeTo:this.route})}),this.batchId=this.batchService.getBatchId(),this.route.queryParams.subscribe(e=>{t=e.mode}),t&&"edit"!==t?(this.showToastr("top-right","danger","Invalid Route"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):t&&!this.batchId?(this.showToastr("top-right","danger","Batch Not Available"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):(this.batchBasicDetailsForm=new s.f({batchName:new s.d(null,{validators:[s.u.required]}),startDate:new s.d(null,{validators:[s.u.required]}),rollNoPrefix:new s.d(null,{validators:[]}),description:new s.d(null,{validators:[]})}),this.batchSubjectForm=new s.f({subjects:new s.b([])},{validators:this.atLeastOneSubjectValidator.bind(this)}),this.teachers=[],this.subjects=this.course.subjects.filter(t=>t.status),this.subjects.forEach(t=>{const e={_id:new o.a,subject:t._id,teacher:"",status:!0};this.addBatchSubject(e)}),void this.branchEmployeeService.getBranchEmployeeNameIdsForBatch(this.branchId,"teacher").subscribe(t=>{this.teachers=t,this.batchId?this.batchService.getBatchForEditing(this.batchId).subscribe(e=>{if(!e)return void this.router.navigate(["../page-not-found"],{relativeTo:this.route});this.batch=e,this.batchBasicDetailsForm.patchValue({batchName:e.basicDetails.batchName,startDate:e.basicDetails.startDate,duration:e.basicDetails.rollNoPrefix,description:e.basicDetails.description});const a=e.subjects;this.subjects.forEach((e,i)=>{const c=a.find(t=>t.subject===e._id);let s="";c&&(this.changeSubjectStatus(c.status,i),this.getBatchSubjects().controls[i].get("_id").setValue(c._id),t.find(t=>t.employee===c.teacher)&&(s=c.teacher)),this.getBatchSubjects().controls[i].get("teacher").setValue(s)}),this.loading=!1},t=>{this.router.navigate(["../page-not-found"],{relativeTo:this.route})}):this.loading=!1},t=>{this.showToastr("top-right","danger",t),this.loading=!1}))}atLeastOneSubjectValidator(t){let e=!1;return t.value.subjects.forEach(t=>{t.status&&(e=!0)}),e?null:{atLeastOneSubjectError:!0}}getBatchSubjects(){return this.batchSubjectForm.get("subjects")}newBatchSubject(t){return new s.f({_id:new s.d(t._id?t._id:(new o.a).toString(),{validators:[s.u.required]}),subject:new s.d(t.subject?t.subject:null,{validators:[s.u.required]}),teacher:new s.d(t.teacher?t.teacher:"",{validators:[]}),status:new s.d(!t.status||t.status,{validators:[]})})}addBatchSubject(t){this.getBatchSubjects().push(this.newBatchSubject(t))}changeSubjectStatus(t,e){const a=this.getBatchSubjects().controls[e];a.get("status").setValue(t),t?a.get("teacher").enable():(a.get("teacher").setValue(""),a.get("teacher").disable())}getSubjectName(t){const e=this.subjects.find(e=>e._id===t);return e?e.subject:"--"}getTeacherName(t){const e=this.teachers.find(e=>e.employee===t);return e?e.name:"--"}submitBasicDetails(){this.batchBasicDetailsForm.markAllAsTouched(),this.batchBasicDetailsForm.invalid?this.showToastr("top-right","danger","Basic details are required"):this.stepper.next()}submitSubjects(){this.batchSubjectForm.markAllAsTouched(),this.batchSubjectForm.invalid?this.showToastr("top-right","danger","At least 1 Subject is required"):this.stepper.next()}saveBatch(){if(this.batchBasicDetailsForm.markAllAsTouched(),this.batchSubjectForm.markAllAsTouched(),this.batchBasicDetailsForm.invalid)return void this.showToastr("top-right","danger","Basic details are required");if(this.batchSubjectForm.invalid)return void this.showToastr("top-right","danger","At least 1 Subject is required");this.loading=!0;const t={branch:this.branchId,category:this.course.basicDetails.category,course:this.course._id,basicDetails:this.batchBasicDetailsForm.value,subjects:this.batchSubjectForm.value.subjects};this.batch?(t._id=this.batch._id,this.batchService.editBatch(t).subscribe(t=>{this.showToastr("top-right","success","Batch Updated Successfully!"),this.router.navigate(["../"],{relativeTo:this.route})},t=>{this.showToastr("top-right","danger",t),this.loading=!1})):this.batchService.addBatch(t).subscribe(t=>{this.showToastr("top-right","success","New Batch Added Successfully!"),this.router.navigate(["../"],{relativeTo:this.route})},t=>{this.showToastr("top-right","danger",t),this.loading=!1})}showToastr(t,e,a){this.toastrService.show(e,a,{position:t,status:e})}back(){this.router.navigate(["../"],{relativeTo:this.route})}ngOnDestroy(){this.batchService.deleteBatchId()}}return t.\u0275fac=function(e){return new(e||t)(h.Qb(b.a),h.Qb(n.a),h.Qb(r.a),h.Qb(c.a),h.Qb(u.xb),h.Qb(l.c),h.Qb(l.a))},t.\u0275cmp=h.Kb({type:t,selectors:[["ngx-add-batch"]],viewQuery:function(t,e){var a;1&t&&h.Hc(d,!0),2&t&&h.rc(a=h.fc())&&(e.stepper=a.first)},decls:97,vars:17,consts:[["nbButton","","status","warning","size","tiny",1,"float-right",3,"click"],[1,""],[3,"linear"],["stepper",""],["label","Basic Details",3,"stepControl"],[1,"",3,"formGroup","submit"],[1,"row"],[1,"col-md-4"],[1,"form-control-group"],["for","input -batch-name",1,"label"],["type","text","nbInput","","id","input-batch-name","name","batchName","formControlName","batchName","placeholder","Batch Name","maxlength","30","fullWidth","",3,"status"],[4,"ngIf"],["for","input -batch-start-date",1,"label"],["type","date","nbInput","","id","input-batch-start-date","name","startDate","formControlName","startDate","fullWidth","",3,"status"],["for","input-rollNoPrefix",1,"label"],["type","text","nbInput","","id","input-rollNoPrefix","name","rollNoPrefix","maxlength","15","formControlName","rollNoPrefix","placeholder","Roll No Prefix","fullWidth",""],[1,"col-md-12"],["for","input-billing-description",1,"label"],["type","text","nbInput","","id","input-description","name","description","formControlName","description","placeholder","Description (Optional)","fullWidth",""],[1,"col-md-12","text-right"],["nbButton","","type","submit"],["icon","arrow-ios-forward-outline"],["label","Subject Details",3,"stepControl"],[1,"step-container",3,"formGroup","ngSubmit"],[4,"ngFor","ngForOf"],[1,"col-md-6","text-left"],["nbButton","","nbStepperPrevious","",1,""],["icon","arrow-ios-back-outline"],[1,"col-md-6","text-right"],["label","Submit"],[1,"step-container"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"table","table-sm","table-borderless"],["nbButton","",3,"click"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],[1,"row","mb-3",3,"formGroup"],[1,"col-md-4","col-sm-6","mx-auto"],["name","status","formControlName","status",3,"id","checked","checkedChange"],[3,"for"],["name","teacher","formControlName","teacher","placeholder","Select Teacher","fullWidth","",3,"id"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(h.Wb(0,"nb-card"),h.Wb(1,"nb-card-header"),h.Wb(2,"button",0),h.ec("click",(function(){return e.back()})),h.Cc(3," Back "),h.Vb(),h.Wb(4,"h3",1),h.Cc(5),h.hc(6,"uppercase"),h.Vb(),h.Vb(),h.Wb(7,"nb-card-body"),h.Wb(8,"nb-stepper",2,3),h.Wb(10,"nb-step",4),h.Wb(11,"form",5),h.ec("submit",(function(){return e.submitBasicDetails()})),h.Wb(12,"h6"),h.Cc(13,"Batch Details:"),h.Vb(),h.Wb(14,"div",6),h.Wb(15,"div",7),h.Wb(16,"div",8),h.Wb(17,"label",9),h.Cc(18,"Batch Name:"),h.Vb(),h.Rb(19,"input",10),h.Ac(20,p,2,1,"ng-container",11),h.Vb(),h.Vb(),h.Wb(21,"div",7),h.Wb(22,"div",8),h.Wb(23,"label",12),h.Cc(24,"Batch Start Date:"),h.Vb(),h.Rb(25,"input",13),h.Ac(26,v,2,1,"ng-container",11),h.Vb(),h.Vb(),h.Wb(27,"div",7),h.Wb(28,"div",8),h.Wb(29,"label",14),h.Cc(30,"Roll No Prefix:"),h.Vb(),h.Rb(31,"input",15),h.Vb(),h.Vb(),h.Wb(32,"div",16),h.Wb(33,"div",8),h.Wb(34,"label",17),h.Cc(35,"Description:"),h.Vb(),h.Rb(36,"textarea",18),h.Vb(),h.Vb(),h.Vb(),h.Rb(37,"hr"),h.Wb(38,"div",6),h.Wb(39,"div",19),h.Wb(40,"button",20),h.Wb(41,"span"),h.Cc(42,"Next"),h.Vb(),h.Rb(43,"nb-icon",21),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(44,"nb-step",22),h.Wb(45,"form",23),h.ec("ngSubmit",(function(){return e.submitSubjects()})),h.Ac(46,V,13,7,"ng-container",24),h.Rb(47,"hr"),h.Wb(48,"div",6),h.Wb(49,"div",25),h.Wb(50,"button",26),h.Rb(51,"nb-icon",27),h.Wb(52,"span"),h.Cc(53,"prev"),h.Vb(),h.Vb(),h.Vb(),h.Wb(54,"div",28),h.Wb(55,"button",20),h.Wb(56,"span"),h.Cc(57,"Next"),h.Vb(),h.Rb(58,"nb-icon",21),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(59,"nb-step",29),h.Wb(60,"div",30),h.Wb(61,"div",31),h.Wb(62,"table",32),h.Wb(63,"tbody"),h.Wb(64,"tr"),h.Wb(65,"th"),h.Cc(66,"Batch Name"),h.Vb(),h.Wb(67,"td"),h.Cc(68),h.Vb(),h.Vb(),h.Wb(69,"tr"),h.Wb(70,"th"),h.Cc(71,"Batch Roll No Prefix"),h.Vb(),h.Wb(72,"td"),h.Cc(73),h.Vb(),h.Vb(),h.Wb(74,"tr"),h.Wb(75,"th"),h.Cc(76,"Description"),h.Vb(),h.Wb(77,"td"),h.Cc(78),h.Vb(),h.Vb(),h.Wb(79,"tr"),h.Wb(80,"th"),h.Cc(81,"Subjects"),h.Vb(),h.Wb(82,"td"),h.Wb(83,"table",33),h.Wb(84,"tbody"),h.Ac(85,B,2,1,"ng-container",24),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Rb(86,"hr"),h.Wb(87,"div",6),h.Wb(88,"div",25),h.Wb(89,"button",26),h.Rb(90,"nb-icon",27),h.Wb(91,"span"),h.Cc(92,"prev"),h.Vb(),h.Vb(),h.Vb(),h.Wb(93,"div",28),h.Wb(94,"button",34),h.ec("click",(function(){return e.saveBatch()})),h.Wb(95,"span"),h.Cc(96,"Submit"),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb()),2&t&&(h.Eb(5),h.Ec(" ",e.batch?"Edit Batch "+h.ic(6,15,e.batch.basicDetails.batchName):"Add New Batch"," "),h.Eb(3),h.mc("linear",!0),h.Eb(2),h.mc("stepControl",e.batchBasicDetailsForm),h.Eb(1),h.mc("formGroup",e.batchBasicDetailsForm),h.Eb(8),h.mc("status",e.batchBasicDetailsForm.get("batchName").touched?e.batchBasicDetailsForm.get("batchName").invalid?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",e.batchBasicDetailsForm.get("batchName").invalid&&e.batchBasicDetailsForm.get("batchName").touched),h.Eb(5),h.mc("status",e.batchBasicDetailsForm.get("startDate").touched?e.batchBasicDetailsForm.get("startDate").invalid?"danger":"success":"basic"),h.Eb(1),h.mc("ngIf",e.batchBasicDetailsForm.get("startDate").invalid&&e.batchBasicDetailsForm.get("startDate").touched),h.Eb(18),h.mc("stepControl",e.batchSubjectForm),h.Eb(1),h.mc("formGroup",e.batchSubjectForm),h.Eb(1),h.mc("ngForOf",e.batchSubjectForm.get("subjects").controls),h.Eb(22),h.Dc(e.batchBasicDetailsForm.value.batchName),h.Eb(5),h.Dc(e.batchBasicDetailsForm.value.rollNoPrefix),h.Eb(5),h.Dc(e.batchBasicDetailsForm.value.description),h.Eb(7),h.mc("ngForOf",e.batchSubjectForm.get("subjects").controls))},directives:[u.x,u.z,u.u,u.w,u.pb,u.ob,s.v,s.n,s.g,u.O,s.a,s.m,s.e,s.i,i.n,u.L,i.m,u.rb,u.C,u.jb,u.eb],pipes:[i.v],styles:[""]}),t})()},{path:"page-not-found",loadChildren:()=>a.e(0).then(a.bind(null,"DeSt")).then(t=>t.PageNotFoundModule)},{path:"**",redirectTo:"page-not-found",pathMatch:"full"}];let D=(()=>{class t{}return t.\u0275mod=h.Ob({type:t}),t.\u0275inj=h.Nb({factory:function(e){return new(e||t)},imports:[[l.g.forChild(S)],l.g]}),t})();a.d(e,"AddBatchModule",(function(){return j}));let j=(()=>{class t{}return t.\u0275mod=h.Ob({type:t}),t.\u0275inj=h.Nb({factory:function(e){return new(e||t)},imports:[[i.c,D,u.A,u.v,u.kb,u.N,u.P,u.K,u.D,u.qb,u.K,s.s]]}),t})()}}]);