{"version":3,"sources":["webpack:///src/app/admin/coupon/add-coupon/add-coupon.component.html","webpack:///src/app/admin/coupon/add-coupon/add-coupon.component.ts","webpack:///src/app/admin/coupon/coupon.component.html","webpack:///src/app/admin/coupon/coupon-routing.module.ts","webpack:///src/app/admin/coupon/coupon.component.ts","webpack:///src/app/admin/coupon/coupon.module.ts"],"names":["AddCouponComponent","dateService","couponService","toastrService","ref","this","loading","submit","discountTypes","getDiscountTypes","validCouponCode","getCouponData","subscribe","coupon","couponForm","code","validators","required","discountType","discountAmount","min","expiryDate","description","termsAndConditions","discountPercentageValidator","bind","group","value","invalidDiscountPercentage","checkCoupon","res","status","err","markAllAsTouched","invalid","showToastr","stepper","next","_id","editCoupon","close","type","error","addCoupon","resCoupon","position","message","show","deleteCouponData","onClose","submitCoupon","checkCouponCode","saveCoupon","routes","path","component","CouponComponent","router","route","dialogService","coupons","getCoupons","push","index","findIndex","curCoupon","open","context","updateCoupon","openCouponDialog","setCouponData","id","deleteCoupon","splice","loadChildren","then","m","PageNotFoundModule","redirectTo","pathMatch","CouponRoutingModule","forChild","CouponModule"],"mappings":"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","file":"x","sourcesContent":["<nb-card class=\"coupon-box\">\r\n  <nb-card-header>\r\n    <button class=\"float-right\" nbButton size=\"small\" status=\"basic\" (click)=\"onClose()\">\r\n      <nb-icon icon=\"close-outline\"></nb-icon>\r\n    </button>\r\n    <h3 class=\"\">\r\n      {{ !coupon ? 'Add New Coupon' : 'Edit Coupon ' + (coupon.code | uppercase) }}\r\n    </h3>\r\n  </nb-card-header>\r\n  <nb-card-body>\r\n    <nb-stepper #stepper [linear]=\"true\">\r\n      <nb-step [stepControl]=\"couponForm\" label=\"Coupon Details\">\r\n        <form class=\"\" (submit)=\"submitCoupon()\" [formGroup]=\"couponForm\">\r\n          <h6>Coupon:</h6>\r\n          <div class=\"row\">\r\n            <div class=\"col-md-6\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-code\">Code:</label>\r\n                <input\r\n                  type=\"text\"\r\n                  nbInput\r\n                  id=\"input-code\"\r\n                  name=\"code\"\r\n                  formControlName=\"code\"\r\n                  placeholder=\"Code\"\r\n                  maxlength=\"30\"\r\n                  fullWidth\r\n                  [status]=\"\r\n                    couponForm.get('code').touched\r\n                      ? couponForm.get('code').invalid || !validCouponCode\r\n                        ? 'danger'\r\n                        : 'success'\r\n                      : 'basic'\r\n                  \"\r\n                  (input)=\"checkCouponCode($event.target.value)\"\r\n                />\r\n                <ng-container *ngIf=\"couponForm.get('code').touched\">\r\n                  <p class=\"caption status-danger\" *ngIf=\"couponForm.get('code').errors?.required\">\r\n                    Code is required!\r\n                  </p>\r\n                  <p class=\"caption status-danger\" *ngIf=\"!validCouponCode\">\r\n                    This Coupon Code Already Exist!\r\n                  </p>\r\n                </ng-container>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"col-md-6\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-billing-discount-type\">Discount Type:</label>\r\n                <nb-select\r\n                  id=\"input-discount-type\"\r\n                  name=\"discountType\"\r\n                  formControlName=\"discountType\"\r\n                  placeholder=\"Select Discount Type\"\r\n                  fullWidth\r\n                  [status]=\"\r\n                    couponForm.get('discountType').touched\r\n                      ? couponForm.get('discountType').invalid\r\n                        ? 'danger'\r\n                        : 'success'\r\n                      : 'basic'\r\n                  \"\r\n                >\r\n                  <nb-option value=\"\">Select Discount Type</nb-option>\r\n                  <nb-option *ngFor=\"let discountType of discountTypes\" [value]=\"discountType\">{{\r\n                    discountType | uppercase\r\n                  }}</nb-option>\r\n                </nb-select>\r\n                <ng-container *ngIf=\"couponForm.get('discountType').touched\">\r\n                  <p\r\n                    class=\"caption status-danger\"\r\n                    *ngIf=\"couponForm.get('discountType').errors?.required\"\r\n                  >\r\n                    Discount Type is required!\r\n                  </p>\r\n                </ng-container>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"col-md-6\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-discount-amount\">Discount Amount:</label>\r\n                <input\r\n                  type=\"number\"\r\n                  nbInput\r\n                  id=\"input-discount-amount\"\r\n                  name=\"discountAmount\"\r\n                  min=\"0\"\r\n                  formControlName=\"discountAmount\"\r\n                  placeholder=\"Discount {{\r\n                    couponForm.value.discountType === 'percentage' ? 'Percentage (%)' : 'Amount'\r\n                  }} \"\r\n                  fullWidth\r\n                  [status]=\"\r\n                    couponForm.get('discountAmount').touched\r\n                      ? couponForm.get('discountAmount').invalid ||\r\n                        couponForm.hasError('invalidDiscountPercentage')\r\n                        ? 'danger'\r\n                        : 'success'\r\n                      : 'basic'\r\n                  \"\r\n                />\r\n                <ng-container *ngIf=\"couponForm.get('discountAmount').touched\">\r\n                  <p\r\n                    class=\"caption status-danger\"\r\n                    *ngIf=\"couponForm.get('discountAmount').errors?.required\"\r\n                  >\r\n                    Discount Amount is required!\r\n                  </p>\r\n                  <p\r\n                    class=\"caption status-danger\"\r\n                    *ngIf=\"couponForm.get('discountAmount').errors?.min\"\r\n                  >\r\n                    Discount Amount should be more than or equal to 0\r\n                  </p>\r\n                  <p\r\n                    class=\"caption status-danger\"\r\n                    *ngIf=\"couponForm.hasError('invalidDiscountPercentage')\"\r\n                  >\r\n                    Discount Percentage should be between 0% to 100%\r\n                  </p>\r\n                </ng-container>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"col-md-6\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-expiry-date\">Expiry Date:</label>\r\n                <input\r\n                  type=\"date\"\r\n                  nbInput\r\n                  id=\"input-expiry-date\"\r\n                  name=\"expiryDate\"\r\n                  [min]=\"dateService.getDateString()\"\r\n                  formControlName=\"expiryDate\"\r\n                  placeholder=\"Expiry Date \"\r\n                  fullWidth\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"col-md-12\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-description\">Description:</label>\r\n                <textarea\r\n                  type=\"text\"\r\n                  nbInput\r\n                  id=\"input-description\"\r\n                  name=\"description\"\r\n                  formControlName=\"description\"\r\n                  placeholder=\"Description (Optional)\"\r\n                  fullWidth\r\n                ></textarea>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"col-md-12\">\r\n              <div class=\"form-control-group\">\r\n                <label class=\"label\" for=\"input-terms-and-conditions\">Terms & Conditions:</label>\r\n                <textarea\r\n                  type=\"text\"\r\n                  nbInput\r\n                  id=\"input-terms-and-conditions\"\r\n                  name=\"termsAndConditions\"\r\n                  formControlName=\"termsAndConditions\"\r\n                  placeholder=\"Terms & Conditions (Optional)\"\r\n                  fullWidth\r\n                ></textarea>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <hr />\r\n\r\n          <div class=\"row\">\r\n            <div class=\"col-md-12 text-right\">\r\n              <button nbButton size=\"small\" type=\"submit\">\r\n                <span>Next</span>\r\n                <nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </nb-step>\r\n\r\n      <nb-step label=\"Submit\">\r\n        <div class=\"step-container\">\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-bordered\">\r\n              <tbody>\r\n                <tr>\r\n                  <th>Coupon Code</th>\r\n                  <td>{{ couponForm.value.code }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Discount Type</th>\r\n                  <td>{{ couponForm.value.discountType | uppercase }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Discount Amount</th>\r\n                  <td>\r\n                    {{ couponForm.value.discountAmount }}\r\n                    {{ couponForm.value.discountType === 'percentage' ? '%' : '' }}\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Expiry Date</th>\r\n                  <td>{{ dateService.formatDate(couponForm.value.expiryDate) }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Description</th>\r\n                  <td>{{ couponForm.value.description }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <th>Terms & Conditions</th>\r\n                  <td>{{ couponForm.value.termsAndConditions }}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          <hr />\r\n\r\n          <div class=\"row\">\r\n            <div class=\"col-6 text-left\">\r\n              <button class=\"\" nbButton size=\"small\" nbStepperPrevious [disabled]=\"submit\">\r\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\r\n                <span>prev</span>\r\n              </button>\r\n            </div>\r\n            <div class=\"col-6 text-right\">\r\n              <button\r\n                nbButton\r\n                size=\"small\"\r\n                (click)=\"saveCoupon()\"\r\n                [disabled]=\"submit\"\r\n                [nbSpinner]=\"submit\"\r\n                nbSpinnerStatus=\"primary\"\r\n                nbSpinnerSize=\"small\"\r\n              >\r\n                <span>Submit</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nb-step>\r\n    </nb-stepper>\r\n  </nb-card-body>\r\n</nb-card>\r\n","import { DateService } from './../../../services/shared-services/date.service';\r\nimport { CouponService } from './../../../services/coupon.service';\r\nimport { CouponModel } from './../../../models/coupon.model';\r\nimport { NbDialogRef, NbToastrService, NbStepperComponent } from '@nebular/theme';\r\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\r\nimport { Component, OnInit, OnDestroy, ViewChild } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'ngx-add-coupon',\r\n  templateUrl: './add-coupon.component.html',\r\n  styleUrls: ['./add-coupon.component.scss'],\r\n})\r\nexport class AddCouponComponent implements OnInit, OnDestroy {\r\n  @ViewChild('stepper', { static: false }) stepper: NbStepperComponent;\r\n\r\n  loading: boolean;\r\n  submit: boolean;\r\n\r\n  private branchId: string;\r\n  private couponId: string;\r\n\r\n  coupon: CouponModel;\r\n  couponForm: FormGroup;\r\n\r\n  validCouponCode: boolean;\r\n\r\n  discountTypes: string[];\r\n  constructor(\r\n    public dateService: DateService,\r\n    private couponService: CouponService,\r\n    private toastrService: NbToastrService,\r\n\r\n    protected ref: NbDialogRef<AddCouponComponent>,\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loading = true;\r\n    this.submit = false;\r\n\r\n    this.discountTypes = this.couponService.getDiscountTypes();\r\n\r\n    this.validCouponCode = true;\r\n\r\n    this.couponService.getCouponData().subscribe((coupon: CouponModel) => {\r\n      this.coupon = coupon;\r\n\r\n      this.couponForm = new FormGroup(\r\n        {\r\n          code: new FormControl(coupon ? coupon.code : null, {\r\n            validators: [Validators.required],\r\n          }),\r\n          discountType: new FormControl(coupon ? coupon.discountType : this.discountTypes[0], {\r\n            validators: [Validators.required],\r\n          }),\r\n          discountAmount: new FormControl(coupon ? coupon.discountAmount : null, {\r\n            validators: [Validators.required, Validators.min(0)],\r\n          }),\r\n          expiryDate: new FormControl(coupon ? coupon.expiryDate : null, {\r\n            validators: [],\r\n          }),\r\n          description: new FormControl(coupon ? coupon.description : null, {\r\n            validators: [],\r\n          }),\r\n          termsAndConditions: new FormControl(coupon ? coupon.termsAndConditions : null, {\r\n            validators: [],\r\n          }),\r\n        },\r\n        {\r\n          validators: this.discountPercentageValidator.bind(this),\r\n        },\r\n      );\r\n\r\n      this.loading = false;\r\n    });\r\n  }\r\n\r\n  discountPercentageValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const discountType = group.value.discountType;\r\n    const amount = +group.value.discountAmount;\r\n    if (discountType === 'percentage' && amount > 100) {\r\n      return { invalidDiscountPercentage: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  checkCouponCode(code: any) {\r\n    if (this.coupon && this.coupon.code === code) {\r\n      this.validCouponCode = true;\r\n      return;\r\n    }\r\n    this.couponService.checkCoupon(code).subscribe(\r\n      (res: any) => {\r\n        this.validCouponCode = res.status;\r\n      },\r\n      (err: any) => {},\r\n    );\r\n  }\r\n\r\n  submitCoupon() {\r\n    this.couponForm.markAllAsTouched();\r\n    if (this.couponForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Coupon Details are required');\r\n      return;\r\n    } else if (!this.validCouponCode) {\r\n      this.showToastr('top-right', 'danger', 'This Coupon Code Already Exist');\r\n      return;\r\n    }\r\n    this.stepper.next();\r\n  }\r\n\r\n  saveCoupon() {\r\n    this.couponForm.markAllAsTouched();\r\n\r\n    if (this.couponForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Coupon Details are required');\r\n      return;\r\n    } else if (!this.validCouponCode) {\r\n      this.showToastr('top-right', 'danger', 'This Coupon Code Already Exist');\r\n      return;\r\n    }\r\n    this.submit = true;\r\n\r\n    const coupon: any = { ...this.couponForm.value };\r\n\r\n    if (!this.coupon) {\r\n      this.couponService.addCoupon(coupon).subscribe(\r\n        (resCoupon: CouponModel) => {\r\n          this.ref.close({ coupon: resCoupon, type: 'add' });\r\n        },\r\n        (error: any) => {\r\n          this.showToastr('top-right', 'danger', error);\r\n          this.submit = false;\r\n        },\r\n      );\r\n    } else {\r\n      coupon._id = this.coupon._id;\r\n\r\n      this.couponService.editCoupon(coupon).subscribe(\r\n        (res: any) => {\r\n          this.ref.close({ coupon: coupon, type: 'edit' });\r\n        },\r\n        (error: any) => {\r\n          this.showToastr('top-right', 'danger', error);\r\n          this.submit = false;\r\n        },\r\n      );\r\n    }\r\n  }\r\n\r\n  onClose() {\r\n    this.ref.close();\r\n  }\r\n\r\n  private showToastr(position: any, status: any, message: string) {\r\n    this.toastrService.show(status, message, {\r\n      position,\r\n      status,\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.couponService.deleteCouponData();\r\n  }\r\n}\r\n","<nb-card>\n  <nb-card-header>\n    <div class=\"row\">\n      <div class=\"col-md-9 col-sm-8\">\n        <h3>Coupons</h3>\n      </div>\n      <div class=\"col-md-3 col-sm-4\">\n        <button nbButton size=\"small\" status=\"primary\" fullWidth (click)=\"addCoupon()\">\n          Add Coupon <nb-icon icon=\"plus-circle-outline\"></nb-icon>\n        </button>\n      </div>\n    </div>\n  </nb-card-header>\n  <nb-card-body>\n    <div class=\"row\">\n      <div class=\"col-12\">\n        <div class=\"table-responsive\" *ngIf=\"coupons.length > 0; else noCoupons\">\n          <table class=\"table\">\n            <thead>\n              <th>#</th>\n              <th>Coupon Code</th>\n              <th>Discount</th>\n              <th>Expiry Date</th>\n              <th colspan=\"2\">Action</th>\n            </thead>\n            <tbody>\n              <tr *ngFor=\"let coupon of coupons; let i = index\">\n                <td>{{ i + 1 }}</td>\n                <td>{{ coupon.code }}</td>\n                <td>\n                  {{ coupon.discountAmount }}{{ coupon.discountType === 'percentage' ? '%' : '/-' }}\n                </td>\n                <td>{{ coupon.expiryDate ? dateService.formatDate(coupon.expiryDate) : '--' }}</td>\n                <td>\n                  <button\n                    type=\"button\"\n                    nbButton\n                    size=\"small\"\n                    status=\"basic\"\n                    (click)=\"editCoupon(coupon)\"\n                  >\n                    Edit\n                  </button>\n                </td>\n                <td>\n                  <button\n                    type=\"button\"\n                    nbButton\n                    size=\"small\"\n                    status=\"danger\"\n                    (click)=\"deleteCoupon(coupon._id)\"\n                  >\n                    Delete\n                  </button>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  </nb-card-body>\n</nb-card>\n\n<ng-template #noCoupons>\n  <p class=\"pt-5 pb-5 text-center\">\n    No Coupons\n  </p>\n</ng-template>\n","import { CouponComponent } from './coupon.component';\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: CouponComponent,\n  },\n\n  {\n    path: 'page-not-found',\n    loadChildren: () =>\n      import('../../shared/page-not-found/page-not-found.module').then((m) => m.PageNotFoundModule),\n  },\n\n  {\n    path: '**',\n    redirectTo: 'page-not-found',\n    pathMatch: 'full',\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class CouponRoutingModule {}\n","import { DateService } from './../../services/shared-services/date.service';\r\nimport { AddCouponComponent } from './add-coupon/add-coupon.component';\r\nimport { CouponModel } from './../../models/coupon.model';\r\nimport { NbToastrService, NbDialogService } from '@nebular/theme';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { CouponService } from './../../services/coupon.service';\r\nimport { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'ngx-coupon',\r\n  templateUrl: './coupon.component.html',\r\n  styleUrls: ['./coupon.component.scss'],\r\n})\r\nexport class CouponComponent implements OnInit {\r\n  loading: boolean;\r\n\r\n  coupons: CouponModel[];\r\n\r\n  constructor(\r\n    private couponService: CouponService,\r\n    public dateService: DateService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private toastrService: NbToastrService,\r\n    private dialogService: NbDialogService,\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loading = true;\r\n    this.coupons = [];\r\n\r\n    this.couponService.getCoupons().subscribe(\r\n      (coupons: CouponModel[]) => {\r\n        this.coupons = coupons;\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        this.showToastr('top-right', 'danger', error);\r\n        this.loading = false;\r\n      },\r\n    );\r\n  }\r\n\r\n  updateCoupon(coupon: { coupon: CouponModel; type: string }) {\r\n    if (coupon.type === 'add') {\r\n      this.coupons.push(coupon.coupon);\r\n      this.showToastr('top-right', 'success', 'Coupon Added Successfully');\r\n    } else {\r\n      const index = this.coupons.findIndex(\r\n        (curCoupon: CouponModel) => curCoupon._id === coupon.coupon._id,\r\n      );\r\n\r\n      if (index >= 0) {\r\n        this.coupons[index] = coupon.coupon;\r\n        this.showToastr('top-right', 'success', 'Coupon Updated Successfully');\r\n      }\r\n    }\r\n  }\r\n\r\n  openCouponDialog() {\r\n    this.dialogService\r\n      .open(AddCouponComponent, {\r\n        context: {},\r\n      })\r\n      .onClose.subscribe(\r\n        (coupon: { coupon: CouponModel; type: string }) => coupon && this.updateCoupon(coupon),\r\n      );\r\n  }\r\n\r\n  addCoupon() {\r\n    this.openCouponDialog();\r\n  }\r\n\r\n  editCoupon(coupon: CouponModel) {\r\n    this.couponService.setCouponData(coupon);\r\n    this.openCouponDialog();\r\n  }\r\n\r\n  deleteCoupon(id: string) {\r\n    this.loading = true;\r\n    this.couponService.deleteCoupon(id).subscribe(\r\n      (res: any) => {\r\n        const index = this.coupons.findIndex((coupon: CouponModel) => coupon._id === id);\r\n        if (index >= 0) {\r\n          this.coupons.splice(index, 1);\r\n          this.showToastr('top-right', 'success', 'Coupon Deleted Successfully');\r\n        }\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        this.showToastr('top-right', 'danger', error);\r\n        this.loading = false;\r\n      },\r\n    );\r\n  }\r\n\r\n  showToastr(position: any, status: any, message: string) {\r\n    this.toastrService.show(status, message, {\r\n      position,\r\n      status,\r\n    });\r\n  }\r\n}\r\n","import { ReactiveFormsModule } from '@angular/forms';\nimport {\n  NbCardModule,\n  NbInputModule,\n  NbButtonModule,\n  NbSelectModule,\n  NbIconModule,\n  NbSpinnerModule,\n  NbStepperModule,\n} from '@nebular/theme';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { CouponRoutingModule } from './coupon-routing.module';\nimport { CouponComponent } from './coupon.component';\nimport { AddCouponComponent } from './add-coupon/add-coupon.component';\n\n@NgModule({\n  declarations: [CouponComponent, AddCouponComponent],\n  imports: [\n    CommonModule,\n    CouponRoutingModule,\n    NbCardModule,\n    NbInputModule,\n    NbButtonModule,\n    NbSelectModule,\n    NbIconModule,\n    ReactiveFormsModule,\n    NbSpinnerModule,\n    NbStepperModule,\n  ],\n})\nexport class CouponModule {}\n"]}