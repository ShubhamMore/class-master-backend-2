function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var c=e[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{Dvlh:function(t,e,a){"use strict";a.r(e);var c=a("ofXK"),i=a("IAlr"),r=a("3Pt+"),b=a("lst6"),s=a("EQut"),n=a("no5z"),o=a("Pj/w"),u=a("fXoL"),l=a("aceb"),h=a("tyNb"),d=["stepper"];function f(t,e){1&t&&(u.Wb(0,"p",36),u.Cc(1," Batch Name is required! "),u.Vb())}function m(t,e){if(1&t&&(u.Ub(0),u.Ac(1,f,2,0,"p",35),u.Tb()),2&t){var a=u.gc();u.Eb(1),u.mc("ngIf",null==a.batchBasicDetailsForm.get("batchName").errors?null:a.batchBasicDetailsForm.get("batchName").errors.required)}}function v(t,e){1&t&&(u.Wb(0,"p",36),u.Cc(1," Batch Start Date is required! "),u.Vb())}function p(t,e){if(1&t&&(u.Ub(0),u.Ac(1,v,2,0,"p",35),u.Tb()),2&t){var a=u.gc();u.Eb(1),u.mc("ngIf",null==a.batchBasicDetailsForm.get("startDate").errors?null:a.batchBasicDetailsForm.get("startDate").errors.required)}}function g(t,e){if(1&t&&(u.Wb(0,"nb-option",44),u.Cc(1),u.Vb()),2&t){var a=e.$implicit;u.mc("value",a.employee),u.Eb(1),u.Dc(a.name)}}function V(t,e){if(1&t){var a=u.Xb();u.Ub(0),u.Wb(1,"div",37),u.Wb(2,"div",38),u.Wb(3,"div",8),u.Wb(4,"nb-checkbox",39),u.ec("checkedChange",(function(t){u.uc(a);var c=e.index;return u.gc().changeSubjectStatus(t,c)})),u.Wb(5,"label",40),u.Cc(6),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Wb(7,"div",38),u.Wb(8,"div",8),u.Wb(9,"nb-select",41),u.Wb(10,"nb-option",42),u.Cc(11,"Select Teacher "),u.Vb(),u.Ac(12,g,2,2,"nb-option",43),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Tb()}if(2&t){var c=e.$implicit,i=e.index,r=u.gc();u.Eb(1),u.mc("formGroup",c),u.Eb(3),u.oc("id","status-",i,""),u.mc("checked",c.value.status),u.Eb(1),u.oc("for","status-",i,""),u.Eb(1),u.Dc(r.getSubjectName(c.value.subject)),u.Eb(3),u.oc("id","teacher-",i,""),u.Eb(3),u.mc("ngForOf",r.teachers)}}function W(t,e){if(1&t&&(u.Wb(0,"tr"),u.Wb(1,"th"),u.Cc(2),u.Vb(),u.Wb(3,"td"),u.Cc(4),u.Vb(),u.Vb()),2&t){var a=u.gc().$implicit,c=u.gc();u.Eb(2),u.Dc(c.getSubjectName(a.value.subject)),u.Eb(2),u.Dc(c.getTeacherName(a.value.teacher))}}function B(t,e){if(1&t&&(u.Ub(0),u.Ac(1,W,5,2,"tr",11),u.Tb()),2&t){var a=e.$implicit;u.Eb(1),u.mc("ngIf",a.value.status)}}var S,D,j=[{path:"",component:(S=function(){function t(e,a,c,i,r,b,s){var n=this;_classCallCheck(this,t),this.branchService=e,this.branchEmployeeService=a,this.batchService=c,this.courseService=i,this.toastrService=r,this.router=b,this.route=s,this.route.queryParams.subscribe((function(t){n.ngOnInit()}))}return _createClass(t,[{key:"ngOnInit",value:function(){var t,e=this;if(this.loading=!0,this.branchId=this.branchService.getBranchId(),this.branchId)return this.courseService.getCourseData().subscribe((function(t){e.course=t,e.course||e.router.navigate(["../"],{relativeTo:e.route})})),this.batchId=this.batchService.getBatchId(),this.route.queryParams.subscribe((function(e){t=e.mode})),t&&"edit"!==t?(this.showToastr("top-right","danger","Invalid Route"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):t&&!this.batchId?(this.showToastr("top-right","danger","Batch Not Available"),void this.router.navigate(["../page-not-found"],{relativeTo:this.route})):(this.batchBasicDetailsForm=new r.f({batchName:new r.d(null,{validators:[r.u.required]}),startDate:new r.d(null,{validators:[r.u.required]}),rollNoPrefix:new r.d(null,{validators:[]}),description:new r.d(null,{validators:[]})}),this.batchSubjectForm=new r.f({subjects:new r.b([])},{validators:this.atLeastOneSubjectValidator.bind(this)}),this.teachers=[],this.subjects=this.course.subjects.filter((function(t){return t.status})),this.subjects.forEach((function(t){var a={_id:new n.a,subject:t._id,teacher:"",status:!0};e.addBatchSubject(a)})),void this.branchEmployeeService.getBranchEmployeeNameIdsForBatch(this.branchId,"teacher").subscribe((function(t){e.teachers=t,e.batchId?e.batchService.getBatchForEditing(e.batchId).subscribe((function(a){if(a){e.batch=a,e.batchBasicDetailsForm.patchValue({batchName:a.basicDetails.batchName,startDate:a.basicDetails.startDate,duration:a.basicDetails.rollNoPrefix,description:a.basicDetails.description});var c=a.subjects;e.subjects.forEach((function(a,i){var r=c.find((function(t){return t.subject===a._id})),b="";r&&(e.changeSubjectStatus(r.status,i),e.getBatchSubjects().controls[i].get("_id").setValue(r._id),t.find((function(t){return t.employee===r.teacher}))&&(b=r.teacher)),e.getBatchSubjects().controls[i].get("teacher").setValue(b)})),e.loading=!1}else e.router.navigate(["../page-not-found"],{relativeTo:e.route})}),(function(t){e.router.navigate(["../page-not-found"],{relativeTo:e.route})})):e.loading=!1}),(function(t){e.showToastr("top-right","danger",t),e.loading=!1})));this.router.navigate(["../"],{relativeTo:this.route})}},{key:"atLeastOneSubjectValidator",value:function(t){var e=!1;return t.value.subjects.forEach((function(t){t.status&&(e=!0)})),e?null:{atLeastOneSubjectError:!0}}},{key:"getBatchSubjects",value:function(){return this.batchSubjectForm.get("subjects")}},{key:"newBatchSubject",value:function(t){return new r.f({_id:new r.d(t._id?t._id:(new n.a).toString(),{validators:[r.u.required]}),subject:new r.d(t.subject?t.subject:null,{validators:[r.u.required]}),teacher:new r.d(t.teacher?t.teacher:"",{validators:[]}),status:new r.d(!t.status||t.status,{validators:[]})})}},{key:"addBatchSubject",value:function(t){this.getBatchSubjects().push(this.newBatchSubject(t))}},{key:"changeSubjectStatus",value:function(t,e){var a=this.getBatchSubjects().controls[e];a.get("status").setValue(t),t?a.get("teacher").enable():(a.get("teacher").setValue(""),a.get("teacher").disable())}},{key:"getSubjectName",value:function(t){var e=this.subjects.find((function(e){return e._id===t}));return e?e.subject:"--"}},{key:"getTeacherName",value:function(t){var e=this.teachers.find((function(e){return e.employee===t}));return e?e.name:"--"}},{key:"submitBasicDetails",value:function(){this.batchBasicDetailsForm.markAllAsTouched(),this.batchBasicDetailsForm.invalid?this.showToastr("top-right","danger","Basic details are required"):this.stepper.next()}},{key:"submitSubjects",value:function(){this.batchSubjectForm.markAllAsTouched(),this.batchSubjectForm.invalid?this.showToastr("top-right","danger","At least 1 Subject is required"):this.stepper.next()}},{key:"saveBatch",value:function(){var t=this;if(this.batchBasicDetailsForm.markAllAsTouched(),this.batchSubjectForm.markAllAsTouched(),this.batchBasicDetailsForm.invalid)this.showToastr("top-right","danger","Basic details are required");else if(this.batchSubjectForm.invalid)this.showToastr("top-right","danger","At least 1 Subject is required");else{this.loading=!0;var e={branch:this.branchId,category:this.course.basicDetails.category,course:this.course._id,basicDetails:this.batchBasicDetailsForm.value,subjects:this.batchSubjectForm.value.subjects};this.batch?(e._id=this.batch._id,this.batchService.editBatch(e).subscribe((function(e){t.showToastr("top-right","success","Batch Updated Successfully!"),t.router.navigate(["../"],{relativeTo:t.route})}),(function(e){t.showToastr("top-right","danger",e),t.loading=!1}))):this.batchService.addBatch(e).subscribe((function(e){t.showToastr("top-right","success","New Batch Added Successfully!"),t.router.navigate(["../"],{relativeTo:t.route})}),(function(e){t.showToastr("top-right","danger",e),t.loading=!1}))}}},{key:"showToastr",value:function(t,e,a){this.toastrService.show(e,a,{position:t,status:e})}},{key:"back",value:function(){this.router.navigate(["../"],{relativeTo:this.route})}},{key:"ngOnDestroy",value:function(){this.batchService.deleteBatchId()}}]),t}(),S.\u0275fac=function(t){return new(t||S)(u.Qb(s.a),u.Qb(o.a),u.Qb(b.a),u.Qb(i.a),u.Qb(l.xb),u.Qb(h.c),u.Qb(h.a))},S.\u0275cmp=u.Kb({type:S,selectors:[["ngx-add-batch"]],viewQuery:function(t,e){var a;1&t&&u.Hc(d,!0),2&t&&u.rc(a=u.fc())&&(e.stepper=a.first)},decls:97,vars:17,consts:[["nbButton","","status","warning","size","tiny",1,"float-right",3,"click"],[1,""],[3,"linear"],["stepper",""],["label","Basic Details",3,"stepControl"],[1,"",3,"formGroup","submit"],[1,"row"],[1,"col-md-4"],[1,"form-control-group"],["for","input -batch-name",1,"label"],["type","text","nbInput","","id","input-batch-name","name","batchName","formControlName","batchName","placeholder","Batch Name","maxlength","30","fullWidth","",3,"status"],[4,"ngIf"],["for","input -batch-start-date",1,"label"],["type","date","nbInput","","id","input-batch-start-date","name","startDate","formControlName","startDate","fullWidth","",3,"status"],["for","input-rollNoPrefix",1,"label"],["type","text","nbInput","","id","input-rollNoPrefix","name","rollNoPrefix","maxlength","15","formControlName","rollNoPrefix","placeholder","Roll No Prefix","fullWidth",""],[1,"col-md-12"],["for","input-billing-description",1,"label"],["type","text","nbInput","","id","input-description","name","description","formControlName","description","placeholder","Description (Optional)","fullWidth",""],[1,"col-md-12","text-right"],["nbButton","","type","submit"],["icon","arrow-ios-forward-outline"],["label","Subject Details",3,"stepControl"],[1,"step-container",3,"formGroup","ngSubmit"],[4,"ngFor","ngForOf"],[1,"col-md-6","text-left"],["nbButton","","nbStepperPrevious","",1,""],["icon","arrow-ios-back-outline"],[1,"col-md-6","text-right"],["label","Submit"],[1,"step-container"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"table","table-sm","table-borderless"],["nbButton","",3,"click"],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"],[1,"row","mb-3",3,"formGroup"],[1,"col-md-4","col-sm-6","mx-auto"],["name","status","formControlName","status",3,"id","checked","checkedChange"],[3,"for"],["name","teacher","formControlName","teacher","placeholder","Select Teacher","fullWidth","",3,"id"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(u.Wb(0,"nb-card"),u.Wb(1,"nb-card-header"),u.Wb(2,"button",0),u.ec("click",(function(){return e.back()})),u.Cc(3," Back "),u.Vb(),u.Wb(4,"h3",1),u.Cc(5),u.hc(6,"uppercase"),u.Vb(),u.Vb(),u.Wb(7,"nb-card-body"),u.Wb(8,"nb-stepper",2,3),u.Wb(10,"nb-step",4),u.Wb(11,"form",5),u.ec("submit",(function(){return e.submitBasicDetails()})),u.Wb(12,"h6"),u.Cc(13,"Batch Details:"),u.Vb(),u.Wb(14,"div",6),u.Wb(15,"div",7),u.Wb(16,"div",8),u.Wb(17,"label",9),u.Cc(18,"Batch Name:"),u.Vb(),u.Rb(19,"input",10),u.Ac(20,m,2,1,"ng-container",11),u.Vb(),u.Vb(),u.Wb(21,"div",7),u.Wb(22,"div",8),u.Wb(23,"label",12),u.Cc(24,"Batch Start Date:"),u.Vb(),u.Rb(25,"input",13),u.Ac(26,p,2,1,"ng-container",11),u.Vb(),u.Vb(),u.Wb(27,"div",7),u.Wb(28,"div",8),u.Wb(29,"label",14),u.Cc(30,"Roll No Prefix:"),u.Vb(),u.Rb(31,"input",15),u.Vb(),u.Vb(),u.Wb(32,"div",16),u.Wb(33,"div",8),u.Wb(34,"label",17),u.Cc(35,"Description:"),u.Vb(),u.Rb(36,"textarea",18),u.Vb(),u.Vb(),u.Vb(),u.Rb(37,"hr"),u.Wb(38,"div",6),u.Wb(39,"div",19),u.Wb(40,"button",20),u.Wb(41,"span"),u.Cc(42,"Next"),u.Vb(),u.Rb(43,"nb-icon",21),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Wb(44,"nb-step",22),u.Wb(45,"form",23),u.ec("ngSubmit",(function(){return e.submitSubjects()})),u.Ac(46,V,13,7,"ng-container",24),u.Rb(47,"hr"),u.Wb(48,"div",6),u.Wb(49,"div",25),u.Wb(50,"button",26),u.Rb(51,"nb-icon",27),u.Wb(52,"span"),u.Cc(53,"prev"),u.Vb(),u.Vb(),u.Vb(),u.Wb(54,"div",28),u.Wb(55,"button",20),u.Wb(56,"span"),u.Cc(57,"Next"),u.Vb(),u.Rb(58,"nb-icon",21),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Wb(59,"nb-step",29),u.Wb(60,"div",30),u.Wb(61,"div",31),u.Wb(62,"table",32),u.Wb(63,"tbody"),u.Wb(64,"tr"),u.Wb(65,"th"),u.Cc(66,"Batch Name"),u.Vb(),u.Wb(67,"td"),u.Cc(68),u.Vb(),u.Vb(),u.Wb(69,"tr"),u.Wb(70,"th"),u.Cc(71,"Batch Roll No Prefix"),u.Vb(),u.Wb(72,"td"),u.Cc(73),u.Vb(),u.Vb(),u.Wb(74,"tr"),u.Wb(75,"th"),u.Cc(76,"Description"),u.Vb(),u.Wb(77,"td"),u.Cc(78),u.Vb(),u.Vb(),u.Wb(79,"tr"),u.Wb(80,"th"),u.Cc(81,"Subjects"),u.Vb(),u.Wb(82,"td"),u.Wb(83,"table",33),u.Wb(84,"tbody"),u.Ac(85,B,2,1,"ng-container",24),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Rb(86,"hr"),u.Wb(87,"div",6),u.Wb(88,"div",25),u.Wb(89,"button",26),u.Rb(90,"nb-icon",27),u.Wb(91,"span"),u.Cc(92,"prev"),u.Vb(),u.Vb(),u.Vb(),u.Wb(93,"div",28),u.Wb(94,"button",34),u.ec("click",(function(){return e.saveBatch()})),u.Wb(95,"span"),u.Cc(96,"Submit"),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb()),2&t&&(u.Eb(5),u.Ec(" ",e.batch?"Edit Batch "+u.ic(6,15,e.batch.basicDetails.batchName):"Add New Batch"," "),u.Eb(3),u.mc("linear",!0),u.Eb(2),u.mc("stepControl",e.batchBasicDetailsForm),u.Eb(1),u.mc("formGroup",e.batchBasicDetailsForm),u.Eb(8),u.mc("status",e.batchBasicDetailsForm.get("batchName").touched?e.batchBasicDetailsForm.get("batchName").invalid?"danger":"success":"basic"),u.Eb(1),u.mc("ngIf",e.batchBasicDetailsForm.get("batchName").invalid&&e.batchBasicDetailsForm.get("batchName").touched),u.Eb(5),u.mc("status",e.batchBasicDetailsForm.get("startDate").touched?e.batchBasicDetailsForm.get("startDate").invalid?"danger":"success":"basic"),u.Eb(1),u.mc("ngIf",e.batchBasicDetailsForm.get("startDate").invalid&&e.batchBasicDetailsForm.get("startDate").touched),u.Eb(18),u.mc("stepControl",e.batchSubjectForm),u.Eb(1),u.mc("formGroup",e.batchSubjectForm),u.Eb(1),u.mc("ngForOf",e.batchSubjectForm.get("subjects").controls),u.Eb(22),u.Dc(e.batchBasicDetailsForm.value.batchName),u.Eb(5),u.Dc(e.batchBasicDetailsForm.value.rollNoPrefix),u.Eb(5),u.Dc(e.batchBasicDetailsForm.value.description),u.Eb(7),u.mc("ngForOf",e.batchSubjectForm.get("subjects").controls))},directives:[l.x,l.z,l.u,l.w,l.pb,l.ob,r.v,r.n,r.g,l.O,r.a,r.m,r.e,r.i,c.n,l.L,c.m,l.rb,l.C,l.jb,l.eb],pipes:[c.v],styles:[""]}),S)},{path:"page-not-found",loadChildren:function(){return a.e(0).then(a.bind(null,"DeSt")).then((function(t){return t.PageNotFoundModule}))}},{path:"**",redirectTo:"page-not-found",pathMatch:"full"}],C=((D=function t(){_classCallCheck(this,t)}).\u0275mod=u.Ob({type:D}),D.\u0275inj=u.Nb({factory:function(t){return new(t||D)},imports:[[h.g.forChild(j)],h.g]}),D);a.d(e,"AddBatchModule",(function(){return N}));var w,N=((w=function t(){_classCallCheck(this,t)}).\u0275mod=u.Ob({type:w}),w.\u0275inj=u.Nb({factory:function(t){return new(t||w)},imports:[[c.c,C,l.A,l.v,l.kb,l.N,l.P,l.K,l.D,l.qb,l.K,r.s]]}),w)}}]);