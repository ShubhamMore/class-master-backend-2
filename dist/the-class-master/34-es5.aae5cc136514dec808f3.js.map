{"version":3,"sources":["webpack:///src/app/institute/branch/student/student-course/add-student-course/add-student-course.component.html","webpack:///src/app/institute/branch/student/student-course/add-student-course/add-student-course-routing.module.ts","webpack:///src/app/institute/branch/student/student-course/add-student-course/add-student-course.component.ts","webpack:///src/app/institute/branch/student/student-course/add-student-course/add-student-course.module.ts"],"names":["AddStudentCourseComponent","AddStudentCourseModule","AddStudentCourseRoutingModule","routes","path","component","dateService","toastrService","branchService","courseService","batchService","discountAndOfferService","studentService","studentCourseService","studentCourseInstallmentService","router","route","mode","this","loading","submit","branchId","getBranchId","categoryId","getCategoryId","studentId","getStudentId","studentCourseId","getStudentCourseId","queryParams","subscribe","param","showToastr","navigate","relativeTo","discounts","courses","batches","courseBatches","discountTypes","rollNumberAlreadyExist","getCoursesData","getBatchesData","getDiscountAndOffersData","discountAndOffers","getDiscountTypes","studentCourseForm","course","validators","required","batch","rollNumber","min","discount","additionalDiscountType","length","additionalDiscountAmount","activationDate","getDateString","netPayable","discountPercentageValidator","bind","studentCourseFeeForm","installmentType","date","noOfInstallments","pendingAmount","amountCollected","totalAmount","studentCourseInstallmentForm","installments","getStudentCourseForEditing","res","studentCourse","studentCourseInstallment","patchValue","onSelectCourse","disableStudentCourseDetails","disableStudentCourseFeeForm","resetStudentCourseInstallments","forEach","installment","i","addStudentCourseInstallment","receiptId","getStudentCourseInstallments","get","disable","disableStudentCourseInstallmentFields","err","back","group","discountType","getRawValue","amount","invalidDiscountPercentage","batchId","toString","courseId","checkBatchRollNumber","rollNumberExist","filter","curBatch","find","curCourse","_id","calculateNetPayableAmount","toFixed","enable","checkRollNumber","discountId","curDicount","additionalDiscount","totalDiscountPercentage","totalDiscountAmount","totalFee","feeDetails","totalFees","discountAmount","calculatePendingAmount","onSelectInstallmentType","controls","installmentNo","installmentDate","installmentAmount","amountPending","status","minInstallmentAmountValidator","maxInstallmentAmountValidator","minInstallmentPendingAmountValidator","maxInstallmentPendingAmountValidator","getMinInstallmentAmount","invalidMinInstallmentAmount","getMaxInstallmentAmount","invalidMaxInstallmentAmount","getMinInstallmentPendingAmount","invalidMinInstallmentPendingAmount","getMaxInstallmentPendingAmount","push","newStudentCourseInstallment","generateNoOfInstallments","basicDetails","duration","installmentDuration","millisecondsToDateString","dateToMilliseconds","installmentData","Math","ceil","enableStudentCourseInstallmentFields","getNoOfInstallments","noOfUnchangedInstallments","j","curAmountPending","index","stepper","previous","markAllAsTouched","invalid","enableStudentCourseDetails","next","validateStudentCourseInstallmentForm","invalidInstallments","studentCourseDetails","branch","category","student","studentCourseInstallmentDetails","editStudentCourse","addStudentCourse","position","message","show","courseName","batchName","curDiscount","offerName","code","replaceUrl","loadChildren","then","m","PageNotFoundModule","redirectTo","pathMatch","forChild"],"mappings":"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","file":"x","sourcesContent":["<nb-card *ngIf=\"!loading\">\n  <nb-card-header>\n    <button\n      type=\"button\"\n      class=\"float-right\"\n      nbButton\n      size=\"small\"\n      status=\"warning\"\n      (click)=\"back()\"\n    >\n      Back\n    </button>\n    <h3 class=\"\">\n      {{ !studentCourse ? 'New Student Course' : 'Edit Student Course' }}\n    </h3>\n  </nb-card-header>\n  <nb-card-body>\n    <nb-stepper #stepper [linear]=\"true\" [disableStepNavigation]=\"true\">\n      <nb-step [stepControl]=\"studentCourseForm\" label=\"Course Details\">\n        <form class=\"\" (submit)=\"studentCourseFormSubmit()\" [formGroup]=\"studentCourseForm\">\n          <div class=\"row\">\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-student-course\">Course:</label>\n                <nb-select\n                  id=\"input-student-course\"\n                  name=\"course\"\n                  formControlName=\"course\"\n                  placeholder=\"Select Course\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseForm.get('course').touched\n                      ? studentCourseForm.get('course').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (selectedChange)=\"onSelectCourse($event)\"\n                >\n                  <nb-option value=\"\">Select Course</nb-option>\n                  <nb-option *ngFor=\"let course of courses\" [value]=\"course._id\">{{\n                    course.basicDetails.courseName\n                  }}</nb-option>\n                </nb-select>\n                <ng-container\n                  *ngIf=\"\n                    studentCourseForm.get('course').invalid &&\n                    studentCourseForm.get('course').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('course').errors?.required\"\n                  >\n                    Student Course is required!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-student-batch\">Batch:</label>\n                <nb-select\n                  id=\"input-student-batch\"\n                  name=\"batch\"\n                  formControlName=\"batch\"\n                  placeholder=\"Select Batch\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseForm.get('batch').touched\n                      ? studentCourseForm.get('batch').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (selectedChange)=\"onSelectBatch($event)\"\n                >\n                  <nb-option value=\"\">Select Batch</nb-option>\n                  <nb-option *ngFor=\"let batch of courseBatches\" [value]=\"batch._id\">{{\n                    batch.basicDetails.batchName\n                  }}</nb-option>\n                </nb-select>\n                <ng-container\n                  *ngIf=\"\n                    studentCourseForm.get('batch').invalid && studentCourseForm.get('batch').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('batch').errors?.required\"\n                  >\n                    Student Batch is required!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-roll-number\">Roll Number:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-roll-number\"\n                  name=\"rollNumber\"\n                  formControlName=\"rollNumber\"\n                  min=\"1\"\n                  placeholder=\"Roll Number\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseForm.get('rollNumber').touched\n                      ? studentCourseForm.get('rollNumber').invalid || rollNumberAlreadyExist\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (input)=\"checkRollNumber()\"\n                />\n                <ng-container\n                  *ngIf=\"\n                    (studentCourseForm.get('rollNumber').invalid || rollNumberAlreadyExist) &&\n                    studentCourseForm.get('rollNumber').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('rollNumber').errors?.required\"\n                  >\n                    Roll Number is required!\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('rollNumber').errors?.min\"\n                  >\n                    Roll Number should be greater than 0\n                  </p>\n                  <p class=\"caption status-danger\" *ngIf=\"rollNumberAlreadyExist\">\n                    This roll number already Exist!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-student-discount\">Discount/Offer:</label>\n                <nb-select\n                  id=\"input-student-discount\"\n                  name=\"discount\"\n                  formControlName=\"discount\"\n                  placeholder=\"Select Discount\"\n                  fullWidth\n                  (selectedChange)=\"onSelectDiscount($event)\"\n                >\n                  <nb-option value=\"\">Select Discount</nb-option>\n                  <nb-option *ngFor=\"let discount of discounts\" [value]=\"discount._id\">{{\n                    getDiscount(discount._id)\n                  }}</nb-option>\n                </nb-select>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-additional-discount-type\"\n                  >Additional Discount Type:</label\n                >\n                <nb-select\n                  id=\"input-additional-discount-type\"\n                  name=\"additionalDiscountType\"\n                  formControlName=\"additionalDiscountType\"\n                  placeholder=\"Select Discount Type\"\n                  fullWidth\n                  [selected]=\"discountTypes.length > 0 ? discountTypes[0] : ''\"\n                  (selectedChange)=\"changeAdditionalDiscountType()\"\n                >\n                  <nb-option *ngFor=\"let discountType of discountTypes\" [value]=\"discountType\">{{\n                    discountType | uppercase\n                  }}</nb-option>\n                </nb-select>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-discount-amount\">Additional Discount Amount:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-discount-amount\"\n                  name=\"additionalDiscountAmount\"\n                  formControlName=\"additionalDiscountAmount\"\n                  placeholder=\"Discount Amount\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseForm.get('additionalDiscountAmount').touched\n                      ? studentCourseForm.get('additionalDiscountAmount').invalid ||\n                        studentCourseForm.hasError('invalidDiscountPercentage')\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (input)=\"onAdditionalDiscountAmount($event.target.value)\"\n                />\n                <ng-container *ngIf=\"studentCourseForm.get('additionalDiscountAmount').touched\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('additionalDiscountAmount').errors?.min\"\n                  >\n                    Discount Amount should be more than or equal to 0\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.hasError('invalidDiscountPercentage')\"\n                  >\n                    Discount Percentage should be between 0% to 100%\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-6\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-activation-date\">Activation Date:</label>\n                <input\n                  type=\"date\"\n                  nbInput\n                  id=\"input-activation-date\"\n                  name=\"activationDate\"\n                  formControlName=\"activationDate\"\n                  placeholder=\"Activation Date\"\n                  fullWidth\n                  [status]=\"studentCourseForm.get('activationDate').invalid ? 'danger' : 'success'\"\n                />\n                <ng-container *ngIf=\"studentCourseForm.get('activationDate').invalid\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('activationDate').errors?.required\"\n                  >\n                    Activation date is required\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-6\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-net-payable\">Net Payable:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-net-payable\"\n                  name=\"netPayable\"\n                  formControlName=\"netPayable\"\n                  placeholder=\"Net Payable\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseForm.get('netPayable').touched\n                      ? studentCourseForm.get('netPayable').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  disabled=\"true\"\n                />\n                <ng-container\n                  *ngIf=\"\n                    studentCourseForm.get('netPayable').invalid &&\n                    studentCourseForm.get('netPayable').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('netPayable').errors?.required\"\n                  >\n                    Net Payable Amount is Required\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseForm.get('netPayable').errors?.min\"\n                  >\n                    Net Payable Amount should be greater than 0\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-md-12 text-right\">\n              <button nbButton size=\"small\" type=\"submit\">\n                <span>Next</span>\n                <nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\n              </button>\n            </div>\n          </div>\n        </form>\n      </nb-step>\n\n      <nb-step [stepControl]=\"studentCourseFeeForm\" label=\"Course Fee Details\">\n        <form\n          [formGroup]=\"studentCourseFeeForm\"\n          (ngSubmit)=\"studentCourseFeeFormSubmit()\"\n          class=\"step-container\"\n        >\n          <div class=\"row\">\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-date\">Date:</label>\n                <input\n                  type=\"date\"\n                  nbInput\n                  id=\"input-date\"\n                  name=\"date\"\n                  formControlName=\"date\"\n                  placeholder=\"Date\"\n                  fullWidth\n                  [status]=\"studentCourseFeeForm.get('date').invalid ? 'danger' : 'success'\"\n                />\n                <ng-container *ngIf=\"studentCourseFeeForm.get('date').invalid\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('date').errors?.required\"\n                  >\n                    Date is required\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-course-installment-type\">Installment Type:</label>\n                <nb-select\n                  id=\"input-course-installment-type\"\n                  name=\"installmentType\"\n                  formControlName=\"installmentType\"\n                  placeholder=\"Select Installment Type\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseFeeForm.get('installmentType').touched\n                      ? studentCourseFeeForm.get('installmentType').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (selectedChange)=\"onSelectInstallmentType($event)\"\n                >\n                  <nb-option value=\"0\">Pay Once</nb-option>\n                  <nb-option value=\"1\">Pay Twice</nb-option>\n                  <nb-option value=\"2\">Pay Quarterly</nb-option>\n                  <nb-option value=\"3\">Pay Monthly</nb-option>\n                  <nb-option value=\"4\">Pay Custom</nb-option>\n                </nb-select>\n                <ng-container\n                  *ngIf=\"\n                    studentCourseFeeForm.get('installmentType').invalid &&\n                    studentCourseFeeForm.get('installmentType').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('installmentType').errors?.required\"\n                  >\n                    Student Course is required!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-noOfInstallments\">Number of Installments:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-noOfInstallments\"\n                  name=\"noOfInstallments\"\n                  formControlName=\"noOfInstallments\"\n                  placeholder=\"Number of Installments\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseFeeForm.get('noOfInstallments').touched\n                      ? studentCourseFeeForm.get('noOfInstallments').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                  (input)=\"generateNoOfInstallments($event.target.value)\"\n                />\n                <ng-container\n                  *ngIf=\"\n                    studentCourseFeeForm.get('noOfInstallments').invalid &&\n                    studentCourseFeeForm.get('noOfInstallments').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('noOfInstallments').errors?.required\"\n                  >\n                    Number of Installments are Required\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('noOfInstallments').errors?.min\"\n                  >\n                    Number of Installments should be greater than 0\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-pendingAmount\">Pending Amount:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-pendingAmount\"\n                  name=\"pendingAmount\"\n                  formControlName=\"pendingAmount\"\n                  placeholder=\"Pending Amount\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseFeeForm.get('pendingAmount').invalid ? 'danger' : 'success'\n                  \"\n                  disabled=\"true\"\n                />\n                <ng-container *ngIf=\"studentCourseFeeForm.get('pendingAmount').invalid\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('pendingAmount').errors?.required\"\n                  >\n                    Pending Amount is Required\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('pendingAmount').errors?.min\"\n                  >\n                    Pending Amount should be greater than 0\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-amountCollected\">Amount Collected:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-amountCollected\"\n                  name=\"amountCollected\"\n                  formControlName=\"amountCollected\"\n                  placeholder=\"Amount Collected\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"\n                    studentCourseFeeForm.get('amountCollected').invalid ? 'danger' : 'success'\n                  \"\n                  disabled=\"true\"\n                />\n                <ng-container *ngIf=\"studentCourseFeeForm.get('amountCollected').invalid\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('amountCollected').errors?.required\"\n                  >\n                    Collected Amount is Required\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('amountCollected').errors?.min\"\n                  >\n                    Collected Amount should be greater than 0\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-totalAmount\">Total Payable Amount:</label>\n                <input\n                  type=\"number\"\n                  nbInput\n                  id=\"input-totalAmount\"\n                  name=\"totalAmount\"\n                  formControlName=\"totalAmount\"\n                  placeholder=\"Total Amount\"\n                  min=\"0\"\n                  fullWidth\n                  [status]=\"studentCourseFeeForm.get('totalAmount').invalid ? 'danger' : 'success'\"\n                  disabled=\"true\"\n                />\n                <ng-container *ngIf=\"studentCourseFeeForm.get('totalAmount').invalid\">\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('totalAmount').errors?.required\"\n                  >\n                    Total Amount is Required\n                  </p>\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"studentCourseFeeForm.get('totalAmount').errors?.min\"\n                  >\n                    Total Amount should be greater than 0\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-6 text-left\">\n              <button type=\"button\" class=\"\" nbButton size=\"small\" (click)=\"previousStep()\">\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\n                <span>prev</span>\n              </button>\n            </div>\n            <div class=\"col-6 text-right\">\n              <button nbButton size=\"small\" type=\"submit\">\n                <span>Next</span><nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\n              </button>\n            </div>\n          </div>\n        </form>\n      </nb-step>\n\n      <nb-step [stepControl]=\"studentCourseInstallmentForm\" label=\"Installment Details\">\n        <form\n          [formGroup]=\"studentCourseInstallmentForm\"\n          (ngSubmit)=\"studentCourseInstallmentFormSubmit()\"\n          class=\"step-container\"\n        >\n          <div class=\"row\">\n            <div class=\"col-md-12\">\n              <div\n                class=\"table-responsive\"\n                *ngIf=\"\n                  !!getNoOfInstallments() &&\n                    studentCourseInstallmentForm.get('installments')['controls'].length > 0;\n                  else noInstallments\n                \"\n              >\n                <table class=\"table table-bordered\">\n                  <thead>\n                    <tr>\n                      <th>Installment Number</th>\n                      <th>Installment Date</th>\n                      <th>Installment Amount</th>\n                      <th>Pending Amount after This Installment</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <ng-container\n                      *ngFor=\"\n                        let installment of studentCourseInstallmentForm.get('installments')[\n                          'controls'\n                        ];\n                        let i = index\n                      \"\n                    >\n                      <tr [formGroup]=\"installment\">\n                        <td>Installment {{ installment.getRawValue().installmentNo }}</td>\n                        <td>\n                          <div class=\"form-control-group\">\n                            <input\n                              type=\"date\"\n                              nbInput\n                              id=\"input-installmentDate-{{ i }}\"\n                              name=\"installmentDate-{{ i }}\"\n                              formControlName=\"installmentDate\"\n                              placeholder=\"Installment Date\"\n                              fullWidth\n                              [min]=\"getMinInstallmentDate(i)\"\n                              [max]=\"getMaxInstallmentDate(i)\"\n                              [status]=\"\n                                installment.get('installmentDate').touched\n                                  ? installment.get('installmentDate').invalid\n                                    ? 'danger'\n                                    : 'success'\n                                  : 'basic'\n                              \"\n                            />\n                            <ng-container\n                              *ngIf=\"\n                                installment.get('installmentDate').touched &&\n                                installment.get('installmentDate').invalid\n                              \"\n                            >\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.get('installmentDate').errors?.required\"\n                              >\n                                Installment {{ i + 1 }} Date is required\n                              </p>\n                            </ng-container>\n                          </div>\n                        </td>\n\n                        <td>\n                          <div class=\"form-control-group\">\n                            <input\n                              type=\"number\"\n                              nbInput\n                              id=\"input-installmentAmount-{{ i }}\"\n                              name=\"installmentAmount-{{ i }}\"\n                              formControlName=\"installmentAmount\"\n                              placeholder=\"Installment Amount\"\n                              [min]=\"getMinInstallmentAmount(i)\"\n                              [max]=\"getMaxInstallmentAmount(i)\"\n                              fullWidth\n                              [status]=\"\n                                installment.get('installmentAmount').touched\n                                  ? installment.get('installmentAmount').invalid ||\n                                    installment.hasError('invalidMinInstallmentAmount') ||\n                                    installment.hasError('invalidMaxInstallmentAmount')\n                                    ? 'danger'\n                                    : 'success'\n                                  : 'basic'\n                              \"\n                              (input)=\"customInstallmentAmount($event.target.value, i)\"\n                            />\n                            <ng-container *ngIf=\"installment.get('installmentAmount').touched\">\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.get('installmentAmount').errors?.required\"\n                              >\n                                Installment {{ i + 1 }} Amount is Required\n                              </p>\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.hasError('invalidMinInstallmentAmount')\"\n                              >\n                                Installment {{ i + 1 }} Amount should be Minimum\n                                {{ getMinInstallmentAmount(i) }}\n                              </p>\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.hasError('invalidMaxInstallmentAmount')\"\n                              >\n                                Installment {{ i + 1 }} Amount should be Maximum\n                                {{ getMaxInstallmentAmount(i) }}\n                              </p>\n                            </ng-container>\n                          </div>\n                        </td>\n\n                        <td>\n                          <div class=\"form-control-group\">\n                            <input\n                              type=\"number\"\n                              nbInput\n                              id=\"input-amountPending-{{ i }}\"\n                              name=\"amountPending-{{ i }}\"\n                              formControlName=\"amountPending\"\n                              placeholder=\"Pending Amount\"\n                              [min]=\"getMinInstallmentPendingAmount(i)\"\n                              [max]=\"getMaxInstallmentPendingAmount(i)\"\n                              fullWidth\n                              [status]=\"\n                                installment.get('amountPending').touched\n                                  ? installment.get('amountPending').invalid ||\n                                    installment.hasError('invalidMinInstallmentPendingAmount') ||\n                                    installment.hasError('invalidMaxInstallmentPendingAmount')\n                                    ? 'danger'\n                                    : 'success'\n                                  : 'basic'\n                              \"\n                              disabled=\"true\"\n                            />\n                            <ng-container *ngIf=\"installment.get('amountPending').touched\">\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.get('amountPending').errors?.required\"\n                              >\n                                Installment {{ i + 1 }} Pending Amount is Required\n                              </p>\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.hasError('invalidMinInstallmentPendingAmount')\"\n                              >\n                                Installment {{ i + 1 }} Pending Amount should be Minimum\n                                {{ getMinInstallmentPendingAmount(i) }}\n                              </p>\n                              <p\n                                class=\"caption status-danger\"\n                                *ngIf=\"installment.hasError('invalidMaxInstallmentPendingAmount')\"\n                              >\n                                Installment {{ i + 1 }} Pending Amount should be Maximum\n                                {{ getMaxInstallmentPendingAmount(i) }}\n                              </p>\n                            </ng-container>\n                          </div>\n                        </td>\n                      </tr>\n                    </ng-container>\n                  </tbody>\n                </table>\n              </div>\n              <ng-template #noInstallments>\n                <p class=\"mt-4 text-center\">No Installments</p>\n              </ng-template>\n            </div>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-6 text-left\">\n              <button type=\"button\" class=\"\" nbButton size=\"small\" (click)=\"previousStep()\">\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\n                <span>prev</span>\n              </button>\n            </div>\n            <div class=\"col-6 text-right\">\n              <button nbButton size=\"small\" type=\"submit\">\n                <span>Next</span><nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\n              </button>\n            </div>\n          </div>\n        </form>\n      </nb-step>\n\n      <nb-step label=\"Submit\">\n        <div class=\"step-container\">\n          <div class=\"table-responsive\">\n            <table class=\"table table-bordered\">\n              <tbody>\n                <tr>\n                  <th colspan=\"2\">Course Details</th>\n                </tr>\n                <tr>\n                  <th>Course</th>\n                  <td>{{ getCourse(studentCourseForm.getRawValue().course) }}</td>\n                </tr>\n                <tr>\n                  <th>Batch</th>\n                  <td>{{ getBatch(studentCourseForm.getRawValue().batch) }}</td>\n                </tr>\n                <tr>\n                  <th>Roll Number</th>\n                  <td>{{ studentCourseForm.getRawValue().rollNumber }}</td>\n                </tr>\n                <tr>\n                  <th>Discount</th>\n                  <td>{{ getDiscount(studentCourseForm.getRawValue().discount) }}</td>\n                </tr>\n                <tr>\n                  <th>Additional Discount</th>\n                  <td>\n                    {{\n                      studentCourseForm.getRawValue().additionalDiscountAmount\n                        ? studentCourseForm.getRawValue().additionalDiscountAmount +\n                          (studentCourseForm.getRawValue().additionalDiscountType === 'percentage'\n                            ? '%'\n                            : '')\n                        : '--'\n                    }}\n                  </td>\n                </tr>\n                <tr>\n                  <th>Net Payable</th>\n                  <td>{{ getAmount(studentCourseForm.getRawValue().netPayable) }}</td>\n                </tr>\n                <tr>\n                  <th>Activation Date</th>\n                  <td>\n                    {{ dateService.formatDate(studentCourseForm.getRawValue().activationDate) }}\n                  </td>\n                </tr>\n                <tr>\n                  <th colspan=\"2\">Course Fee Details</th>\n                </tr>\n                <tr>\n                  <th>Date</th>\n                  <td>{{ dateService.formatDate(studentCourseFeeForm.getRawValue().date) }}</td>\n                </tr>\n                <tr>\n                  <th>Number of Installments</th>\n                  <td>{{ studentCourseFeeForm.getRawValue().noOfInstallments }}</td>\n                </tr>\n                <tr>\n                  <th>Amount Collected</th>\n                  <td>{{ getAmount(studentCourseFeeForm.getRawValue().amountCollected) }}</td>\n                </tr>\n                <tr>\n                  <th>Pending Amount</th>\n                  <td>{{ getAmount(studentCourseFeeForm.getRawValue().pendingAmount) }}</td>\n                </tr>\n                <tr>\n                  <th>Total Payable Amount</th>\n                  <td>{{ getAmount(studentCourseFeeForm.getRawValue().totalAmount) }}</td>\n                </tr>\n                <tr>\n                  <th colspan=\"2\">Installment Details</th>\n                </tr>\n                <tr>\n                  <td colspan=\"2\">\n                    <div class=\"table-responsive\">\n                      <table class=\"table table-sm table-bordered\">\n                        <thead>\n                          <tr>\n                            <th>Installment No.</th>\n                            <th>Installment Date</th>\n                            <th>Installment Amount</th>\n                            <th>Pending Amount after Installment</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr\n                            *ngFor=\"\n                              let installment of studentCourseInstallmentForm.get('installments')[\n                                'controls'\n                              ];\n                              let i = index\n                            \"\n                          >\n                            <td>Installment {{ installment.getRawValue().installmentNo }}</td>\n                            <td>\n                              {{\n                                dateService.formatDate(installment.getRawValue().installmentDate)\n                              }}\n                            </td>\n                            <td>{{ getAmount(installment.getRawValue().installmentAmount) }}</td>\n                            <td>{{ getAmount(installment.getRawValue().amountPending) }}</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-6 text-left\">\n              <button\n                type=\"button\"\n                class=\"\"\n                nbButton\n                size=\"small\"\n                (click)=\"previousStep()\"\n                [disabled]=\"submit\"\n              >\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\n                <span>prev</span>\n              </button>\n            </div>\n            <div class=\"col-6 text-right\">\n              <button\n                nbButton\n                size=\"small\"\n                (click)=\"saveStudentCourse()\"\n                [disabled]=\"submit\"\n                [nbSpinner]=\"submit\"\n                nbSpinnerStatus=\"primary\"\n                nbSpinnerSize=\"small\"\n              >\n                <span>Submit</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </nb-step>\n    </nb-stepper>\n  </nb-card-body>\n</nb-card>\n","import { AddStudentCourseComponent } from './add-student-course.component';\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AddStudentCourseComponent,\n  },\n\n  {\n    path: 'page-not-found',\n    loadChildren: () =>\n      import('../../../../../shared/page-not-found/page-not-found.module').then(\n        (m) => m.PageNotFoundModule,\n      ),\n  },\n\n  {\n    path: '**',\n    redirectTo: 'page-not-found',\n    pathMatch: 'full',\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AddStudentCourseRoutingModule {}\n","import { InstallmentModel } from './../../../../../models/student-course-installment.model';\r\nimport { CourseService } from './../../../../../services/course.service';\r\nimport { BatchService } from './../../../../../services/batch.service';\r\nimport { DiscountAndOfferModel } from './../../../../../models/discount-and-offer.model';\r\nimport { BatchModel } from './../../../../../models/batch.model';\r\nimport { CourseModel } from './../../../../../models/course.model';\r\nimport { StudentCourseModel } from './../../../../../models/student-course.model';\r\nimport { StudentCourseService } from './../../../../../services/student-course.service';\r\nimport { DateService } from './../../../../../services/shared-services/date.service';\r\nimport { StudentService } from './../../../../../services/student.service';\r\nimport { FormGroup, FormControl, Validators, FormArray } from '@angular/forms';\r\nimport { Component, OnInit, OnDestroy, ViewChild } from '@angular/core';\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\nimport { BranchService } from './../../../../../services/branch.service';\r\nimport { NbToastrService, NbStepperComponent } from '@nebular/theme';\r\nimport { StudentCourseInstallmentService } from '../../../../../services/student-course-installment.service';\r\nimport { StudentCourseInstallmentModel } from '../../../../../models/student-course-installment.model';\r\nimport { ObjectId } from 'bson';\r\nimport { DiscountAndOfferService } from '../../../../../services/discount-and-offer.service';\r\n\r\n@Component({\r\n  selector: 'ngx-add-student-course',\r\n  templateUrl: './add-student-course.component.html',\r\n  styleUrls: ['./add-student-course.component.scss'],\r\n})\r\nexport class AddStudentCourseComponent implements OnInit, OnDestroy {\r\n  @ViewChild('stepper', { static: false }) stepper: NbStepperComponent;\r\n\r\n  loading: boolean;\r\n  submit: boolean;\r\n\r\n  private branchId: string;\r\n  private studentId: string;\r\n  private categoryId: string;\r\n  private studentCourseId: string;\r\n\r\n  studentCourse: StudentCourseModel;\r\n  studentCourseInstallment: StudentCourseInstallmentModel;\r\n\r\n  discount: DiscountAndOfferModel;\r\n  discounts: DiscountAndOfferModel[];\r\n\r\n  discountTypes: string[];\r\n\r\n  course: CourseModel;\r\n  courses: CourseModel[];\r\n\r\n  batch: BatchModel;\r\n  private batches: BatchModel[];\r\n  courseBatches: BatchModel[];\r\n\r\n  rollNumberAlreadyExist: boolean;\r\n\r\n  studentCourseForm: FormGroup;\r\n  studentCourseFeeForm: FormGroup;\r\n  studentCourseInstallmentForm: FormGroup;\r\n\r\n  constructor(\r\n    public dateService: DateService,\r\n    private toastrService: NbToastrService,\r\n    private branchService: BranchService,\r\n    private courseService: CourseService,\r\n    private batchService: BatchService,\r\n    private discountAndOfferService: DiscountAndOfferService,\r\n    private studentService: StudentService,\r\n    private studentCourseService: StudentCourseService,\r\n    private studentCourseInstallmentService: StudentCourseInstallmentService,\r\n\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n  ) {\r\n    // route.queryParams.subscribe((param: Params) => {\r\n    //   this.ngOnInit();\r\n    // });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.loading = true;\r\n    this.submit = false;\r\n\r\n    this.branchId = this.branchService.getBranchId();\r\n    this.categoryId = this.branchService.getCategoryId();\r\n    this.studentId = this.studentService.getStudentId();\r\n    if (!this.branchId && !this.categoryId && !this.studentId) {\r\n      this.router.navigate(['../'], { relativeTo: this.route });\r\n\r\n      return;\r\n    }\r\n\r\n    this.studentCourseId = this.studentCourseService.getStudentCourseId();\r\n\r\n    let mode: string;\r\n\r\n    this.route.queryParams.subscribe((param: Params) => {\r\n      mode = param.mode;\r\n    });\r\n\r\n    if (mode && mode !== 'edit') {\r\n      this.showToastr('top-right', 'danger', 'Invalid Route');\r\n      this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n      return;\r\n    } else if (mode && !this.studentCourseId) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Not Found');\r\n      this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n      return;\r\n    }\r\n\r\n    this.discounts = [];\r\n    this.courses = [];\r\n    this.batches = [];\r\n    this.courseBatches = [];\r\n    this.discountTypes = [];\r\n    this.rollNumberAlreadyExist = false;\r\n\r\n    this.courseService.getCoursesData().subscribe((courses: CourseModel[]) => {\r\n      this.courses = courses;\r\n    });\r\n\r\n    this.batchService.getBatchesData().subscribe((batches: BatchModel[]) => {\r\n      this.batches = batches;\r\n    });\r\n\r\n    this.discountAndOfferService\r\n      .getDiscountAndOffersData()\r\n      .subscribe((discountAndOffers: DiscountAndOfferModel[]) => {\r\n        this.discounts = discountAndOffers;\r\n      });\r\n\r\n    this.discountTypes = this.discountAndOfferService.getDiscountTypes();\r\n\r\n    this.studentCourseForm = new FormGroup(\r\n      {\r\n        course: new FormControl('', { validators: [Validators.required] }),\r\n        batch: new FormControl('', { validators: [Validators.required] }),\r\n        rollNumber: new FormControl(null, { validators: [Validators.required, Validators.min(1)] }),\r\n        discount: new FormControl('', {\r\n          validators: [],\r\n        }),\r\n        additionalDiscountType: new FormControl(\r\n          this.discountTypes.length > 0 ? this.discountTypes[0] : '',\r\n          {\r\n            validators: [],\r\n          },\r\n        ),\r\n        additionalDiscountAmount: new FormControl(0, {\r\n          validators: [Validators.min(0)],\r\n        }),\r\n        activationDate: new FormControl(this.dateService.getDateString(), {\r\n          validators: [Validators.required],\r\n        }),\r\n        netPayable: new FormControl(0, {\r\n          validators: [Validators.required],\r\n        }),\r\n      },\r\n      {\r\n        validators: this.discountPercentageValidator.bind(this),\r\n      },\r\n    );\r\n\r\n    this.studentCourseFeeForm = new FormGroup({\r\n      installmentType: new FormControl('0', {\r\n        validators: [Validators.required],\r\n      }),\r\n      date: new FormControl(this.dateService.getDateString(), {\r\n        validators: [Validators.required],\r\n      }),\r\n      noOfInstallments: new FormControl(1, {\r\n        validators: [Validators.required, Validators.min(1)],\r\n      }),\r\n      pendingAmount: new FormControl(0, {\r\n        validators: [Validators.required, Validators.min(0)],\r\n      }),\r\n      amountCollected: new FormControl(0, {\r\n        validators: [Validators.required, Validators.min(0)],\r\n      }),\r\n      totalAmount: new FormControl(0, {\r\n        validators: [Validators.required, Validators.min(0)],\r\n      }),\r\n    });\r\n\r\n    this.studentCourseInstallmentForm = new FormGroup({\r\n      installments: new FormArray([]),\r\n    });\r\n\r\n    if (mode && this.studentId && this.studentCourseId) {\r\n      this.studentCourseService.getStudentCourseForEditing(this.studentCourseId).subscribe(\r\n        (res: any) => {\r\n          this.studentCourse = res.studentCourse;\r\n          this.studentCourseInstallment = res.studentCourseInstallment;\r\n          this.studentCourseForm.patchValue({\r\n            course: this.studentCourse.course,\r\n            activationDate: this.studentCourse.activationDate,\r\n            rollNumber: this.studentCourse.rollNumber,\r\n            discount: this.studentCourse.discount,\r\n            additionalDiscountType: this.studentCourse.additionalDiscountType,\r\n            additionalDiscountAmount: this.studentCourse.additionalDiscountAmount,\r\n            netPayable: this.studentCourse.netPayable,\r\n          });\r\n\r\n          this.onSelectCourse(this.studentCourse.course);\r\n\r\n          this.studentCourseForm.patchValue({\r\n            batch: this.studentCourse.batch,\r\n          });\r\n\r\n          this.disableStudentCourseDetails();\r\n\r\n          if (this.studentCourseInstallment) {\r\n            this.studentCourseFeeForm.patchValue({\r\n              installmentType: this.studentCourseInstallment.installmentType,\r\n              date: this.studentCourseInstallment.date,\r\n              noOfInstallments: this.studentCourseInstallment.noOfInstallments,\r\n              amountCollected: this.studentCourseInstallment.amountCollected,\r\n              pendingAmount: this.studentCourseInstallment.pendingAmount,\r\n              totalAmount: this.studentCourseInstallment.totalAmount,\r\n            });\r\n\r\n            this.disableStudentCourseFeeForm();\r\n\r\n            this.resetStudentCourseInstallments();\r\n\r\n            this.studentCourseInstallment.installments.forEach(\r\n              (installment: InstallmentModel, i: number) => {\r\n                this.addStudentCourseInstallment(installment);\r\n                if (installment.receiptId) {\r\n                  this.getStudentCourseInstallments()[i].get('installmentDate').disable();\r\n                }\r\n              },\r\n            );\r\n\r\n            this.disableStudentCourseInstallmentFields();\r\n          }\r\n\r\n          this.loading = false;\r\n        },\r\n        (err: any) => {\r\n          this.showToastr('top-right', 'danger', err);\r\n          this.back();\r\n        },\r\n      );\r\n    } else {\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n  private discountPercentageValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const discountType = group.getRawValue().additionalDiscountType;\r\n    const amount = +group.getRawValue().additionalDiscountAmount;\r\n    if (discountType === 'percentage' && amount > 100) {\r\n      return { invalidDiscountPercentage: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  checkRollNumber() {\r\n    let rollNumber: any = this.studentCourseForm.getRawValue().rollNumber;\r\n    const batchId = this.studentCourseForm.getRawValue().batch;\r\n    if (rollNumber) {\r\n      rollNumber = rollNumber.toString();\r\n      if (\r\n        this.studentCourse &&\r\n        this.studentCourse.batch === batchId &&\r\n        this.studentCourse.rollNumber === rollNumber\r\n      ) {\r\n        return;\r\n      }\r\n      const courseId = this.studentCourseForm.getRawValue().course;\r\n      if (courseId && batchId) {\r\n        this.studentCourseService\r\n          .checkBatchRollNumber(this.branchId, this.categoryId, courseId, batchId, rollNumber)\r\n          .subscribe(\r\n            (res: any) => {\r\n              this.rollNumberAlreadyExist = res.rollNumberExist;\r\n            },\r\n            (err: any) => {},\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectCourse(courseId: string) {\r\n    this.studentCourseForm.patchValue({ batch: '' });\r\n    this.courseBatches = [];\r\n    this.courseBatches = this.batches.filter(\r\n      (curBatch: BatchModel) => curBatch.course === courseId,\r\n    );\r\n    this.course = this.courses.find((curCourse: CourseModel) => curCourse._id === courseId);\r\n    this.calculateNetPayableAmount();\r\n  }\r\n\r\n  getAmount(amount: any) {\r\n    amount = +amount;\r\n    return amount.toFixed(2).toString() + '/-';\r\n  }\r\n\r\n  onSelectBatch(batchId: string) {\r\n    if (batchId !== '') {\r\n      this.studentCourseForm.get('rollNumber').enable();\r\n      this.batch = this.batches.find((curBatch: BatchModel) => curBatch._id === batchId);\r\n      this.checkRollNumber();\r\n    } else {\r\n      this.studentCourseForm.get('rollNumber').disable();\r\n    }\r\n  }\r\n\r\n  onSelectDiscount(discountId: string) {\r\n    this.discount = this.discounts.find((curDicount: any) => curDicount._id === discountId);\r\n    this.calculateNetPayableAmount();\r\n  }\r\n\r\n  onAdditionalDiscountAmount(amount: number) {\r\n    if (amount >= 0) {\r\n      this.calculateNetPayableAmount();\r\n    }\r\n  }\r\n\r\n  changeAdditionalDiscountType() {\r\n    this.studentCourseForm.patchValue({ additionalDiscount: 0 });\r\n    this.calculateNetPayableAmount();\r\n  }\r\n\r\n  private calculateNetPayableAmount() {\r\n    let netPayable = 0;\r\n    let totalDiscountPercentage = 0;\r\n    let totalDiscountAmount = 0;\r\n    let calculatedAmount = 0;\r\n\r\n    const totalFee = this.course ? +this.course.feeDetails.totalFees : 0;\r\n    const discountType = this.discount ? this.discount.discountType : '';\r\n    const additionalDiscountType = this.studentCourseForm.getRawValue().additionalDiscountType;\r\n    const discount = this.discount ? +this.discount.discountAmount : 0;\r\n    const additionalDiscount = +this.studentCourseForm.getRawValue().additionalDiscountAmount;\r\n\r\n    if (this.course && totalFee) {\r\n      calculatedAmount = totalFee;\r\n\r\n      if (this.discount && discountType) {\r\n        if (discountType === 'percentage') {\r\n          totalDiscountPercentage += discount;\r\n        } else {\r\n          totalDiscountAmount += discount;\r\n        }\r\n      }\r\n\r\n      if (additionalDiscount) {\r\n        if (additionalDiscountType === 'percentage') {\r\n          totalDiscountPercentage += additionalDiscount;\r\n        } else {\r\n          totalDiscountAmount += additionalDiscount;\r\n        }\r\n      }\r\n      const percentageAmount = (totalDiscountPercentage / 100) * totalFee;\r\n      calculatedAmount = totalFee - totalDiscountAmount - percentageAmount;\r\n\r\n      netPayable = calculatedAmount;\r\n\r\n      this.studentCourseForm.patchValue({ netPayable });\r\n      this.studentCourseFeeForm.patchValue({ totalAmount: netPayable });\r\n\r\n      this.calculatePendingAmount();\r\n\r\n      const installmentType = this.studentCourseFeeForm.getRawValue().installmentType;\r\n      this.onSelectInstallmentType(installmentType);\r\n    }\r\n  }\r\n\r\n  private calculatePendingAmount() {\r\n    let pendingAmount = 0;\r\n    const totalAmount = this.studentCourseFeeForm.getRawValue().totalAmount;\r\n    const amountCollected = this.studentCourseFeeForm.getRawValue().amountCollected;\r\n    pendingAmount = +totalAmount - (amountCollected ? amountCollected : 0);\r\n    this.studentCourseFeeForm.patchValue({ pendingAmount });\r\n  }\r\n\r\n  private enableStudentCourseDetails() {\r\n    this.studentCourseForm.get('course').enable();\r\n    this.studentCourseForm.get('discount').enable();\r\n    this.studentCourseForm.get('additionalDiscountType').enable();\r\n    this.studentCourseForm.get('additionalDiscountAmount').enable();\r\n  }\r\n\r\n  private disableStudentCourseDetails() {\r\n    this.studentCourseForm.get('course').disable();\r\n    this.studentCourseForm.get('discount').disable();\r\n    this.studentCourseForm.get('additionalDiscountType').disable();\r\n    this.studentCourseForm.get('additionalDiscountAmount').disable();\r\n  }\r\n\r\n  private enableStudentCourseFeeForm() {\r\n    this.studentCourseFeeForm.get('installmentType').enable();\r\n    this.studentCourseFeeForm.get('noOfInstallments').enable();\r\n  }\r\n\r\n  private disableStudentCourseFeeForm() {\r\n    this.studentCourseFeeForm.get('installmentType').disable();\r\n    this.studentCourseFeeForm.get('noOfInstallments').disable();\r\n  }\r\n\r\n  private getStudentCourseInstallments(): FormGroup[] {\r\n    const installments = this.studentCourseInstallmentForm.get('installments') as FormArray;\r\n    return installments.controls as FormGroup[];\r\n  }\r\n\r\n  private resetStudentCourseInstallments() {\r\n    const installments = this.studentCourseInstallmentForm.get('installments') as FormArray;\r\n    installments.controls = [];\r\n  }\r\n\r\n  private newStudentCourseInstallment(studentCourseInstallment: any) {\r\n    return new FormGroup(\r\n      {\r\n        _id: new FormControl(\r\n          studentCourseInstallment._id ? studentCourseInstallment._id : new ObjectId().toString(),\r\n          {\r\n            validators: [Validators.required],\r\n          },\r\n        ),\r\n        installmentNo: new FormControl(\r\n          studentCourseInstallment.installmentNo ? studentCourseInstallment.installmentNo : null,\r\n          {\r\n            validators: [Validators.required],\r\n          },\r\n        ),\r\n        installmentDate: new FormControl(\r\n          studentCourseInstallment.installmentDate\r\n            ? studentCourseInstallment.installmentDate\r\n            : null,\r\n          {\r\n            validators: [Validators.required],\r\n          },\r\n        ),\r\n        installmentAmount: new FormControl(\r\n          studentCourseInstallment.installmentAmount\r\n            ? studentCourseInstallment.installmentAmount\r\n            : 0,\r\n          {\r\n            validators: [Validators.required],\r\n          },\r\n        ),\r\n        amountPending: new FormControl(\r\n          studentCourseInstallment.installmentAmount ? studentCourseInstallment.amountPending : 0,\r\n          {\r\n            validators: [Validators.required],\r\n          },\r\n        ),\r\n        receiptId: new FormControl(\r\n          studentCourseInstallment.receiptId ? studentCourseInstallment.receiptId : null,\r\n          {\r\n            validators: [],\r\n          },\r\n        ),\r\n        status: new FormControl(\r\n          studentCourseInstallment.status ? studentCourseInstallment.status : true,\r\n          {\r\n            validators: [],\r\n          },\r\n        ),\r\n      },\r\n      {\r\n        validators: [\r\n          this.minInstallmentAmountValidator.bind(this),\r\n          this.maxInstallmentAmountValidator.bind(this),\r\n          this.minInstallmentPendingAmountValidator.bind(this),\r\n          this.maxInstallmentPendingAmountValidator.bind(this),\r\n        ],\r\n      },\r\n    );\r\n  }\r\n\r\n  private minInstallmentAmountValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const installmentNo = +group.getRawValue().installmentNo;\r\n    const installmentAmount = +group.getRawValue().installmentAmount;\r\n    const minInstallmentAmount = this.getMinInstallmentAmount(installmentNo - 1);\r\n    if (installmentAmount < minInstallmentAmount) {\r\n      return { invalidMinInstallmentAmount: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private maxInstallmentAmountValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const installmentNo = +group.getRawValue().installmentNo;\r\n    const installmentAmount = +group.getRawValue().installmentAmount;\r\n    const maxInstallmentAmount = this.getMaxInstallmentAmount(installmentNo - 1);\r\n    if (installmentAmount > maxInstallmentAmount) {\r\n      return { invalidMaxInstallmentAmount: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private minInstallmentPendingAmountValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const installmentNo = +group.getRawValue().installmentNo;\r\n    const installmentPendingAmount = +group.getRawValue().amountPending;\r\n    const minInstallmentPendingAmount = this.getMinInstallmentPendingAmount(installmentNo - 1);\r\n    if (installmentPendingAmount < minInstallmentPendingAmount) {\r\n      return { invalidMinInstallmentPendingAmount: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private maxInstallmentPendingAmountValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const installmentNo = +group.getRawValue().installmentNo;\r\n    const installmentPendingAmount = +group.getRawValue().amountPending;\r\n    const maxInstallmentPendingAmount = this.getMaxInstallmentPendingAmount(installmentNo - 1);\r\n    if (installmentPendingAmount > maxInstallmentPendingAmount) {\r\n      return { invalidMinInstallmentPendingAmount: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private addStudentCourseInstallment(studentCourseInstallment: any) {\r\n    const installments = this.getStudentCourseInstallments();\r\n    installments.push(this.newStudentCourseInstallment(studentCourseInstallment));\r\n  }\r\n\r\n  onSelectInstallmentType(installmentType: any) {\r\n    this.studentCourseFeeForm.patchValue({ amountCollected: 0 });\r\n    if (installmentType === '0') {\r\n      this.studentCourseFeeForm.get('noOfInstallments').disable();\r\n      this.generateNoOfInstallments(1);\r\n    } else if (installmentType === '1') {\r\n      this.studentCourseFeeForm.get('noOfInstallments').disable();\r\n      this.generateNoOfInstallments(2);\r\n    } else if (installmentType === '2') {\r\n      this.studentCourseFeeForm.get('noOfInstallments').disable();\r\n      this.generateNoOfInstallments(4);\r\n    } else if (installmentType === '3') {\r\n      this.studentCourseFeeForm.get('noOfInstallments').disable();\r\n      this.generateNoOfInstallments(this.course.basicDetails.duration);\r\n    } else {\r\n      this.studentCourseFeeForm.get('noOfInstallments').enable();\r\n      const noOfInstallments: number = this.studentCourseFeeForm.getRawValue().noOfInstallments;\r\n      this.generateNoOfInstallments(noOfInstallments);\r\n    }\r\n  }\r\n\r\n  generateNoOfInstallments(noOfInstallments: number) {\r\n    if (noOfInstallments) {\r\n      noOfInstallments = noOfInstallments > 0 ? noOfInstallments : 3;\r\n      this.studentCourseFeeForm.patchValue({ amountCollected: 0 });\r\n\r\n      this.studentCourseFeeForm.patchValue({ noOfInstallments });\r\n\r\n      const interval = 2592000000; // 30 * 24 * 60 * 60 * 1000\r\n\r\n      const duration: number = +this.course.basicDetails.duration;\r\n      const installmentDuration = duration / noOfInstallments;\r\n      const date = this.studentCourseFeeForm.getRawValue().date;\r\n\r\n      const netPayable: number = +this.studentCourseForm.getRawValue().netPayable;\r\n      const amount: number = netPayable / noOfInstallments;\r\n      const pendingAmount: number = +this.studentCourseFeeForm.getRawValue().pendingAmount;\r\n\r\n      this.resetStudentCourseInstallments();\r\n\r\n      for (let i = 0; i < noOfInstallments; i++) {\r\n        const installmentDate = this.dateService.millisecondsToDateString(\r\n          this.dateService.dateToMilliseconds(date) + interval * (installmentDuration * i),\r\n        );\r\n\r\n        let amountPending = pendingAmount - +(amount * (i + 1));\r\n        amountPending = amountPending < 0 ? 0 : amountPending;\r\n\r\n        const installmentData = {\r\n          _id: new ObjectId(),\r\n          installmentNo: (i + 1).toString(),\r\n          installmentDate,\r\n          installmentAmount: Math.ceil(amount),\r\n          amountPending: Math.ceil(amountPending),\r\n          receiptId: null,\r\n          status: true,\r\n        };\r\n        this.addStudentCourseInstallment(installmentData);\r\n      }\r\n\r\n      const installmentType = this.studentCourseFeeForm.getRawValue().installmentType;\r\n\r\n      if (installmentType === '4') {\r\n        this.enableStudentCourseInstallmentFields();\r\n      } else {\r\n        this.disableStudentCourseInstallmentFields();\r\n      }\r\n    }\r\n  }\r\n\r\n  customInstallmentAmount(amount: number, i: number) {\r\n    if (\r\n      !amount ||\r\n      amount < this.getMinInstallmentAmount(i) ||\r\n      amount > this.getMaxInstallmentAmount(i)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const installments = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n\r\n    const pendingAmount: number =\r\n      i === 0\r\n        ? this.studentCourseFeeForm.getRawValue().totalAmount\r\n        : installments[i - 1].getRawValue().amountPending;\r\n\r\n    const amountPending: number = pendingAmount - amount;\r\n\r\n    installments[i].patchValue({ amountPending });\r\n    const noOfUnchangedInstallments: number =\r\n      noOfInstallments - (i + 1) > 0 ? noOfInstallments - (i + 1) : 1;\r\n    let installmentAmount: number = Math.ceil(amountPending / noOfUnchangedInstallments);\r\n    if (i !== noOfInstallments - 1) {\r\n      for (let j = 0; j < noOfUnchangedInstallments; j++) {\r\n        let curAmountPending = amountPending - +(installmentAmount * (j + 1));\r\n        curAmountPending = curAmountPending < 0 ? 0 : curAmountPending;\r\n        const index = i + j + 1;\r\n        if (index === noOfInstallments - 1) {\r\n          if (this.getMaxInstallmentAmount(index) < installmentAmount) {\r\n            installmentAmount = this.getMaxInstallmentAmount(index);\r\n          }\r\n        }\r\n        installments[index].patchValue({\r\n          installmentAmount,\r\n          amountPending: curAmountPending,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getMinInstallmentDate(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    if (i === 0) {\r\n      // First Installment\r\n      return this.studentCourseFeeForm.getRawValue().date;\r\n    } else {\r\n      return installments[i - 1].getRawValue().installmentDate;\r\n    }\r\n  }\r\n\r\n  getMaxInstallmentDate(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n\r\n    if (i === 0 && noOfInstallments === 1) {\r\n      // First Installment\r\n      return this.studentCourseFeeForm.getRawValue().date;\r\n    } else if (i === noOfInstallments - 1) {\r\n      // Last Installment\r\n      return this.dateService.millisecondsToDateString(\r\n        this.dateService.dateToMilliseconds(this.studentCourseFeeForm.getRawValue().date) +\r\n          1000 * 60 * 60 * 24 * 30 * this.course.basicDetails.duration,\r\n      );\r\n    } else {\r\n      return installments[i + 1].getRawValue().installmentDate;\r\n    }\r\n  }\r\n\r\n  getMinInstallmentAmount(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n    if (i === 0 && noOfInstallments === 1) {\r\n      // First Installment for only 1 installment\r\n      return this.studentCourseFeeForm.getRawValue().totalAmount;\r\n    } else if (i === 0 && noOfInstallments > 1) {\r\n      // Last Installment for more than 1 installment\r\n      return 1;\r\n    } else if (i === noOfInstallments - 1) {\r\n      // Last Installment\r\n      return installments[i - 1].getRawValue().amountPending;\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  getMaxInstallmentAmount(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n\r\n    if (i === 0 && noOfInstallments >= 1) {\r\n      // First Instalment\r\n      return this.studentCourseFeeForm.getRawValue().totalAmount;\r\n    } else if (i === noOfInstallments - 1) {\r\n      // Last Installment\r\n      return installments[i - 1].getRawValue().amountPending;\r\n    } else {\r\n      return installments[i - 1].getRawValue().amountPending;\r\n    }\r\n  }\r\n\r\n  getMinInstallmentPendingAmount(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n    if (i === 0 && noOfInstallments >= 1) {\r\n      // First Installment\r\n      return 0;\r\n    } else if (i === noOfInstallments - 1) {\r\n      // Last Installment\r\n      return 0;\r\n    } else {\r\n      if (installments[i]) {\r\n        return (\r\n          installments[i - 1].getRawValue().amountPending -\r\n          installments[i].getRawValue().installmentAmount\r\n        );\r\n      }\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  getMaxInstallmentPendingAmount(i: number) {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    const noOfInstallments: number = this.getNoOfInstallments();\r\n\r\n    if (i === 0 && noOfInstallments >= 1) {\r\n      // First Installment\r\n      return this.studentCourseFeeForm.getRawValue().totalAmount;\r\n    } else if (i === noOfInstallments - 1) {\r\n      // Last Installment\r\n      return 0;\r\n    } else {\r\n      if (installments[i]) {\r\n        return (\r\n          installments[i - 1].getRawValue().amountPending -\r\n          installments[i].getRawValue().installmentAmount +\r\n          1\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  getNoOfInstallments(): number {\r\n    return +this.studentCourseFeeForm.getRawValue().noOfInstallments;\r\n  }\r\n\r\n  private enableStudentCourseInstallmentFields() {\r\n    const installments = this.getStudentCourseInstallments();\r\n    installments.forEach((installment: FormGroup) => {\r\n      installment.get('installmentAmount').enable();\r\n      // installment.get('amountPending').enable();\r\n    });\r\n  }\r\n\r\n  private disableStudentCourseInstallmentFields() {\r\n    const installments = this.getStudentCourseInstallments();\r\n    installments.forEach((installment: FormGroup) => {\r\n      installment.get('installmentAmount').disable();\r\n      // installment.get('amountPending').disable();\r\n    });\r\n  }\r\n\r\n  previousStep() {\r\n    if (this.studentCourse) {\r\n      this.disableStudentCourseDetails();\r\n    }\r\n    const installmentType = this.studentCourseFeeForm.getRawValue().installmentType;\r\n    if (this.studentCourseInstallment) {\r\n      this.disableStudentCourseInstallmentFields();\r\n    } else if (installmentType !== '4') {\r\n      this.disableStudentCourseInstallmentFields();\r\n    }\r\n    this.stepper.previous();\r\n  }\r\n\r\n  studentCourseFormSubmit() {\r\n    this.studentCourseForm.markAllAsTouched();\r\n    if (this.rollNumberAlreadyExist) {\r\n      this.showToastr('top-right', 'danger', 'Student Roll Number for this Batch already Exist');\r\n      return;\r\n    } else if (this.studentCourseForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Details are Required');\r\n      return;\r\n    }\r\n    if (this.studentCourse) {\r\n      this.enableStudentCourseDetails();\r\n    }\r\n    this.stepper.next();\r\n  }\r\n\r\n  studentCourseFeeFormSubmit() {\r\n    this.studentCourseFeeForm.markAllAsTouched();\r\n    if (this.studentCourseFeeForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Fee Details are Required');\r\n      return;\r\n    }\r\n    this.stepper.next();\r\n  }\r\n\r\n  studentCourseInstallmentFormSubmit() {\r\n    this.studentCourseInstallmentForm.markAllAsTouched();\r\n    if (this.studentCourseInstallmentForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Installment Details are Required');\r\n      return;\r\n    }\r\n\r\n    if (!this.validateStudentCourseInstallmentForm()) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Installment Details are Required');\r\n      return;\r\n    }\r\n\r\n    this.enableStudentCourseInstallmentFields();\r\n\r\n    this.stepper.next();\r\n  }\r\n\r\n  private validateStudentCourseInstallmentForm(): boolean {\r\n    const installments: FormGroup[] = this.getStudentCourseInstallments();\r\n    let invalidInstallments: boolean = false;\r\n    installments.forEach((installment: FormGroup, i) => {\r\n      if (installment.invalid) {\r\n        invalidInstallments = true;\r\n      }\r\n    });\r\n\r\n    if (invalidInstallments) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  saveStudentCourse() {\r\n    this.studentCourseForm.markAllAsTouched();\r\n    this.studentCourseFeeForm.markAllAsTouched();\r\n    this.studentCourseInstallmentForm.markAllAsTouched();\r\n\r\n    if (this.rollNumberAlreadyExist) {\r\n      this.showToastr('top-right', 'danger', 'Student Roll Number for this Batch already Exist');\r\n      return;\r\n    } else if (this.studentCourseForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Details are Required');\r\n      return;\r\n    } else if (this.studentCourseFeeForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Fee Details are Required');\r\n      return;\r\n    } else if (this.studentCourseInstallmentForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Installment Details are Required');\r\n      return;\r\n    } else if (!this.validateStudentCourseInstallmentForm()) {\r\n      this.showToastr('top-right', 'danger', 'Student Course Installment Details are Required');\r\n      return;\r\n    }\r\n    this.submit = true;\r\n\r\n    const studentCourseDetails: any = this.studentCourseForm.getRawValue();\r\n    studentCourseDetails.branch = this.branchId;\r\n    studentCourseDetails.category = this.categoryId;\r\n    studentCourseDetails.student = this.studentId;\r\n\r\n    const studentCourseInstallmentDetails: any = this.studentCourseFeeForm.getRawValue();\r\n    studentCourseInstallmentDetails.installments = this.studentCourseInstallmentForm.getRawValue().installments;\r\n    studentCourseInstallmentDetails.branch = this.branchId;\r\n    studentCourseInstallmentDetails.category = this.categoryId;\r\n    studentCourseInstallmentDetails.course = studentCourseDetails.course;\r\n    studentCourseInstallmentDetails.student = this.studentId;\r\n\r\n    if (!this.studentCourse && !this.studentCourseInstallment) {\r\n      this.studentCourseService\r\n        .addStudentCourse(studentCourseDetails, studentCourseInstallmentDetails)\r\n        .subscribe(\r\n          (res: any) => {\r\n            this.showToastr('top-right', 'success', 'Student Course Created Successfully!');\r\n            this.back();\r\n          },\r\n          (err: any) => {\r\n            this.showToastr('top-right', 'danger', err);\r\n            this.submit = false;\r\n          },\r\n        );\r\n    } else if (this.studentCourse && !this.studentCourseInstallment) {\r\n      this.studentCourseInstallmentService\r\n        .addStudentCourseInstallment(this.studentCourse._id, studentCourseInstallmentDetails)\r\n        .subscribe(\r\n          (res: any) => {\r\n            this.showToastr(\r\n              'top-right',\r\n              'success',\r\n              'Student Course Installments Created Successfully!',\r\n            );\r\n            this.back();\r\n          },\r\n          (err: any) => {\r\n            this.showToastr('top-right', 'danger', err);\r\n            this.submit = false;\r\n          },\r\n        );\r\n    } else {\r\n      studentCourseDetails._id = this.studentCourse._id;\r\n      studentCourseInstallmentDetails._id = this.studentCourseInstallment._id;\r\n      this.studentCourseService\r\n        .editStudentCourse(studentCourseDetails, studentCourseInstallmentDetails)\r\n        .subscribe(\r\n          (res: any) => {\r\n            this.showToastr('top-right', 'success', 'Student Course Updated Successfully!');\r\n            this.back();\r\n          },\r\n          (err: any) => {\r\n            this.showToastr('top-right', 'danger', err);\r\n            this.submit = false;\r\n          },\r\n        );\r\n    }\r\n  }\r\n\r\n  private showToastr(position: any, status: any, message: string) {\r\n    this.toastrService.show(status, message, {\r\n      position,\r\n      status,\r\n    });\r\n  }\r\n\r\n  getCourse(courseId: string) {\r\n    const course = this.courses.find((curCourse: CourseModel) => curCourse._id === courseId);\r\n\r\n    if (course) {\r\n      return course.basicDetails.courseName;\r\n    }\r\n\r\n    return '--';\r\n  }\r\n\r\n  getBatch(batchId: string) {\r\n    const batch = this.batches.find((curBatch: BatchModel) => curBatch._id === batchId);\r\n\r\n    if (batch) {\r\n      return batch.basicDetails.batchName;\r\n    }\r\n\r\n    return '--';\r\n  }\r\n\r\n  getDiscount(discountId: string) {\r\n    const discount = this.discounts.find(\r\n      (curDiscount: DiscountAndOfferModel) => curDiscount._id === discountId,\r\n    );\r\n\r\n    if (discount) {\r\n      const discountString =\r\n        discount.offerName +\r\n        ' (' +\r\n        discount.code +\r\n        ' - ' +\r\n        discount.discountAmount +\r\n        (discount.discountType === 'percentage' ? '%' : '.00') +\r\n        ')';\r\n\r\n      return discountString;\r\n    }\r\n\r\n    return '--';\r\n  }\r\n\r\n  back() {\r\n    this.router.navigate(['../'], { relativeTo: this.route, replaceUrl: true });\r\n  }\r\n\r\n  ngOnDestroy() {}\r\n}\r\n","import { ReactiveFormsModule } from '@angular/forms';\nimport {\n  NbCardModule,\n  NbIconModule,\n  NbButtonModule,\n  NbInputModule,\n  NbSpinnerModule,\n  NbStepperModule,\n  NbCheckboxModule,\n  NbFormFieldModule,\n  NbSelectModule,\n} from '@nebular/theme';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { AddStudentCourseRoutingModule } from './add-student-course-routing.module';\nimport { AddStudentCourseComponent } from './add-student-course.component';\n\n@NgModule({\n  declarations: [AddStudentCourseComponent],\n  imports: [\n    CommonModule,\n    AddStudentCourseRoutingModule,\n    NbCardModule,\n    NbIconModule,\n    NbButtonModule,\n    NbInputModule,\n    NbSpinnerModule,\n    NbStepperModule,\n    NbCheckboxModule,\n    NbFormFieldModule,\n    NbSelectModule,\n\n    ReactiveFormsModule,\n  ],\n})\nexport class AddStudentCourseModule {}\n"]}