{"version":3,"sources":["webpack:///src/app/institute/branch/manage-branch/course/batch/add-batch/add-batch.component.html","webpack:///src/app/institute/branch/manage-branch/course/batch/add-batch/add-batch-routing.module.ts","webpack:///src/app/institute/branch/manage-branch/course/batch/add-batch/add-batch.component.ts","webpack:///src/app/institute/branch/manage-branch/course/batch/add-batch/add-batch.module.ts"],"names":["AddBatchComponent","AddBatchModule","AddBatchRoutingModule","routes","path","component","branchService","branchEmployeeService","batchService","courseService","toastrService","dateService","router","route","this","queryParams","subscribe","param","mode","ngOnInit","loading","submit","branchId","getBranchId","getCourseData","course","back","batchId","getBatchId","showToastr","navigate","relativeTo","batchBasicDetailsForm","batchName","validators","required","startDate","rollNoPrefix","description","batchSubjectForm","subjects","atLeastOneSubjectValidator","bind","teachers","filter","subject","status","forEach","batchSubject","_id","teacher","addBatchSubject","getBranchEmployeeNameIdsForBatch","getBatchForEditing","batch","patchValue","basicDetails","duration","batchSubjects","curSubject","i","find","curBatchSubject","changeSubjectStatus","getBatchSubjects","controls","get","setValue","curTeacher","employee","err","error","group","value","atLeastOneSubjectError","toString","push","newBatchSubject","enable","disable","id","name","markAllAsTouched","invalid","stepper","next","branch","category","editBatch","res","addBatch","position","message","show","replaceUrl","deleteBatchId","submitBasicDetails","submitSubjects","saveBatch","loadChildren","then","m","PageNotFoundModule","redirectTo","pathMatch","forChild"],"mappings":"8kBAyCkB,wCAIE,qDACF,+B,yBAXF,0CAME,0CAMF,wC,0CAJI,mL,sBAgCF,wCAIE,2DACF,+B,yBAXF,0CAME,0CAMF,wC,0CAJI,mL,yBAmFA,gDAAuE,yBAErE,+B,uBAF0C,8CAA2B,sE,gEA5BjF,0CAGE,0CACE,0CACE,yCACE,kDAKE,uKAEA,4CAA4B,yBAA2C,8BACzE,8BACF,8BACF,8BAEA,0CACE,yCACE,gDAOE,iDAAoB,4CAAe,8BACnC,mDAGF,8BACF,8BACF,8BACF,8BACF,uC,qEAhCwB,qEAId,uFAEA,oDAIO,wFAAqB,gGAQ5B,wFAOW,6E,yBAoEL,sCACE,sCAAI,yBAA2C,8BAC/C,sCAAI,yBAA2C,8BACjD,+B,qFAFM,gGACA,iG,yBALR,0CAGE,2CAIF,wC,uBAJM,8EChO9B,ICqBaA,ECaAC,EFZAC,EAtBPC,EAAiB,CACrB,CAAEC,KAAM,GAAIC,WCoBDL,EAAN,WAeL,WACUM,EACAC,EACAC,EACAC,EACAC,EACDC,EACCC,EACAC,wBAPA,KAAAP,gBACA,KAAAC,wBACA,KAAAC,eACA,KAAAC,gBACA,KAAAC,gBACD,KAAAC,cACC,KAAAC,SACA,KAAAC,QAERC,KAAKD,MAAME,YAAYC,WAAWC,YAC5BA,EAAMC,MACRJ,EAAKK,c,UA3BN,O,EAAA,G,EAAA,uBAgCL,WAAU,IAsBJD,EAtBI,OAKR,GAJAJ,KAAKM,WACLN,KAAKO,UAELP,KAAKQ,SAAWR,KAAKR,cAAciB,cAC9BT,KAAKQ,SAuBV,OAjBAR,KAAKL,cAAce,gBAAgBR,WAAWS,YAC5CX,EAAKW,OAASA,EACTX,EAAKW,QACRX,EAAKY,UAMTZ,KAAKa,QAAUb,KAAKN,aAAaoB,aAIjCd,KAAKD,MAAME,YAAYC,WAAWC,YAChCC,EAAOD,EAAMC,QAGXA,GAAiB,SAATA,GACVJ,KAAKe,WAAW,YAAa,SAAU,sBACvCf,KAAKF,OAAOkB,SAAS,CAAC,qBAAsB,CAAEC,WAAYjB,KAAKD,SAEtDK,IAASJ,KAAKa,SACvBb,KAAKe,WAAW,YAAa,SAAU,4BACvCf,KAAKF,OAAOkB,SAAS,CAAC,qBAAsB,CAAEC,WAAYjB,KAAKD,UAIjEC,KAAKkB,sBAAwB,IAAI,IAAU,CACzCC,UAAW,IAAI,IAAY,KAAM,CAC/BC,WAAY,CAAC,IAAWC,YAE1BC,UAAW,IAAI,IAAY,KAAM,CAC/BF,WAAY,CAAC,IAAWC,YAE1BE,aAAc,IAAI,IAAY,KAAM,CAClCH,WAAY,KAEdI,YAAa,IAAI,IAAY,KAAM,CACjCJ,WAAY,OAIhBpB,KAAKyB,iBAAmB,IAAI,IAC1B,CACEC,SAAU,IAAI,IAAU,KAE1B,CAAEN,WAAYpB,KAAK2B,2BAA2BC,KAAK5B,QAGrDA,KAAK6B,SAAW,GAChB7B,KAAK0B,SAAW1B,KAAKW,OAAOe,SAASI,QAAQC,YAAOA,OAAmBA,EAAQC,UAE/EhC,KAAK0B,SAASO,SAASF,YACrB,IAAMG,EAAe,CACnBC,IAAK,IAAI,IACTJ,QAASA,EAAQI,IACjBC,QAAS,GACTJ,QAAOA,GAEThC,EAAKqC,gBAAgBH,WAGvBlC,KAAKP,sBAAsB6C,iCAAiCtC,KAAKQ,SAAU,WAAWN,WACnF2B,YACC7B,EAAK6B,SAAWA,EAEZ7B,EAAKa,QACPb,EAAKN,aAAa6C,mBAAmBvC,EAAKa,SAASX,WAChDsC,YACC,GAAKA,EAAL,CAIAxC,EAAKwC,MAAQA,EACbxC,EAAKkB,sBAAsBuB,WAAW,CACpCtB,UAAWqB,EAAME,aAAavB,UAC9BG,UAAWkB,EAAME,aAAapB,UAC9BqB,SAAUH,EAAME,aAAanB,aAC7BC,YAAagB,EAAME,aAAalB,cAGlC,IAAMoB,EAAgBJ,EAAMd,SAE5B1B,EAAK0B,SAASO,SAAQ,SAACY,EAA0BC,GAC/C,IAAMf,EAAUa,EAAcG,MAC3BC,YAAeA,OACdA,EAAgBjB,UAAYc,EAAWV,OAGvCC,EAAkB,GAClBL,IACF/B,EAAKiD,oBAAoBlB,EAAQC,OAAQc,GACzC9C,EAAKkD,mBAAmBC,SAASL,GAAGM,IAAI,OAAOC,SAAStB,EAAQI,KAE9DN,EAASkB,MACNO,YAAUA,OAA0BA,EAAWC,WAAaxB,EAAQK,aAGvEA,EAAUL,EAAQK,UAGtBpC,EAAKkD,mBAAmBC,SAASL,GAAGM,IAAI,WAAWC,SAASjB,MAE9DpC,EAAKM,gBAjCHN,EAAKF,OAAOkB,SAAS,CAAC,qBAAsB,CAAEC,WAAYjB,EAAKD,WAmClEyD,YACCxD,EAAKF,OAAOkB,SAAS,CAAC,qBAAsB,CAAEC,WAAYjB,EAAKD,WAKnEC,EAAKM,cAGRmD,YACCzD,EAAKe,WAAW,YAAa,SAAU0C,GACvCzD,EAAKM,eAzHPN,KAAKY,SAtCJ,wCAoKG,SAA2B8C,GAEjC,IAAI1B,KAOJ,OARiB0B,EAAMC,MAAMjC,SAEpBO,SAASF,YACZA,EAAQC,SACVA,SAICA,EAGE,KAFE,CAAE4B,wBAAuBA,KA9K/B,8BAmLG,WACN,OAAO5D,KAAKyB,iBAAiB2B,IAAI,cApL9B,6BAuLG,SAAgBlB,GACtB,OAAO,IAAI,IAAU,CACnBC,IAAK,IAAI,IAAYD,EAAaC,IAAMD,EAAaC,KAAM,IAAI,KAAW0B,WAAY,CACpFzC,WAAY,CAAC,IAAWC,YAE1BU,QAAS,IAAI,IAAYG,EAAaH,QAAUG,EAAaH,QAAU,KAAM,CAC3EX,WAAY,CAAC,IAAWC,YAE1Be,QAAS,IAAI,IAAYF,EAAaE,QAAUF,EAAaE,QAAU,GAAI,CACzEhB,WAAY,KAEdY,OAAQ,IAAI,KAAYE,EAAaF,QAASE,EAAaF,OAAe,CACxEZ,WAAY,SAnMb,6BAwMG,SAAgBc,GACLlC,KAAKkD,mBACbY,KAAK9D,KAAK+D,gBAAgB7B,MA1MhC,iCA6ML,SAAoBF,EAAiBc,GACnC,IAAMZ,EAAelC,KAAKkD,mBAAmBC,SAASL,GACtDZ,EAAakB,IAAI,UAAUC,SAASrB,GAChCA,EACFE,EAAakB,IAAI,WAAWY,UAE5B9B,EAAakB,IAAI,WAAWC,SAAS,IACrCnB,EAAakB,IAAI,WAAWa,aApN3B,4BAwNL,SAAeC,GACb,IAAMnC,EAAU/B,KAAK0B,SAASqB,MAAMF,YAAUA,OAAmBA,EAAWV,MAAQ+B,KACpF,OAAInC,EACKA,EAAQA,QAGV,OA9NJ,4BAiOL,SAAemC,GACb,IAAM9B,EAAUpC,KAAK6B,SAASkB,MAC3BO,YAAUA,OAA0BA,EAAWC,WAAaW,KAE/D,OAAI9B,EACKA,EAAQ+B,KAGV,OAzOJ,gCA4OL,WACEnE,KAAKkB,sBAAsBkD,mBACvBpE,KAAKkB,sBAAsBmD,QAC7BrE,KAAKe,WAAW,YAAa,SAAU,8BAGzCf,KAAKsE,QAAQC,SAlPV,4BAqPL,WACEvE,KAAKyB,iBAAiB2C,mBAClBpE,KAAKyB,iBAAiB4C,QACxBrE,KAAKe,WAAW,YAAa,SAAU,kCAGzCf,KAAKsE,QAAQC,SA3PV,uBA8PL,WAAW,WAIT,GAHAvE,KAAKkB,sBAAsBkD,mBAC3BpE,KAAKyB,iBAAiB2C,mBAElBpE,KAAKkB,sBAAsBmD,QAC7BrE,KAAKe,WAAW,YAAa,SAAU,mCAElC,GAAIf,KAAKyB,iBAAiB4C,QAC/BrE,KAAKe,WAAW,YAAa,SAAU,sCADlC,CAIPf,KAAKO,UAEL,IAAMiC,EAAa,CACjBgC,OAAQxE,KAAKQ,SACbiE,SAAUzE,KAAKW,OAAO+B,aAAa+B,SACnC9D,OAAQX,KAAKW,OAAOwB,IACpBO,aAAc1C,KAAKkB,sBAAsByC,MACzCjC,SAAU1B,KAAKyB,iBAAiBkC,MAAMjC,UAEnC1B,KAAKwC,OAYRA,EAAML,IAAMnC,KAAKwC,MAAML,IAEvBnC,KAAKN,aAAagF,UAAUlC,GAAOtC,WAChCyE,YACC3E,EAAKe,WAAW,YAAa,UAAW,+BACxCf,EAAKY,UAEN6C,YACCzD,EAAKe,WAAW,YAAa,SAAU0C,GACvCzD,EAAKO,cApBTP,KAAKN,aAAakF,SAASpC,GAAOtC,WAC/ByE,YACC3E,EAAKe,WAAW,YAAa,UAAW,iCACxCf,EAAKY,UAEN6C,YACCzD,EAAKe,WAAW,YAAa,SAAU0C,GACvCzD,EAAKO,gBA1RR,wBA6SG,SAAWsE,EAAe7C,EAAa8C,GAC7C9E,KAAKJ,cAAcmF,KAAK/C,EAAQ8C,EAAS,CACvCD,WACA7C,aAhTC,kBAoTL,WACEhC,KAAKF,OAAOkB,SAAS,CAAC,OAAQ,CAAEC,WAAYjB,KAAKD,MAAOiF,YAAWA,MArThE,yBAwTL,WACEhF,KAAKN,aAAauF,qB,2BAzTf,K,sCAAM/F,GAAiB,mT,mDAAjBA,EAAiB,sD,MAAA,K,sxEFzB9B,2CACE,kDACE,4CAAqE,qDAAS,EAAA0B,UAC5E,kCACF,8BACA,wCACE,yB,qCACF,8BACF,8BACA,gDACE,kDACE,8CACE,2CAAe,sDAAU,EAAAsE,wBACvB,uCAAI,2CAAc,8BAClB,0CACE,0CACE,0CACE,4CAA6C,wCAAW,8BACxD,wCAiBA,sDAaF,8BACF,8BAEA,0CACE,0CACE,6CAAmD,8CAAiB,8BACpE,wCAeA,sDAaF,8BACF,8BAEA,0CACE,0CACE,6CAA8C,4CAAe,8BAC7D,wCAUF,8BACF,8BAEA,2CACE,0CACE,6CAAqD,yCAAY,8BACjE,2CASF,8BACF,8BACF,8BAEA,kCAEA,0CACE,2CACE,8CACE,yCAAM,iCAAI,8BACV,0CACF,8BACF,8BACF,8BACF,8BACF,8BAEA,+CACE,4CAAqC,wDAAY,EAAAC,oBAC/C,uDAoCA,kCAEA,0CACE,2CACE,8CACE,0CACA,yCAAM,iCAAI,8BACZ,8BACF,8BACA,2CACE,8CACE,yCAAM,iCAAI,8BAAO,0CACnB,8BACF,8BACF,8BACF,8BACF,8BAEA,+CACE,2CACE,2CACE,6CACE,0CACE,uCACE,uCAAI,uCAAU,8BACd,uCAAI,0BAA2C,8BACjD,8BACA,uCACE,uCAAI,6CAAgB,8BACpB,uCAAI,0BAAmE,8BACzE,8BACA,uCACE,uCAAI,iDAAoB,8BACxB,uCACE,0BAKF,8BACF,8BAEA,uCACE,uCAAI,wCAAW,8BACf,uCACE,0BAKF,8BACF,8BACA,uCACE,uCAAI,qCAAQ,8BACZ,uCACE,6CACE,0CACE,sDAQF,8BACF,8BACF,8BACF,8BACF,8BACF,8BACF,8BAEA,kCAEA,0CACE,2CACE,8CACE,0CACA,yCAAM,iCAAI,8BACZ,8BACF,8BACA,2CACE,8CAGE,qDAAS,EAAAC,eAMT,0CAAM,oCAAM,8BACd,8BACF,8BACF,8BACF,8BACF,8BACF,8BACF,8BACF,+B,MAtQM,6KAImB,mEACV,6FACwC,2FAerC,6LASA,iKAyBA,6LASA,iKA4DH,yFACD,sFAEF,6GA4DU,uGAIA,gIAKF,kKAWA,gKAaM,6GAmB6C,2EAUvD,2EAAmB,wB,yICxPjC,CACE9F,KAAM,iBACN+F,aAAc,kBACZ,iCAAwEC,MACrEC,YAACA,OAAKA,EAAEC,wBAIf,CACElG,KAAM,KACNmG,WAAY,iBACZC,UAAW,SAQR,IAAMtG,EAAN,yB,gDAAMA,I,+EAAAA,IAAqB,SAHvB,CAAC,IAAauG,SAAStG,IACtB,O,GEcL,IAAMF,EAAN,yB,gDAAMA,I,+EAAAA,IAAc,SAlBhB,CACP,IACA,EAEA,IACA,IACA,KACA,IACA,IACA,IACA,IACA,KACA,KACA,IAEA,Q","file":"x","sourcesContent":["<nb-card>\n  <nb-card-header>\n    <button class=\"float-right\" nbButton size=\"small\" status=\"warning\" s (click)=\"back()\">\n      Back\n    </button>\n    <h3 class=\"\">\n      {{ !batch ? 'Add New Batch' : 'Edit Batch ' + (batch.basicDetails.batchName | uppercase) }}\n    </h3>\n  </nb-card-header>\n  <nb-card-body>\n    <nb-stepper #stepper [linear]=\"true\">\n      <nb-step [stepControl]=\"batchBasicDetailsForm\" label=\"Basic Details\">\n        <form class=\"\" (submit)=\"submitBasicDetails()\" [formGroup]=\"batchBasicDetailsForm\">\n          <h6>Batch Details:</h6>\n          <div class=\"row\">\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input -batch-name\">Batch Name:</label>\n                <input\n                  type=\"text\"\n                  nbInput\n                  id=\"input-batch-name\"\n                  name=\"batchName\"\n                  formControlName=\"batchName\"\n                  placeholder=\"Batch Name\"\n                  maxlength=\"30\"\n                  fullWidth\n                  [status]=\"\n                    batchBasicDetailsForm.get('batchName').touched\n                      ? batchBasicDetailsForm.get('batchName').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                />\n                <ng-container\n                  *ngIf=\"\n                    batchBasicDetailsForm.get('batchName').invalid &&\n                    batchBasicDetailsForm.get('batchName').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"batchBasicDetailsForm.get('batchName').errors?.required\"\n                  >\n                    Batch Name is required!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input -batch-start-date\">Batch Start Date:</label>\n                <input\n                  type=\"date\"\n                  nbInput\n                  id=\"input-batch-start-date\"\n                  name=\"startDate\"\n                  formControlName=\"startDate\"\n                  fullWidth\n                  [status]=\"\n                    batchBasicDetailsForm.get('startDate').touched\n                      ? batchBasicDetailsForm.get('startDate').invalid\n                        ? 'danger'\n                        : 'success'\n                      : 'basic'\n                  \"\n                />\n                <ng-container\n                  *ngIf=\"\n                    batchBasicDetailsForm.get('startDate').invalid &&\n                    batchBasicDetailsForm.get('startDate').touched\n                  \"\n                >\n                  <p\n                    class=\"caption status-danger\"\n                    *ngIf=\"batchBasicDetailsForm.get('startDate').errors?.required\"\n                  >\n                    Batch Start Date is required!\n                  </p>\n                </ng-container>\n              </div>\n            </div>\n\n            <div class=\"col-md-4\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-rollNoPrefix\">Roll No Prefix:</label>\n                <input\n                  type=\"text\"\n                  nbInput\n                  id=\"input-rollNoPrefix\"\n                  name=\"rollNoPrefix\"\n                  maxlength=\"15\"\n                  formControlName=\"rollNoPrefix\"\n                  placeholder=\"Roll No Prefix\"\n                  fullWidth\n                />\n              </div>\n            </div>\n\n            <div class=\"col-md-12\">\n              <div class=\"form-control-group\">\n                <label class=\"label\" for=\"input-billing-description\">Description:</label>\n                <textarea\n                  type=\"text\"\n                  nbInput\n                  id=\"input-description\"\n                  name=\"description\"\n                  formControlName=\"description\"\n                  placeholder=\"Description (Optional)\"\n                  fullWidth\n                ></textarea>\n              </div>\n            </div>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-md-12 text-right\">\n              <button nbButton size=\"small\" type=\"submit\">\n                <span>Next</span>\n                <nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\n              </button>\n            </div>\n          </div>\n        </form>\n      </nb-step>\n\n      <nb-step [stepControl]=\"batchSubjectForm\" label=\"Subject Details\">\n        <form [formGroup]=\"batchSubjectForm\" (ngSubmit)=\"submitSubjects()\" class=\"step-container\">\n          <ng-container\n            *ngFor=\"let subject of batchSubjectForm.get('subjects')['controls']; let i = index\"\n          >\n            <div class=\"row mb-3\" [formGroup]=\"subject\">\n              <div class=\"col-md-4 col-sm-6 mx-auto\">\n                <div class=\"form-control-group\">\n                  <nb-checkbox\n                    id=\"status-{{ i }}\"\n                    name=\"status\"\n                    [checked]=\"subject.value.status\"\n                    formControlName=\"status\"\n                    (checkedChange)=\"changeSubjectStatus($event, i)\"\n                  >\n                    <label for=\"status-{{ i }}\">{{ getSubjectName(subject.value.subject) }}</label>\n                  </nb-checkbox>\n                </div>\n              </div>\n\n              <div class=\"col-md-4 col-sm-6 mx-auto\">\n                <div class=\"form-control-group\">\n                  <nb-select\n                    id=\"teacher-{{ i }}\"\n                    name=\"teacher\"\n                    formControlName=\"teacher\"\n                    placeholder=\"Select Teacher\"\n                    fullWidth\n                  >\n                    <nb-option value=\"\">Select Teacher </nb-option>\n                    <nb-option *ngFor=\"let teacher of teachers\" [value]=\"teacher.employee\">{{\n                      teacher.name\n                    }}</nb-option>\n                  </nb-select>\n                </div>\n              </div>\n            </div>\n          </ng-container>\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-6 text-left\">\n              <button class=\"\" nbButton size=\"small\" nbStepperPrevious>\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\n                <span>prev</span>\n              </button>\n            </div>\n            <div class=\"col-6 text-right\">\n              <button nbButton size=\"small\" type=\"submit\">\n                <span>Next</span><nb-icon icon=\"arrow-ios-forward-outline\"></nb-icon>\n              </button>\n            </div>\n          </div>\n        </form>\n      </nb-step>\n\n      <nb-step label=\"Submit\">\n        <div class=\"step-container\">\n          <div class=\"table-responsive\">\n            <table class=\"table table-bordered\">\n              <tbody>\n                <tr>\n                  <th>Batch Name</th>\n                  <td>{{ batchBasicDetailsForm.value.batchName }}</td>\n                </tr>\n                <tr>\n                  <th>Batch Start Date</th>\n                  <td>{{ dateService.formatDate(batchBasicDetailsForm.value.startDate) }}</td>\n                </tr>\n                <tr>\n                  <th>Batch Roll No Prefix</th>\n                  <td>\n                    {{\n                      batchBasicDetailsForm.value.rollNoPrefix\n                        ? batchBasicDetailsForm.value.rollNoPrefix\n                        : '--'\n                    }}\n                  </td>\n                </tr>\n\n                <tr>\n                  <th>Description</th>\n                  <td>\n                    {{\n                      batchBasicDetailsForm.value.description\n                        ? batchBasicDetailsForm.value.description\n                        : '--'\n                    }}\n                  </td>\n                </tr>\n                <tr>\n                  <th>Subjects</th>\n                  <td>\n                    <table class=\"table table-sm table-borderless\">\n                      <tbody>\n                        <ng-container\n                          *ngFor=\"let subject of batchSubjectForm.get('subjects')['controls']\"\n                        >\n                          <tr *ngIf=\"subject.value.status\">\n                            <th>{{ getSubjectName(subject.value.subject) }}</th>\n                            <td>{{ getTeacherName(subject.value.teacher) }}</td>\n                          </tr>\n                        </ng-container>\n                      </tbody>\n                    </table>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          <hr />\n\n          <div class=\"row\">\n            <div class=\"col-6 text-left\">\n              <button class=\"\" nbButton size=\"small\" nbStepperPrevious [disabled]=\"submit\">\n                <nb-icon icon=\"arrow-ios-back-outline\"></nb-icon>\n                <span>prev</span>\n              </button>\n            </div>\n            <div class=\"col-6 text-right\">\n              <button\n                nbButton\n                size=\"small\"\n                (click)=\"saveBatch()\"\n                [disabled]=\"submit\"\n                [nbSpinner]=\"submit\"\n                nbSpinnerStatus=\"primary\"\n                nbSpinnerSize=\"small\"\n              >\n                <span>Submit</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </nb-step>\n    </nb-stepper>\n  </nb-card-body>\n</nb-card>\n","import { AddBatchComponent } from './add-batch.component';\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', component: AddBatchComponent },\n\n  {\n    path: 'page-not-found',\n    loadChildren: () =>\n      import('../../../../../../shared/page-not-found/page-not-found.module').then(\n        (m) => m.PageNotFoundModule,\n      ),\n  },\n\n  {\n    path: '**',\n    redirectTo: 'page-not-found',\n    pathMatch: 'full',\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AddBatchRoutingModule {}\n","import { EmployeeNameIdModel } from './../../../../../../models/branch-employee.model'; // To be removed\r\nimport { CourseService } from './../../../../../../services/course.service';\r\nimport { SubjectModel, CourseModel } from './../../../../../../models/course.model';\r\nimport { BatchModel, BatchSubjectModel } from './../../../../../../models/batch.model';\r\nimport { FormGroup, Validators, FormControl, FormArray } from '@angular/forms';\r\nimport { NbToastrService, NbStepperComponent } from '@nebular/theme';\r\nimport { BatchService } from './../../../../../../services/batch.service';\r\nimport { Component, OnInit, OnDestroy, ViewChild } from '@angular/core';\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\nimport { BranchService } from './../../../../../../services/branch.service';\r\n\r\nimport { ObjectId } from 'bson';\r\nimport { BranchEmployeeService } from '../../../../../../services/branch-employee.service';\r\nimport { DateService } from '../../../../../../services/shared-services/date.service';\r\n\r\ninterface Teacher {\r\n  imsMasterId: string;\r\n  name: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'ngx-add-batch',\r\n  templateUrl: './add-batch.component.html',\r\n  styleUrls: ['./add-batch.component.scss'],\r\n})\r\nexport class AddBatchComponent implements OnInit, OnDestroy {\r\n  @ViewChild('stepper', { static: false }) stepper: NbStepperComponent;\r\n\r\n  loading: boolean;\r\n  submit: boolean;\r\n\r\n  private branchId: string;\r\n  private batchId: string;\r\n  batch: BatchModel;\r\n  course: CourseModel;\r\n  teachers: EmployeeNameIdModel[];\r\n  subjects: SubjectModel[];\r\n  batchBasicDetailsForm: FormGroup;\r\n  batchSubjectForm: FormGroup;\r\n\r\n  constructor(\r\n    private branchService: BranchService,\r\n    private branchEmployeeService: BranchEmployeeService,\r\n    private batchService: BatchService,\r\n    private courseService: CourseService,\r\n    private toastrService: NbToastrService,\r\n    public dateService: DateService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n  ) {\r\n    this.route.queryParams.subscribe((param: Params) => {\r\n      if (param.mode) {\r\n        this.ngOnInit();\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.loading = true;\r\n    this.submit = false;\r\n\r\n    this.branchId = this.branchService.getBranchId();\r\n    if (!this.branchId) {\r\n      this.back();\r\n\r\n      return;\r\n    }\r\n\r\n    this.courseService.getCourseData().subscribe((course: CourseModel) => {\r\n      this.course = course;\r\n      if (!this.course) {\r\n        this.back();\r\n\r\n        return;\r\n      }\r\n    });\r\n\r\n    this.batchId = this.batchService.getBatchId();\r\n\r\n    let mode: string;\r\n\r\n    this.route.queryParams.subscribe((param: Params) => {\r\n      mode = param.mode;\r\n    });\r\n\r\n    if (mode && mode !== 'edit') {\r\n      this.showToastr('top-right', 'danger', 'Invalid Route');\r\n      this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n      return;\r\n    } else if (mode && !this.batchId) {\r\n      this.showToastr('top-right', 'danger', 'Batch Not Available');\r\n      this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n      return;\r\n    }\r\n\r\n    this.batchBasicDetailsForm = new FormGroup({\r\n      batchName: new FormControl(null, {\r\n        validators: [Validators.required],\r\n      }),\r\n      startDate: new FormControl(null, {\r\n        validators: [Validators.required],\r\n      }),\r\n      rollNoPrefix: new FormControl(null, {\r\n        validators: [],\r\n      }),\r\n      description: new FormControl(null, {\r\n        validators: [],\r\n      }),\r\n    });\r\n\r\n    this.batchSubjectForm = new FormGroup(\r\n      {\r\n        subjects: new FormArray([]),\r\n      },\r\n      { validators: this.atLeastOneSubjectValidator.bind(this) },\r\n    );\r\n\r\n    this.teachers = [];\r\n    this.subjects = this.course.subjects.filter((subject: SubjectModel) => subject.status);\r\n\r\n    this.subjects.forEach((subject: SubjectModel) => {\r\n      const batchSubject = {\r\n        _id: new ObjectId(),\r\n        subject: subject._id,\r\n        teacher: '',\r\n        status: true,\r\n      };\r\n      this.addBatchSubject(batchSubject);\r\n    });\r\n\r\n    this.branchEmployeeService.getBranchEmployeeNameIdsForBatch(this.branchId, 'teacher').subscribe(\r\n      (teachers: EmployeeNameIdModel[]) => {\r\n        this.teachers = teachers;\r\n\r\n        if (this.batchId) {\r\n          this.batchService.getBatchForEditing(this.batchId).subscribe(\r\n            (batch: BatchModel) => {\r\n              if (!batch) {\r\n                this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n                return;\r\n              }\r\n              this.batch = batch;\r\n              this.batchBasicDetailsForm.patchValue({\r\n                batchName: batch.basicDetails.batchName,\r\n                startDate: batch.basicDetails.startDate,\r\n                duration: batch.basicDetails.rollNoPrefix,\r\n                description: batch.basicDetails.description,\r\n              });\r\n\r\n              const batchSubjects = batch.subjects;\r\n\r\n              this.subjects.forEach((curSubject: SubjectModel, i: number) => {\r\n                const subject = batchSubjects.find(\r\n                  (curBatchSubject: BatchSubjectModel) =>\r\n                    curBatchSubject.subject === curSubject._id,\r\n                );\r\n\r\n                let teacher: string = '';\r\n                if (subject) {\r\n                  this.changeSubjectStatus(subject.status, i);\r\n                  this.getBatchSubjects().controls[i].get('_id').setValue(subject._id);\r\n                  if (\r\n                    teachers.find(\r\n                      (curTeacher: EmployeeNameIdModel) => curTeacher.employee === subject.teacher,\r\n                    )\r\n                  ) {\r\n                    teacher = subject.teacher;\r\n                  }\r\n                }\r\n                this.getBatchSubjects().controls[i].get('teacher').setValue(teacher);\r\n              });\r\n              this.loading = false;\r\n            },\r\n            (err: any) => {\r\n              this.router.navigate(['../page-not-found'], { relativeTo: this.route });\r\n              return;\r\n            },\r\n          );\r\n        } else {\r\n          this.loading = false;\r\n        }\r\n      },\r\n      (error: any) => {\r\n        this.showToastr('top-right', 'danger', error);\r\n        this.loading = false;\r\n      },\r\n    );\r\n  }\r\n\r\n  private atLeastOneSubjectValidator(group: FormGroup): { [s: string]: boolean } {\r\n    const subjects = group.value.subjects;\r\n    let status = false;\r\n    subjects.forEach((subject: any) => {\r\n      if (subject.status) {\r\n        status = true;\r\n      }\r\n    });\r\n\r\n    if (!status) {\r\n      return { atLeastOneSubjectError: true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private getBatchSubjects() {\r\n    return this.batchSubjectForm.get('subjects') as FormArray;\r\n  }\r\n\r\n  private newBatchSubject(batchSubject: any) {\r\n    return new FormGroup({\r\n      _id: new FormControl(batchSubject._id ? batchSubject._id : new ObjectId().toString(), {\r\n        validators: [Validators.required],\r\n      }),\r\n      subject: new FormControl(batchSubject.subject ? batchSubject.subject : null, {\r\n        validators: [Validators.required],\r\n      }),\r\n      teacher: new FormControl(batchSubject.teacher ? batchSubject.teacher : '', {\r\n        validators: [],\r\n      }),\r\n      status: new FormControl(batchSubject.status ? batchSubject.status : true, {\r\n        validators: [],\r\n      }),\r\n    });\r\n  }\r\n\r\n  private addBatchSubject(batchSubject: any) {\r\n    const subjects = this.getBatchSubjects();\r\n    subjects.push(this.newBatchSubject(batchSubject));\r\n  }\r\n\r\n  changeSubjectStatus(status: boolean, i: number) {\r\n    const batchSubject = this.getBatchSubjects().controls[i];\r\n    batchSubject.get('status').setValue(status);\r\n    if (status) {\r\n      batchSubject.get('teacher').enable();\r\n    } else {\r\n      batchSubject.get('teacher').setValue('');\r\n      batchSubject.get('teacher').disable();\r\n    }\r\n  }\r\n\r\n  getSubjectName(id: string) {\r\n    const subject = this.subjects.find((curSubject: SubjectModel) => curSubject._id === id);\r\n    if (subject) {\r\n      return subject.subject;\r\n    }\r\n\r\n    return '--';\r\n  }\r\n\r\n  getTeacherName(id: string) {\r\n    const teacher = this.teachers.find(\r\n      (curTeacher: EmployeeNameIdModel) => curTeacher.employee === id,\r\n    );\r\n    if (teacher) {\r\n      return teacher.name;\r\n    }\r\n\r\n    return '--';\r\n  }\r\n\r\n  submitBasicDetails() {\r\n    this.batchBasicDetailsForm.markAllAsTouched();\r\n    if (this.batchBasicDetailsForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Basic details are required');\r\n      return;\r\n    }\r\n    this.stepper.next();\r\n  }\r\n\r\n  submitSubjects() {\r\n    this.batchSubjectForm.markAllAsTouched();\r\n    if (this.batchSubjectForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'At least 1 Subject is required');\r\n      return;\r\n    }\r\n    this.stepper.next();\r\n  }\r\n\r\n  saveBatch() {\r\n    this.batchBasicDetailsForm.markAllAsTouched();\r\n    this.batchSubjectForm.markAllAsTouched();\r\n\r\n    if (this.batchBasicDetailsForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'Basic details are required');\r\n      return;\r\n    } else if (this.batchSubjectForm.invalid) {\r\n      this.showToastr('top-right', 'danger', 'At least 1 Subject is required');\r\n      return;\r\n    }\r\n    this.submit = true;\r\n\r\n    const batch: any = {\r\n      branch: this.branchId,\r\n      category: this.course.basicDetails.category,\r\n      course: this.course._id,\r\n      basicDetails: this.batchBasicDetailsForm.value,\r\n      subjects: this.batchSubjectForm.value.subjects,\r\n    };\r\n    if (!this.batch) {\r\n      this.batchService.addBatch(batch).subscribe(\r\n        (res: any) => {\r\n          this.showToastr('top-right', 'success', 'New Batch Added Successfully!');\r\n          this.back();\r\n        },\r\n        (error: any) => {\r\n          this.showToastr('top-right', 'danger', error);\r\n          this.submit = false;\r\n        },\r\n      );\r\n    } else {\r\n      batch._id = this.batch._id;\r\n\r\n      this.batchService.editBatch(batch).subscribe(\r\n        (res: any) => {\r\n          this.showToastr('top-right', 'success', 'Batch Updated Successfully!');\r\n          this.back();\r\n        },\r\n        (error: any) => {\r\n          this.showToastr('top-right', 'danger', error);\r\n          this.submit = false;\r\n        },\r\n      );\r\n    }\r\n  }\r\n\r\n  private showToastr(position: any, status: any, message: string) {\r\n    this.toastrService.show(status, message, {\r\n      position,\r\n      status,\r\n    });\r\n  }\r\n\r\n  back() {\r\n    this.router.navigate(['../'], { relativeTo: this.route, replaceUrl: true });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.batchService.deleteBatchId();\r\n  }\r\n}\r\n","import { AddBatchComponent } from './add-batch.component';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { AddBatchRoutingModule } from './add-batch-routing.module';\n\nimport { ReactiveFormsModule } from '@angular/forms';\nimport {\n  NbCardModule,\n  NbButtonModule,\n  NbSelectModule,\n  NbIconModule,\n  NbInputModule,\n  NbCheckboxModule,\n  NbSpinnerModule,\n  NbStepperModule,\n  NbFormFieldModule,\n} from '@nebular/theme';\n@NgModule({\n  declarations: [AddBatchComponent],\n  imports: [\n    CommonModule,\n    AddBatchRoutingModule,\n\n    NbCardModule,\n    NbButtonModule,\n    NbSelectModule,\n    NbIconModule,\n    NbInputModule,\n    NbFormFieldModule,\n    NbCheckboxModule,\n    NbSpinnerModule,\n    NbStepperModule,\n    NbFormFieldModule,\n\n    ReactiveFormsModule,\n  ],\n})\nexport class AddBatchModule {}\n"]}